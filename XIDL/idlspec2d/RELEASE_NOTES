COMBSMALLCOLLIMATE: Updated offsets from data on 56528 for the record (offsets 
	are now stored in Hartmann.__init__(),specifically the "fudge"
	 dictionary that is defined at line 100. 
	https://trac.sdss3.org/browser/repo/ops/actors/sopActor/trunk/python
	/sopActor/utils/boss_collimate.py   (MDO)

PLUGHISTORY: Report for cart #18, and don't crash when trying to read
    data for MANGA data (ie, plate 6655 on cart 1)
READPLUGMAP: Fix typo in #906 PSF/fiber2flux corrections (CPL)
SPECTRO_SUMMARY: Merged with version in boss/papers/OneDee.  Added entries
    from DR9 publications which weren't calculated here. (SJB)

-------------------------------------------------------------------------------
v5_6_5 (2013-06-24) ASB
Candidate tag for DR11 galaxy LSS analysis
Built against:
  elodie/v1_3
  specflat/v1_20
  idlutils/v5_5_10

BOLTON_BIASSUB, SDSSPROC: New code to deal with r2 power-supply bias
    instability over MJD range [56352, 56371] (Ticket #1759).
COMBSMALLCOLLIMATE: Change offsets because focus ring changes on 56434 (MDO)
PLATELIST: exclude LITTLE_COVERAGE, UNPLUGGED, and BAD_TARGET fibers from
    statistics for platelist.  Ticket #1727.
SPREDUCE1D: Add ability to override default redshift-fitting range for
    galaxy templates by using a file $SPECLOG_DIR/opfiles/spPlateZrange.par
    (ticket #1084).

templates/spEigenGal-56436.fits: Copy of galaxy templates pEigenGal-55740.fits
    with an extrapolation further to the red to logwave=3.0730, such that
    these can be used to z=2.

-------------------------------------------------------------------------------
v5_6_4 (2013-01-22) SJB
New tag for SOS for high read noise warning.

FINDSPEC: Fix to work with new behaviour of PLATELIST looking in RUN2D
    subdir names for the platelist.fits file
RDNOISE_HISTORY: Skip hartmanns
SDSSPROC: Add warning for high read noise in addition to low read noise.
SOS_LOGS_CONCAT, SOS_LOGS_PLOTSKY: New procs for looking at summary
    SOS log statistics

-------------------------------------------------------------------------------
v5_6_3 (2013-01-22) MDO
Changed collimate offsets and r1 focus to minimize xsig/wsig

MDO 2013-01-21:
collimate.pro: add offset for r1 so focus includes minimizing 
xsig+wsig in regions used for SOS
combsmallcollimate.pro: change offsets for xsig/wsig problems 
from temperature and focus ring changes

BAW 2013-01-16:
bin/knownMissing.py: script to search for missing files in $SPECTRO_REDUX.

SJB 2012-01-11:
rundaily_riemann_script: always use trunk for platelist.
Turn off platemerge to reduce load on master node; this is
now done in the morning batchmerge job.

SJB 2012-01-10:
PLATELIST: Added /alldirs option to call to get_mjd_dir when using it
to get a list of possible run2d and run1d dirs.  This is required because
of recent change to get_mjd_dir to by default only return numeric subdirs.

-------------------------------------------------------------------------------
v5_6_2 (2012-12-28) Tag for SoS with new offset values for XMID and WAVEMID

MDO 2012-12-18:
combsmallcollimate: change offsets from tests on 12-12 and 12-13 due to temperature and focus ring changes.

ASB 2012-12-17:
SPECTRO_SUMMARY: exclude BAD_TARGET spectra from effective Nspectra count.

SJB 2012-12-17:
PLATEMERGE: gzip spAll*.dat file for faster downloads.  Leave fits file as is.

SJB 2012-12-05:
SPREDUCE1D : allow RUN1D strings which don't match vX_Y_Z.

PLATELIST: Added columns PROGRAMNAME and TILEID to platelist.txt and .html
  --> resolves ticket 1716.
PLATEMERGE: Don't include public bad plates in spAll (e.g. 3698).

-------------------------------------------------------------------------------
v5_6_1 (2012-11-29) Tag for SoS to ignore cart<10 data

SJB 2012-11-29:
bin/reformat_spectra.py: fix COEFF0 keyword when trimming ivar=0 leading
  pixels.  Back propagate by hand into v5_5_12.
bin/copy_spPlan.py : refactor to only copy plans for good plate-mjd
  unless --bad option
BATCHPBS: if topdir option is used to override BOSS_SPECTRO_REDUX,
  put that into the batch script as well.

SJB 2012-11-28:
bin/sos_filesequencer: don't process arc/flat/science for cart<10
  to protect BOSS from MaNGA tests.  Process dark/bias from any cart
  to allow afternoon checkout tests while APOGEE carts are loaded.

-------------------------------------------------------------------------------
v5_6_0 (2012-11-16) Tag to reprocess all data; starts a new season toward DR11

ASB 2012-11-15: Added MATCH_SPALL (routine) and
  CHECK_CMASS_CHANGES (script) in pro/testsuite

SJB 2012-11-02:
  SDSSPROC : Added warning for readnoise<1.0 which could mean
             CCD voltages are wrong

SJB 2012-10-28: reformat_spectra.py - Added x column to exp HDUs of spec files.

-------------------------------------------------------------------------------
v5_5_12 (2012-10-23) -- DR10 release candidate

SJB 2012-10-23:
SPREDUCE2D: add photolog_version to log output
SPCOADD_V5: add EXTNAME keywords to spCFrame and spPlate files

JB 2012-10-22:
PLATEMERGE, SPREDUCE1D: Add CAS-styled specobjid to spreduce1d output

ASB 2012-10-20:
FLUX_DISTORTION, SPREDUCE1D: call SDSS_ASTROMBAD rather than looking
for CALIB_STATUS bit to flag bad fields.  (Ticket #1583).

MDO 2012-10-09:
SDSSPROC: add case to check if saturated pixel occurs within 3 pixels of top and bottom of image.  (Ticket $1424)

opfiles/washers.par: Remove duplicate entry 3537-55116

-------------------------------------------------------------------------------
v5_5_11 (2012-10-04) -- dry run for DR10

BATCHPBS: Added /skip1d option
BBSPEC_EXTRACT: bbspec ymodel moved to HDU 6 in extracted spectra.
BOSSLOG: New proc.
COMBINE1FIBER: only set NODATA in AND_MASK if there really is no data
    on any input spectrum; resolves ticket 1301.
COMBINEBPM: updated hand edited bad columns  (ticket 1424, MDO)
FLUX_DISTORTION: mask CALIB_STATUS->ASTROMBAD fluxes
  (ticket #1583, ASB)
PLATELIST: Change defult input/output location to be in RUN2D subdir
    to make it easier to work with multiple versions.  Can be overriden
    with TOPDIR and OUTDIR options, and multiple RUN2D versions can
    still be combined into a single platelist using RUN2D='*' or
    RUN2D=[x, y, z], in which case the platelist is written to
    $BOSS_SPECTRO_REDUX (not in the RUN2D subdir).
    Resolves ticket 1659.
PLATEMERGE: removed Z_PERSON, CLASS_PERSON, Z_CONF_PERSON,
    COMMENTS_PERSON from spAll so that quasar catalogs can proceed on
    timescale indepdenent of pipeline.  DRxQ will be authoritative
    source of FPG scans rather than also propagating to spAll.
PLATEMERGE: Added BOSSPRIMARY tag to replicate SPECPRIMARY but to be
    immune from downstream modification; changed SPECOBJ_ID to
    BOSS_SPECOBJ_ID (Ticket #1634).
READPLUGMAP: append CALIB_STATUS when /calibobj is passed
  (ticket #1583, ASB)
SDSS_PLATE_SORT: Adding ERROR to error messages for easier grepping
SDSSPROC: added masking for hotpixel trails (MDO)
SN_MEDIAN: Added "sn_all" keyword for median S/N across all bands
  (ticket #1634, ASB)
SPECTRO_SUMMARY: removed N_QSO_SCANNED, N_LYA_INCOMP, and N_LYA_IMPURE
    statistics.
SPREDUCE1D: push CALIB_STATUS->ASTROMBAD to ZWARNING->BAD_TARGET
  (ticket #1583, ASB)
SPREDUCE1D: Added SN_MEDIAN_ALL (median S/N across all bands) to
  output structure (ticket #1634, ASB).
SPREDUCE1D: Added ZNUM_NOQSO (Brownstein)

bin/copy_spPlan.py - New (SJB)

-------------------------------------------------------------------------------
v5_5_10 (2012-08-21)

BOLTON_BIASSUB: Bug fix for CRs in row-by-row kluge-processed overscan
    region of wonky b2 quadrant (ASB, ticket #1651).
QUICKTRACE: Bug fix for SOS reductions, which now need to pass cartID
    as a keyword to TRACE320CRUDE to be consistent with recent changes
    (ticket #1656).

-------------------------------------------------------------------------------
v5_5_9 (2012-08-15)
Tag for electronics bias drift on b2 UR quadrant.
Built against elodie/v1_3, specflat/v1_19, idlutils/v5_4_28+.

APO_CHECKLIMITS: Bug fix to test against values of exactly zero,
    although this wouldn't have been triggered.
BAD_BOSSFORMAT: Print mean and 95% of each sub-image.
BOLTON_BIASSUB: Adding kluge to do row-by-row bias subtraction for
    upper right quadrant of b2 post-Summer 2012, due to crazy bias
    phenomenon that has appeared there (ASB, 2012-Aug-15).
FITFLATWIDTH,SPCALIB,SPREDUCE,TRACE320CRUDE: Minor changes to use a
    different number of traces for the SDSS-I spectra (ticket #541).
PLATELIST: Remove %Main from the HTML file, since those targets do
    not exist in BOSS.
OPFIBER_GENERATE: Bug fix to work for SDSS-I plates with plate # < 1000
    and read traces from spFlat files for the old data model.
READPLUGMAP : reads opfiles/washer.par to get override status for
    ZOFFSET.  (SJB 2012-08-07)
SDSS_PLATE_SORT: The photoMatch,photoPlate,photoMatch files for the SDSS-I
    plates are alread sorted to a particular plugging, and have MJD
    in their names.  Rather than assume these are sorted, take the first
    matching file for a plate and re-sort, as we do for the BOSS files.
SPECTRO_SUMMARY: Summarize BOSS spectro totals from spAll file.
    (ASB: motivated by DR9.)

opfiles/opFibers.par: Add trace positions for SDSS-I spectra using
    the following cart+plate+MJDs, but then edited to start at MJD=50000
    in this file:
       1         414       51901
       2         400       51820
       3         404       51877
       4         418       51884
       5         406       51869
       6         431       51877
       7         412       51931
       8         410       51816
       9         401       51788

-------------------------------------------------------------------------------
v5_5_8 (2012-04-05, ASB)
Tag for spectrophoto bug fix (Ticket #1509), as well as
various SOS-related changes, file cleanups, bug fixes, etc.
Built against elodie/v1_3, specflat/v1_18, idlutils/v5_4_28.

Documentation: Fixed the formatting for IDL documentation in a number of files:
    pro/spec1d/bandpassfilter.pro
    pro/spec1d/filter_check_chi2.pro
    pro/spec1d/filter_solve.pro
    pro/spec1d/filter_check.pro
    pro/spec1d/filter_select.pro
    pro/spec1d/hogg_extinction.pro
    pro/spec1d/bolton_mlpca.pro
    pro/spec2d/extract_object.pro
    pro/spec2d/bolton_sn_fit.pro
    pro/spec2d/gausspix.pro
    pro/spec2d/bbspec_test.pro
    pro/spec2d/trace_sparse_crude.pro
    pro/spec2d/smooth_halo.pro
    pro/spec2d/smooth_halo2d.pro
    pro/inspect/inspectgen.pro
    pro/templates/pca_qso_dev.pro
    pro/templates/pca_gal_dev.pro
    pro/templates/mlpca_star.pro
    pro/templates/align_rest.pro
    pro/templates/mlpca_cvstar.pro
Fixing some files that don't need to be executable 
    examples/opECalib-51430.par
    examples/opECalib-blank.par
    examples/opECalib-51577.par
    examples/opECalib-55026.par

DECOLLIDE,RANDOM_DECOLLIDE: Fixed problem with duplicate function names.
EXTRACT_OBJECT: Commented out dispset in calls to SKYSUBSTRACT.
    (ticket #1475, JCR).
GAMA_TO_SDSS: New proc for converting 2dF GAMA spectra files to spPlate
    format for redshift-fitting with Spectro-1D.
PCA_QSO: Add /allatonce keyword.
SPFLUXCORR_V5: changed multiplicative polynomial fit parameters and
    changed fit to depend on index of refraction of air (ASB, ticket #1509)

Makefile (top-level): make doc is now not part of default install
Makefile (lower-level): All unnecessary Makefiles (that only did make install)
    are removed.
.cvsignore: Removed unnecessary .cvsignore files
bin/idlspec2d_version: Change from bash to sh.
doc/mk_doc: Removed, document generation now handled directly by doc/Makefile
etc/emlines.par: The H_gamma line fit width was accidentally tied to the
    forbidden lines rather than the Balmer lines.  Fixed.
examples/opECalib-*.par: Removed executable tags on some files.
examples/opLimits.par: increased limits on r1 wsig by 0.05.  
	b1 xsig goes high for high fibers at middle pixel numbers but after 
		collimator swap still within old limits so didn't change
	r1 wsig goes high for middle fibers at high pixel numbers
include/export.h: Remove old export.h and link to $IDL_DIR/external/export.h
    This is the same as what is done in the idlutils product.
ups/idlspec2d.table: Remove explicit version dependency idlutils v5_4_26.
    Remove outdated notation.

-------------------------------------------------------------------------------
v5_5_7 (2012-01-18)
--> Installed at APO

APO_PLOTSN: Line 92 changed to address ticket #1506: SOS not plotting
    data from very low S/N exposures.

bin/updatePluggingStatus: Remove to avoid conflict with version in
    the platedb product.
ups/idlspec2d.table: Force explicit version dependency idlutils v5_4_26.

-------------------------------------------------------------------------------
v5_5_4 - v5_5_6 (2012-1-10)
[several busted tag iterations sorting out dependencies]
--> Never installed at APO; skip to v5_5_7

BATCHPBS: Turned off calls to plate_spec_image: post-DR9 one should use
    plotspec or the spectrawebapp for casual browsing of spectra.
BBSPEC_EXTRACT,FITSCATTER: Implement a naive scattered light model for
    the bbspec extraction.
QUICKEXTRACT: Bug fix to sky-subtract in 25 bundles, not just 16.
    Use 2-D sky-subtraction with NPOLY=3 in call to SKYSUBTRACT.
SKYSUBTRACT: Cleaned up use of DISPSET argument; needs test (ticket #1475).
VDISPFIT: Change to flatten probability in optional redshift marginalization,
    may or may not be retained (ASB)
VDISP_PLATEFIT: New routine to facilitate re-batching of vdisp fitting code
    (ASB)

-------------------------------------------------------------------------------
v5_5_3 (2011-11-14)
--> Installed at APO
Tag for SOS with small changes after b2 triplet replacement.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

BOLTON_BIASSUB: add code to handle subarray readout bias subtraction
    gracefully (ASB, re: ticket #1466)
COMBINEBPM : Added bad columns for 55800-55850 on r1. After putting the set
    temperature for this CCD higher by 5 deg C, r1 looks good with no bad cols.
COMBSMALLCOLLIMATE:  Changed offsets for b2 after triplet swap
SDSS_PLATE_SORT : Add MOD 360 to match_ra to prevent crashes on match_ra>360
    in photoMatchPlate files (affects plates 4405 and 4277).
SDSS_SPEC_IMAGE, PLATE_SPEC_IMAGE : Added /silent hooks

bin/rundaily_cron, rundaily_riemann_script, rundaily_riemann:
    Added silent hooks for sdss_spec_image and plate_spec_image

-------------------------------------------------------------------------------
v5_5_2 (2010-10-19)
Tag for SOS bug fixes.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

COMBSMALLCOLLIMATE: Correctly apply offsets.
examples/opLimits.par: Tweaks to all XMID,WAVEMID values for year 3 (KSD).

-------------------------------------------------------------------------------
v5_5_1 (2011-09-17)
Tag for SOS bug fixes.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

COMBSMALLCOLLIMATE: Update offsets using all hartmanns from 55800-817

examples/opLimits.par: Switch incorrectly-swapped the values for WAVEMID
    for r1 & b1.  Set error for EXPTIME < 300 sec.
    Set error for SN2 less than 0.2.

-------------------------------------------------------------------------------
v5_5_0 (2011-09-09)
Tag for full reductions using replacement r1 CCD.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

COLLIMATE: Add test keyword to help find offsets with SMALLCOLLIMATE.
COMBSMALLCOLLIMATE: Update offsets and add /TEST keyword.
PLATECOMPARE: Fix to work with change from SNMEDIAN from vector to array.
PLOTSPEC, UUPLOTSPEC: Show 3 digits after decimal in rchi2 (ASB)
SDSSPROC: Added new r1 CCD gains to sdssproc for data after MJD 55800:
    amps 0-4 gains [1.9253, 1.5122, 1.4738, 1.5053]

bin/reformat_spectra.py: New proc to reformat spectra into one-file-per-object
    format (basically ticket #837)
bin/sos_apocommand : updatePluggingStatus no longer accepts -d -v options,
    so remove them from the call.
bin/updatePluggingStatus - this has been replaced by
    PLATEDB_DIR/bin/updatePluggingStatus.  Rename this copy to .._old just
    in case we need to get to it again.  After next APO install, if things are
    running smoothly and we don't need this, we can delete it for good (history
    will still be in svn)

-------------------------------------------------------------------------------
v5_4_45 (2011-08-27, ASB)
Bug fixes for DR9 data release.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

BUNDLETHRU: New proc to measure relative throughput of fiber bundles from
    flat-fields
PLATESN,PLOTSN: Bug fix(es) for new calling sequence to FITSN, where we no
    longer are passing the plugmap but instead the redden values.

-------------------------------------------------------------------------------
v5_4_44 (2011-08-26, ASB)
Tag to catch that last change
If good, this tag will be the DR9 tag.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

EXTRACT_OBJECT: Compute the SKYCHI2 output in the science frame headers
    only for good pixels (ticket #712)

-------------------------------------------------------------------------------
v5_4_43 (2011-08-25, ASB)
Tag to clean up a bunch of bugs and straggler tickets.
If good, this tag will be the DR9 tag.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

BOLTON_BIASSUB, SDSSPROC: Fix to make use of SDSSPROC_BADFORMAT
    image corrections (ASB, re: ticket # 1408)
CONFIGURATION__DEFINE: Remove some deprecated functions.
EXTRACT_BUNDLE_ROW, EXTRACT_BUNDLE_IMAGE: documentation cleanup
    to reflect the bundle-wise extraction mods (ASB)
EXTRACT_OBJECT,SPCALIB,QUICKWAVE: Remove call to getDetectorFormat and
    determine the image size from the image.
EXTRACT_OBJECT,FITSN,SPREDUCE: Pass the median reddening values for
    the plate from the plugmap file (as "reddeningMed" in the header)
    as a set of "REDDEN*" keywords in the output science frames.
    Use these values for evaluating the reddening-corrected S/N values
    in FITSN. (ticket #879)
FITSN: If there are fewer than 10 points in the mag fit range,
    then extend that range to all brighter magnitudes.  This will
    not effect any proper survey plates.  But it allows the S/N fit
    to occur for some special plates, such as 5017-5019 which have
    much fainter targets.  For those plates, then the spectro-photo
    stars are selected for the fit.  (ticket #1351)
PLATEMERGE: Add DIMS0,DIMS1 keywords to spAllLine file (ticket #1031)
SDSSPROC: Add option to return CCDMASK pixel mask that sets the 'NODATA'
    bit for regions of the BOSS CCD that are unused.  This should allow
    the option of including more mask bits at this stage to propogate
    through the pipeline, such as CR masks.
SPBIASGEN: Add /NOPROC option for generating average bias frames
    without overscan-trimming, etc.
SPCALIB: Remove some clutter of commented-out code.
SPECLINEFIT,LINEBACKFIT: Add new CONTRANGE keyword for setting the region
    for the continuum-fitting for each line.  A mean (unweighted) continuum
    is evaluated in the blueward and redward bands, and then the average of
    those two bands.  This is used at a range of [300,600] km/s for stars
    and galaxies.  QSOs retain the default of selecting the continuum level
    at the mid-point of the line, which is actually equivalent since the
    background terms are all straight lines for QSOs. (ticket #1243)
SPREDUCE1D: Fix spurious "broadline" subclassing (ASB, ticket #1316)
SPREDUCE,EXTRACT_OBJECT: Make use of the CCDMASK from SDSSPROC,
    and include those mask values through the pixel mask.  A 'NODATA'
    value is currently inherited from the initial SDSSPROC.
    Erase several of the bits in the 'NODATA' regions:
    ['NEARBADPIXEL','LOWFLAT','SCATTEREDLIGHT','NOSKY'].
    This partially addresses ticket #1301.

bin/loadSN2Value : fix platedb database connection method.
bin/sos_apostart: Correct instructions about which password to use for ssh
    daemon.

-------------------------------------------------------------------------------
v5_4_42 (2011-08-18, ASB)
Tag to fix 8000ang break feature with discontinuous sky model.
If good, this tag will be the DR9 tag.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

EXTRACT_OBJECT, SPREDUCE, SPREDUCE2D: Enabling split sky model between
   spatial halves (ASB, chasing ticket #1388)

Changed RAWDATA_DIR to BOSS_SPECTRO_DATA in 40 files (Ticket #1067).
   Script that did this is in misc/rawdata2bossdata (ASB)

-------------------------------------------------------------------------------
v5_4_41 (2011-08-08, ASB)
Tag for new bias recipe, new pixflats, misc 1d changes, misc 2d bugfixes.
Built against elodie/v1_3, specflat/v1_16, idlutils/v5_4_24.

BOLTON_BIASGEN: Minimum-chi^2 master bias model-building routine (ASB)
BOLTON_BIASSUB: Bias-subtraction using bolton_biasgen outputs (ASB)
FITVACSET: Added handling of 2-phase discontinuity info (ASB)
SDSSPROC: Add measured readnoise for each amp as fits header keywords
    RDNOISE0/1/2/3.  We might want that info some day for noise modeling.
PLATEMERGE: Set SPECPRIMARY for GALAXY targets now based upon
     ZWARNING_NOQSO (if present) rather than ZWARNING (ASB, ticket #1389)
PLATEMERGE: Test for inheritance of Z_NOQSO & related before computing
     (see SPREDUCE1D changes) (ASB, ticket #1385).
SDSSPROC: Change to use BOLTON_BIASSUB for BOSS MJD >= 55170 (ASB)
     (Will require coordinated tag with specflat.)
SPADD_GUIDERINFO: Limit reporting of seeing to in-focal-plane fibers only
     (ticket #1391).
SPREDUCE1D: Compute Z_NOQSO and related values here, rather than in
     PLATEMERGE (ASB, ticket #1385).
     Also compute redshift-marginalized vdisp likelihood curves
     with the Shu et al. 2011 parameter settings.
VDISPFIT: Subtract the # of invvar=0 pixels from vdispdof (ASB).

-------------------------------------------------------------------------------
v5_4_40 (2011-07-05, ASB)
Tag for new bad-pixel masks, against specflat v1_14

COMBINEBPM: Update using bad pixel masks (for tickets 1363, 1368, 1369).
PLATEMERGE: Improved handling of best non-QSO redshifts (ASB)
     No longer include the *NOQSO* entries unless /CALC_NOQSO is set.
SDSSPROC: When using /applypixflat, the (new) badpixel masks are applied
     immediately after reading in the pixflat (ticket #1369).

-------------------------------------------------------------------------------
v5_4_39 (2011-06-28, ASB)
Tag for a few 1D fiddles

VDISPFIT: Bug fix when marginalizing over redshifts with new DZPIX keyword.
ZFIND: Change to disallow negative-model fits for single-component
     template sets (i.e., most stars) upstream of ZWARNINGs (ASB)

templates/spEigenGal-55740.fits:
     Yanmei Chen's latest galaxy redshift templates, renamed to match
     wildcarding, covering 1800 to 10500 Ang (ASB).

-------------------------------------------------------------------------------
v5_4_38 (2011-06-21, ASB)
Tag for testing new redshift templates

ATVSPEC: Add /verbose option.
BBSPEC_EXTRACT: New proc to act as wrapper to bbspec extraction code.
     This first implementation only does a small sub-image for a single
     fiber at a time.
BBSPEC_PIXPSF: Initial check-in for code that generates a pixelated PSF
     from an arc frame.
EXTRACT_OBJECT: Add /bbspec option, and if set call BBSPEC_EXTRACT to replace
     fluxes and errors.
FITDISPERSION: Change quadrupole region for /QUICK option for reporting
     MEDWIDTH for different regions on the CCD (ticket #822).  This
     option used by QUICKWAVE.
FITFLATWIDTH: At least half the points should be good to fit the median
     value within a bundle.
PCA_CVSTAR_BOSS: New version of PCA_CVSTAR for generating BOSS CV star templates
PCA_STAR_BOSS: New version of PCA_STAR for stellar templates
    based upon extended/patched Indo-US archetypes resampled for BOSS,
    plus some empirically derived templates of oddball stars from BOSS
    spectroscopy (ASB).
PSOLVE: Initial check-in of routines used by BBSPEC_PIXPSF.
SDSSPROC: Remove the VARFILE option, and write the inverse variance
     as HDU #1 of OUTFILE instead.  Define a default naming scheme for OUTFILE.
SHIFT_TRACE: Remove this deprecated routine.
SPCALIB: Add /bbspec option, and if set then extract the flat-field with
     the 2D PSF.
SPREDUCE: Add /bbspec option, and if set then generated sdProc and
     spBasisPSFfiles for the best arc image.  Pass keyword to EXTRACT_OBJECT.
SPREDUCE1D: Default for CHOP_DATA changed from [3650,9200] to [3600,10400]
     (ticket #539).
     Restore old NPOLY choices of 3 for galaxies, QSOs, CV stars, and
     4 for stars (ticket #851).
     Change wildcard-matching for template files to explicitly have
     a 5-digit MJD string.
SPREDUCE2D: Propogate all the test keywords to the recursive calling of
     this routine.
     Add /bbspec option.

opfiles/lamplines.par: New file for lamp lines in bbspec PSF fitting.
templates/spArchIndoUS.fits,eigeninput_star_boss.dat,spEigenStar-55734.fits:
    New stellar template files as input and output by PCA_STAR_BOSS.
templates/eigeninput_qso_boss.dat,spEigenQSO-55732.fits:
    New QSO PCA redshift templates for BOSS (ASB)
templates/eigeninput_cvstar_boss.dat,spEigenCVstar-55734.fits:
    New CV PCA redshift templates for BOSS (ASB).
templates/spEigenGal-55686.fits:
    New GALAXY PCA redshift templates for BOSS, including
    type II QSOs.  Generated by BAW; checked in by ASB:
ups/idlspec2d.table: Add optional dependency on bbspec product.

-------------------------------------------------------------------------------
v5_4_37 (2011-06-13)
Another tag for SOS addressing ticket #822.

examples/opLimits.par: Switch the values for WSIGMA,XSIGMA
     since those were in error (ticket #822).

-------------------------------------------------------------------------------
v5_4_36 (2011-05-17)
Tag for SOS addressing ticket #822.

etc/opLimits.par: Changed red and yellow limits on xsig,wsig for r1;
     corrected order of r1 b1.

-------------------------------------------------------------------------------
v5_4_35 (2011-04-22 by ASB)
Tag for further test of bundle-wise extraction and other fixes
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

CONFIGURATION__DEFINE: Increased ncoeff used for BOSS linewidth fits
     to 5 (red) or 4 (blue) (ASB).
EXTRACT_ROW, EXTRACT_BUNDLE_ROW: moved separation check below "ngood"
     check, to avoid pointless warnings on fully invvar=0 rows
     (goes to ticket 1209) (ASB).
FITDISPERSION: Added maxdev=0.2 in traceset fit (ASB).
PLUGMAP_DIFF: New proc to find instances where the plPlugMapM file in
     the speclog file differs from what was used in the reductions.
     Used to see which fibers changed when fixing tickets #819,1262.
SPCALIB: new definition of "inmask" for trace-position fits, and
     new value for "maxdev" (goes to ticket #1269) (ASB).
SPREDUCE1D: Force the SPEC2_* values in the ZANS structure to always
     be type float (ticket #1290).

-------------------------------------------------------------------------------
v5_4_34 (2011-04-21)
Tag for SOS errors/warnings.
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

APOREDUCE: Look for INFO as well as ABORT,WARNING messages in log file
COMBSMALLCOLLIMATE: Change default values of badres from 5 to 6 deg
     (related to ticket #1266).
FITDISPERSION: Add /QUICK option for reporting MEDWIDTH for different
     regions on the CCD (ticket #822).  This option used by QUICKWAVE.
FITFLATWIDTH: Add /QUICK option to trim to the central region of CCD
     and report MEDWIDTH in different regions.  This option used by
     QUICKTRACE (for flats) and QUICKEXTRACT (for science frames).
GAUSSPIX: New routine for pixel-integrated gaussians, similar to but
     not to be confused with GAUSSPIX1D.
PLATEMERGE: Add XFOCAL,YFOCAL to spAll file (ticket #1271).
     Change PLATE from an optional input to an optional keyword to allow spAll
     generation for a subset of plates.
PLUGMAP_REPLACE: New proc for replacing plPlugMapM files in the speclog
     product with new versions from re-running EVILREMAP on the mapper movies.
QUICKEXTRACT,QUICKTRACE: Use /QUICK flag in call to FITFLATWIDTH.
QUICKWAVE: Change reporting of dispersion warning messages to be consistent
     with that reported by FITDISPERSION.  Use /QUICK flag to FITDISPERSION.
READPLUGMAP: MOD the range of values for PLUG_RA to fall strictly in
     the range [0,360) deg (tickets #1131, #1255).
SPADD_GUIDERINFO: Exclude NaN,Inf in guiderMon files when calculating
     guider statistics (ticket #1276).
SPCALIB,EXTRACT_OBJECT,EXTRACT_BUNDLE_IMAGE,EXTRACT_BUNDLE_ROW: Replace calls
     to EXTRACT_IMAGE with the newly-written bundle-by-bundle IDL extraction
     code (ASB).
WRITESPEC, WRITE_UROS: Format file names for 1000-fiber (4 digit) fibers
     (ticket #1275).

bin/riemann_redux_snapshot: New script to make a snapshot of the BOSS
     reductions of the platelist*,spAll* files.
examples/opLimits.par: Change red thresholds on XSIGMA from
     1.15,1.20,1.25,1.30 to 1.20,1.20,1.25,1.25 (with yellow lower by 0.05).
     This is to be consistent with the changes to FITFLATWIDTH.
     Change red thresholds on WSIGMA from 1.35,1.35,1.25,1.25 to
     1.25,1.30,1.20,1.25 (with yellow lower by 0.05) to be consistent
     with changes in FITDISPERSION.
templates/eigeninput_typeIIqso.dat: Type II QSO training sample drawn
     from BOSS galaxy targets, for GALAXY redshift templates (ticket #633).
     Not yet used.

-------------------------------------------------------------------------------
v5_4_33 (2011-03-30 by ASB)
Tag for testing bundle-wise IDL extraction
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

BATCHPBS: Change back to the original directory at end of proc.
EXTRACT_BUNDLE_ROW, EXTRACT_BUNDLE_IMAGE, GAUSSPIX  (ASB, U. Utah):
     Routines to enable pure IDL extraction, chunked up bundle-wise.
EXTRACT_OBJECT, SPCALIB (ASB, U. Utah):
     Switched to pure IDL bundle-wise extraction.
     Also addresses ticket #781, removing a redundant extraction step.
PLATEMERGE: The setting of SPECPRIMARY needs to address SN_MEDIAN
     as a 5-element array rather than a scalar.  Select based upon
     this S/N in r-band.
READPLUGMAP: MOD the range of values for PLUG_RA to fall strictly in
     the range [0,360) deg (ticket #1255).
VDISPFIT: Enable more sophisticated redshift-error marginalization.
     Add DZPIX keyword.

-------------------------------------------------------------------------------
v5_4_32 (2011-03-18)
Tag for testing spectrophotometry fixes.
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

BATCHPBS: Added -G -t GAL to runz_BOSS.sh call (ticket #1251).
CONFIGURATION__DEFINE,FITDISPERSION,QUICKWAVE,SPCALIB,TRACE320CRUDE:
     Remove some unnecessary definitions from the configuration__define proc.
FITDISPERSION: In the call to XY2TRACESET, pass a mask of the badly
     measured individual widths such that they do not throw the fits
     (ticket #822).
FLUX_DISTORTION: For determining if this is a multiple-pointing plate,
     don't look at missing plugmap entries.  This change necessary for
     the change with SPCOADD_V5 to include all zeros for a missing spectrograph.
PLATEMERGE: Modified to include minimal info on best non-QSO and
     best non-galaxy redshifts and classifications by default.
SPCOADD_V5: Always set the number of output fibers as 2X the number on
     a single spectrograph.  Otherwise, if data from one BOSS spectrograph
     is missing, then previous reductions made output files with 500 instead
     of 1000 objects.  Related to ticket #764.
SPFLUX_V5: In the internal function spflux_mratio_flatten, do a fit with
     outlier rejection when fitting each star's mratio to the mean
     (ticket #1249 and #1252).
SPPLAN2D: For any frames that are 'bad', enter them as 'UNKNOWN'
     in the plan files so that we don't attempt to reduce them (ticket #764).

etc/lamphgcdne.dat: Remove the Hg I lines at 4105 Ang, as it was the
     culpret for ticket #822 (although the fix to FITDISPERSION should
     make SOS robust to that anyway).
examples/opLimits.par: Change the S/N limits to be consistent with
     the numbers hard-wired in PLATELIST.
     Add yellow/red limits for %LRG1, %LRG2.

-------------------------------------------------------------------------------
v5_4_31 (2011-03-02)
Tag for production 2D reductions.
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

BATCHPBS: Don't print run1d and run2d multiple times.
LOGSHEET: Also look for files that might be .fits instead of .fit,
      as some were during the early BOSS commissioning.
PLATECOMPARE: Add support for RUN2D,RUN1D kewyords for comparing
      different version reductions of the same plates.
PLATELIST: DeRedSN^2 -> DEREDSN2 in column name.
      Shorten the SN2 column names for the html output.
SDSSPROC: The header values for the recently-added TWOPHASE keyword
      were not properly boolian values, with the result that the blue CCDs
      were having the 2-phase wavelength-correction accidentally applied
      (ticket #1238).
SPFLUX_V5: Add another digit to fiber number (for printing fiber #1000).

-------------------------------------------------------------------------------
v5_4_30 (2011-02-16)
Built against specflat v1_13, elodie v1_3, idlutils v5_4_23.

BOLTON_STD_THROUGHPUT: new function to compute end-to-end
      throughput on standard stars.
EXTRACT_OBJECT: Add DEREDSN2 keyword to spFrame output.
FITSN: If plugmap is provided, fill in dered_sn2 as dereddened
      version of sn2 output (ticket #879).
PLATELIST: Output dered_sn2_* values to spAll files, using
      those values instead of sn2_* for determining plate quality.
      New keyword RAWSN2 to revert to previous behaviour.
PLATEMERGE: Make directory-concatenation OS-independent, and remove
      undocumented use of a "spAll" subdir.
      Optional keyword INDIR added.
      Add DREDSN2 to the output file.
PLATESN: Add SN2EXT* keywords to spPlate output (ticket #879).
PLOTSN: Pass through dered_snplate from fitsn dered_sn2 output
SDSSPROC,SPCALIB: Move hard-coded logic of when the BOSS red CCDs switched
      from 1-phase to 2-phase readout to be inside the SDSSPROC routine.
SN_MEDIAN: New proc to compute median spectroscopic S/N in the SDSS filters
      (ticket #976).
SPREDUCE1D: Add call to SN_MEDIAN.
TRACE320CRUDE: Added condition on minimum fraction of traces for
      application of polyfitw (ticket #1025) [ASB]

bin/rundaily_riemann_script: Email Stephen instead of Gary when things go wrong

-------------------------------------------------------------------------------
v5_4_29 (2011-02-01)
Built against specflat v1_12, elodie v1_3, idlutils v5_4_23.
Attempts by ASB to fix UPS dependencies.

-------------------------------------------------------------------------------
v5_4_28 (2011-01-29)
Built against specflat v1_12, elodie v1_3, idlutils v5_4_23.
Attempts by ASB to fix UPS dependencies.

-------------------------------------------------------------------------------
v5_4_27 (2011-01-29)
Tag for ticket #880.
Built against specflat v1_12, elodie v1_3, idlutils v5_4_23.

SPCALIB, FITARCIMAGE:
      Added code to handle 2-phase red-side BOSS readout discontinuity.
      Coordinated with changes to XY2TRACESET, TRACESET2XY, TRACESET2PIX
      in idlutils product, so need to update that dependent product.
      Addresses ticket #880.

-------------------------------------------------------------------------------
v5_4_26 (2011-01-20)

COMBSMALLCOLLIMATE: Added offsets for focus ring moves from COLLIMATE
      and COMBSMALLCOLLIMATE.

-------------------------------------------------------------------------------
v5_4_25 (2011-01-20)
Tag for SOS collimation.

BATCHPBS: Fix bug when passing plate numbers as a number rather than string.
      Add /NOSUBMIT option.
      Print name of script being submitted for later logfile grepping.
      Change "script-XXX" to "redux-XXX" to fit within qstat display length.
      Added plate_spec_image calls.
CCDTILT: Fix crash condition for /DOPLOT option.
COMBSMALLCOLLIMATE: Refine offsets to gives same results as
      COLLIMATE using full Hartmanns taken from MJD 55440 to 55511  and tests
      of -10000,0,10000 step offset and more tests from 55581.
      b1 offset created using collimate, not collimate,/debug.
      Setting slope equal to 1 for offset between collimate and
      combsmallcollimate.
      Minor change on b residual output
FINDSPEC: Works with SDSS-I,II data as well as BOSS data
      Add /SDSS option that is hard-wired to run2d='26'
OPFIBER_GENERATE: New proc for generating the opFibers.par file
      used for trace-finding in TRACE320CRUDE.
PLATELIST: Add option for SKIPCART to skip problematic carts (like the
      current problems with cart 15).
      Change S/N^2 thresholds to > 10 in B and > 22 in R.
      Add function get_lastline to read the last line of log files rather
      than making a call to SPAWN.
PLATEMERGE: Put spAll files into RUN2D subdirs instead of leaving at top
      level $BOSS_SPECTRO_REDUX.
QUICKTRACE,SPCALIB,TRACE_CEN,TRACE320CEN: Changes to use new trace
      parameters stored in the file opFibers.par .  Ticket #817.
QUICKTRACE:  Changes made to region used for quick_extract for
      BOSS exposures to help with xsig.
      Bug fix from hdr=flathdr to flathdr=flathdr in call to TRACE320CRUDE.
RUN_SDSSPROC: New proc for running SDSSPROC over many sdR files and
      saving resulting image and invvar data to new files.
SDSSGUIDE: Guider images looks like they changed dimensions slightly
      on MJD 55425.
UUBATCHPBS: Modified version of BATCHPBS to put many plates in a single job.
VDISPFIT: Fix bug for zobj=0. case
      Add redshift marginalization and chi^2 map return options using
      DZPIX and RETURN_CHISQ keywords.  Do not use yet as default
      behaviours for SPREDUCE1D.

opfiles/opFibers.par: New file with trace parameters, generated by
      OPFIBER_GENERATE and to be used by TRACE320CRUDE.

-------------------------------------------------------------------------------
v5_4_20 (2010-10-27)
Tag for SOS S/N changes (ticket #1116).
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

TRACE320CRUDE: Added lines to ignore rows with invvar all zero (ticket #1025)

bin/sos_apospammer: Added Stephen Bailey to SOS log spam list.
bin/updatePluggingStatus: Update help message.
examples/opLimts.par: Change S/N^2 limits to 10 (blue) and 22 (red cameras),
      as per ticket #1116.

-------------------------------------------------------------------------------
v5_4_19 (2010-09-13)
Tag to fix a number of bugs, esp. ticket #1043
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

APO_APPENDLOG: Use COPY_STRUCT_INX to copy into an existing data structure,
      rather than an assignment that could fail if structures are different.
APOD: Fix logic for re-reducing good arcs that precede good flats.
APOREDUCE: Last tag replaced one instance of 'gs' with '/usr/bin/convert', but
      do the second instance too.
      Print the stdout and sterr from the call to convert.
QUICKBIAS,QUICKEXTRACT,QUICKTRACE,QUICKWAVE: Explicitly set types of all
      output structure elements, which may help address ticket #1043.
QUICKEXTRACT: Force data type of EXPTIME and SKYLEVEL to be floating-point.
      The ICC changes can result in an EXPTIME that is either float or double,
      and that gets propogated through and can result in a data-type mismatch
      (ticket #1043).
      to type double.  It appears this is the variable that is k
READSPEC: Restore ability to read SDSS spectra, particularly the SDSS-I
      photoPosPlate files.
SDSSPROC: Failed on line 363 if passing this routine an array of filenames,
      even a 1-element array.  Internally recast INFILE as a scalar to
      protect against that case (although never encountered in the pipeline).

bin/sos_apocontrol:  stopKill now kills all child processes when called.  This
      will (hopefully) kill any stuck idl jobs.

-------------------------------------------------------------------------------
v5_4_18 (Sep 11, 2010) idlspec2d
Tag for SOS critical bug (ticket #1034).
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

APO_APPENDLOG: Change timeout to 200 sec (was accidentally 400 sec).
APOREDUCE: Use 'convert' instead of 'gs' to convert PostScript plots
      into JPEGs.  Write to a JPEG file that is uniquely named per
      exposure+camera, and then rename with a call to "mv" to make it
      atomic and prevent 4 jobs from writing to the same JPEG file at once.
      Put that job in the background instead of waiting for it to complete.

-------------------------------------------------------------------------------
v5_4_17 (Sep 7, 2010) idlspec2d
Tag for SOS bugs (tickets #636, 797, 1017, 1022 addressed at some level).
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

APO_APPENDLOG: Timeout after 200 sec, at which point a frame might be
      reduced but it will not be added to the log file or plots.
      This might help address tickets #1017, #797, or at least provide
      more info in the SOS logs about a possible problem.
APOD: Search for gzipped sdR files.
      Add logic to reduce an arc preceding a flat (untested).
COMBSMALLCOLLIMATE: Remove test lines that accidentally changed the offsets.
      Apodize the top and bottom of the image to be robust against an arc
      line fallling near the edge of the active region.  (Ticket #1022).

bin/rundaily: Wait for the current MJD to show up in $DAILY_RAWDATA_DIR
bin/rundaily_riemann_script: Use environment variables RUN2D,RUN1D.
examples/opLimits.par: Define XMID to 2036 2045 2043 2044 based upon
      Kaike Pan's posting on 7 Sep 2010 to be more consistent between
      the blue and red cameras (ticket #636).

-------------------------------------------------------------------------------
v5_4_16 (Sep 6, 2010) idlspec2d
Tag for critical bug fix for SOS (ticket #1012).
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

bin/loadSN2Value,updatePluggingStatus: Back out to previous version,
      since changes were made for a new version of platedb that does
      not yet exist.

-------------------------------------------------------------------------------
v5_4_15 (Sep 4, 2010) idlspec2d
Tag for critical bug fix for SOS (ticket #1005).
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

APOALL,APOREDUCE,QUICKBIAS,QUICKEXTRACT,QUICKREDUCE,QUICKTRACE,QUICKWAVE:
      Allow APOALL to run without generating lock files in the raw data
      directories.  Pass this as a /NO_LOCK keyword to APOREDUCE, and then
      pass /DO_LOCK to the subroutines.
APOREDUCE: Do not send any Hartmann exposures (full frame or subarray)
      to the QUICKWAVE routine.  This is to address the problems
      in ticket #1008.
COLLIMATE,COMBSMALLCOLLIMATE: Change offsets to gives same results as
      COLLIMATE using data taken on MJD 55440
COMBSMALLCOLLIMATE: Include calls to FITS_WAIT() before reading the file
      to make sure that they're completely written (ticket #1005).
      Test every 5 sec, and timeout after 30 sec.
SPCOMBINE_V5: Remove reading RUN2D from the spPlancomb file, since it
      is unused.
QUICKEXTRACT: Increase the tolerance at which to report a flexure error
      message from 0.5 pix to 1.0 pix.  Ticket #1009.
ZPLOT: Change to work for BOSS targets.

bin/loadSN2Value,updatePluggingStatus: Update to use the new version of platedb
examples/opLimits.par: Change the WAVEMID value for r2 from 8071 to 8053,
      to better fit what Kaike Pan found to be consistent with b2 position.

-------------------------------------------------------------------------------
v5_4_14 (Aug 26, 2010) idlspec2d
Tag for testing new galaxy templates in Spectro-1D.
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

SPREDUCE1D: changed back to NPOLY=3, optimal for new galaxy templates.
templates/spEigenGal-boss_v0_new1.fits:
  New BOSS-based tempaltes from Yanmei Chen
INSPECTGEN: Update to be consistent with the suggested Data Model, which
      is what is tested with INSPECT_VERIFY.
loadSN2Value, updatePlugginStatus:  update to use new version of platedb
UPDATE_PLATELIST: The auto-generated "platequality" is used for plates
      being added if they didn't already have a quality in the file.

-------------------------------------------------------------------------------
v5_4_13 (Aug 5, 2010) idlspec2d
Tag for testing patches to Spectro-2D and npoly changes to Spectro-1D.
Built against specflat v1_12, elodie v1_3, idlutils v5_4_19.

AESTHETICS: New routine for filling in bad values for COMBINE1FIBER.
ATVSPEC: New proc for displaying cutouts of raw images around specified
      wavelengths.
COMBINE1FIBER: Call new routine AESTHETICS, but no change in default behaviour.
CONFIGURATION__DEFINE: Change spcalib_xy2traceset_ncoeff from 4 to 7
      for the polynomimial order of fitting the traces in the call
      to XY2TRACESET in SPCALIB (ticket #845).
      Change the initial guess for the sigma of the optimal extraction
      in the spatial direction from 1.4 pix to 1.0 pix (spcalib_sigmaguess).
      This is because there is only 1 iteration on this fitting, so it may
      not otherwise converge to the correct result.
      Change spcalib_sigmaguess to 1.15, a compromise BOSS value since
      range is approx. 0.85 to 1.35.
FLUX_DISTORTION: Use only standard stars for the flux-distortion maps,
      requiring at least 10 objects (instead of 50).  This will not work
      with SDSS-I data, but will remove the strangeness of using galaxies
      on BOSS plates.
      Increase the number of iterations in MPFIT from 50 to 200 (ticket #938).
GUIDERPLAY: Wrapper for IDL guider to simply allow play-back of images
      for a specified night.
IDLSPEC2D_VERSION: Back out to the previous version, since this does not
      report the svn version number in the case of untagged code.
      For that, we call the idlspec2d_version bash script (with a spawn).
INSPECT_VERIFY: New proc for testing the format of spInspect files.
LOGSHEET: Add /COLLIMATOR option to print the collimator motor positions.
PCA_GAL: Call AESTHETICS for filling in bad values.
      Add a table of input spectra to the eigenspectra files.
PLATEMERGE: Added EXCLUDE_CLASS and SKIP_LINE functionality.
PLOTSPEC: Fixing Ticket #926 /ALLEXP bug and odd feature.
PLUGHISTORY: Plot out to fiber #1000 for BOSS cartridges.
READPLUGMAP: Change PSF/fiber flux ratios from computed numbers to
      fixed constants. For 2 arcsec fiber fluxes, these constants
      are [2.085, 2.085, 2.116, 2.134, 3.135]. For 3 arcsec fiber
      fluxes, they are [1.343, 1.336, 1.354, 1.363, 1.367].  Ticket #906.
SDSS_SPEC_IMAGE: Ignore greater than 1 micron for plot limits.
SPCALIB: Fix a bug introduced in v5_4_7 with the re-write of FITARCIMAGE,
      where bad lines (marked as such in REJLINE) were passed along
      to FITDISPERSION.  This fixes ticket #823.
      Change MAXDEV from 0.15 pix to 1.0 pix inthe call to TRACE320CRUDE.
      This fixes ticket #845.
SPCOMBINE_V5: Modify the fix implemented in v5_4_8, and discard all data
      from a given spectrograph if there is a camera with no good files.
      This retains the behaviour of discarding sp2 data for MJD 55290-55299
      when r2 was dead (ticket #764).  But it retains sp2 for plate
      3817/55276 when only two images are missing (ticket #787).
SPREDUCE1D: Lowered NPOLY from 3 to 0 for galaxies, and 3 to 0 for QSOs,
      and 4 to 1 for stars.
      Commented out MANY_OUTLIERS flag setting (ticket 955).

bin/sos_runnerd.py: Write a version string a file so the running version
      can be determined
opfiles/boss_cartridge15_gaps.txt: added file with measured bundle gaps
      for BOSS cartridge 15 (see ticket #817).
opfiles/spInspect-0000-00000.par: Template for spInspect files.
templates/spEigenGal-boss_v0_new1.fits: Add Yanmei Chen's BOSS galaxy
      eigentemplates
templates/spEigenGalNew-55399-baw-mean.fits: Test template file using the 'mean'
      setting of aesthetics.pro.
      Changed filename (from spEigenGal-55399-baw-mean.fits) so as not to
      not be found automatically by the wildcarding in the 1D code.

-------------------------------------------------------------------------------
v5_4_12 (May 31, 2010) idlspec2d
Tag for new S/N fits for SOS, and revert to SDSS-I templates in Spectro-2D.
Built against specflat v1_11, elodie v1_3, idlutils v5_4_13.

APOALL,SLITHISTORY,SPECDB_CREATE,SPPLAN2D: Change references to
      the now-defunct $ASTROLOG_DIR directory to $SPECLOG_DIR.
BOLTON_SN_FIT: new low-level routine for (hopefully) robust
      estimation of exposure SN.
FITSN: Another major change to how the S/N lines are fit.  Force the fit
      to be a line with a fixed slope (as specified in opSNlimits.par),
      and choose the offset such that half the points are below and half
      above in the fitting magnitude range.  Call this a "median line."
      This addresses ticket #754, but really continues ticket #750.
PLATE_SPEC_IMAGE: Smoothly die if zans is missing.
PLOTSN: Sort the points randomly, such that not all the spec2 points
      are plotted on top of the spec1 points, and make the points smaller.
PLUG2TSOBJ: Read photoPosPlate files instead of photoPlate files.
      This addresses ticke #809.
QUICKWAVE: Always generate the fiber-flat vectors for the corresponding
      flat-field image, even if that fiber-flat already exists.  If it
      exists, it gets over-written.  This is confusing behaviour, and
      might do bad things in some cases, but addresses ticket #831.
SDREPORTMAKE: Remove this now-unused piece of code.
SPCOADD_V5: Delete QUALITY,REQTIME keywords (ticket #789).
SPREDUCE1D: Back out last change to use Bolton's new spMLpca templates
      and change the default of chop_data back.
TRACE_SPARSE_CRUDE: New semi-crude, semi-robust sparse flat tracing routine.

opfiles/opSNlimits.par: Changes to be consistent with FITSN.  Remove
      the fiducial_coeff field which was unused.  Add a slope which is
      set to -0.30 for all cases.  The fitting mag range is set to be
      the range [snmag-1,snmag] for the new, median-line fits.

-------------------------------------------------------------------------------
v5_4_11 (May 16, 2010) idlspec2d
Tag to test spMLpca templates (bug fixes to last tag)
Built against specflat v1_11, elodie v1_3, idlutils v5_4_13.

BATCHPBS: Fix typo on naming script files with /skip2d option.
SDSS_SPEC_IMAGE: Change flat to target.
SPREDUCE1D: Modify to test Bolton's new spMLpca templates, and change
      default of chop_data to 3600 to 10000 Ang.

-------------------------------------------------------------------------------
v5_4_10 (May 15, 2010) idlspec2d
Tag to test spMLpca templates
Built against specflat v1_11, elodie v1_3, idlutils v5_4_13.

BATCHPBS: Add /SKIP2D option.
BOLTON_MLPCA,BOLTON_MLPCA_DEMO: New proc with Bolton's maximum-likelihood PCA.
COMBSMALLCOLLIMATE: Document explicitly outputs (with /SIMPLE) to be read by
      telescope control SOP code.
PLATE_SPEC_IMAGE,SDSS_SPEC_IMAGE: New code for making JPGs of spectra (Blanton).
PLOTSPEC: Along with printing the target flags, print whether it is 'SKY'.
PLUGHISTORY: Update to work with BOSS cartridges 10-17 with 1000 fibers.
SPTHROUGHPUT: Return correct number of vectors if INDX not set.
UUPLOTSPEC: Modified version of PLOTSPEC for interfacing with an online
      database at http://boss.astro.utah.edu (Brownstein).

pro/Makefile: Add templates directory.
pro/templates: Files (code + data files) for generating Bolton's new templates,
      but need to clean this up.
templates/spMLpcaCVstar-55332.fits,spMLpcaQSO-55332.fits,
      spMLpcaGal-55332.fits,spMLpcaStar-55332.fits:  New templates
      to test from Bolton.  Galaxies span [1800,10020] Ang, QSOs [580,9963] Ang,
      stars [3580,10318] Ang, CV stars [3581,10315] Ang.

-------------------------------------------------------------------------------
v5_4_9c (May 5, 2010) idlspec2d
Tag for SOS with gzipped files.

APOFIX: Remove references to $ASTROLOG_DIR, instead using $SPECLOG_DIR.
      New keyword SOS_DIR?  Put back in code to edit the logsheet-$MJD.fits
      file when the quality of an exposure is changed.
APOREDUCE: Report "WARNING" message if the HARTMANN header keyword is
      set to either "Left" or "Right".  Note that this creates a lot
      of unnecessary warning messages on the SOS web page.
BESTFOCUS: Allow images where the shift was more than 2.5 pix (those were
      intentionally ignored previously).
COLLIMATE: Call COMBSMALLCOLLIMATE if the SUBFRAME keyword exists in
      the header.
COMBSMALLCOLLIMATE: New fast collimate routine to focus
      sp1 and sp2, uses subarray readouts, single region, and splits the
      difference between red and blue offsets.  Called by "sop doHartmann"
      as part of the new field acquisition.
SMALLCOLLIMATE: New routine.  Don't know how this differs from the other
      collimation routines?

bin/filecheck.py, sos_redorunner, sxpar.py: Read gz files
bin/getPlugmap: Get plugmaps for multiple-pointing plates, assume "A"
      pointing if not specified.
bin/putils.py: Add openRead to open a normal or gz file for reading.
bin/run_collimate.csh: Print more blank lines.
bin/rundaily_riemann: Bug fix (typo).
bin/rundaily_riemann_script: Bug fix for env variables (typo).
bin/sos_apocommand: Add quality type to error message.  Add directory
     as well as files.
bin/sos_apocontrol: Added print statement of options.
bin/sos_aporedo,sos_apostart: Work with gz files and filesequencer
bin/sos_filesequencer: Handle cases where files need to go into aporeduce not
     in the order the come out of the icc.  Right now it special cases
     arcs and flats.  Then changed the code to allow all arcs, but switch
     the order if the arc comes in before the flat.
bin/sos_runnerd.py: Display output of svn commands to log.
bin/sxpar.py: Work with gz files.
examples/opLimits.par: Enlarge all the ranges for XMID and WAVEMID.
     Further analysis reveals that the scatter in wavemid is larger than
     the original constraints and producing a lot of warnings that are being
     ignored.  Following figures from David Harris that show scatter, change
     limits to have center at WAVEMID= 4908 4995 7987 8071
     Issue warning if more than 10 Ang from these best values, and error if
     more than 20 Ang (red) and 15 Ang (blue).

-------------------------------------------------------------------------------
v5_4_9a (Apr 30, 2010) idlspec2d
Tag before SOS changes for gzipped files.

APOFIX: What changed ???
BATCHPBS: Add QUEUE keyword to specify the queue for qsub
PCA_GAL: Add /FLUX and /REPLACE keywords.  The /FLUX option loads in
     a save set from a previous call with this option???
PCA_SOLVE: Added FLUX keyword
PLATELIST: Tiny html fix.
PLATEMERGE: Target flags should be 64-bit (type LONG64).
      Bug fix to select correct RUN2Ds when several exist in the platelist file.
SPCALIB, SPREDUCE, SPREDUCE2D: Add /writeflatflatmodel to call to
      SPREDUCE2D to add the model image for flat-fields to the spFlat files.

bin/filecheck.py: Test for quality=test|excellent fits files.  Fixed bug
      if there is no keyword.
bin/loadSN2Value,updatePluggingStatus: Now update quality on --update
bin/putils.py: Change method of executing commands and handling svn.
      Now command output is displayed as the command executes, not all
      when it finishes.  Files are not added to svn as they are created,
      but right before check-in.
bin/rundaily: Send output of getWikiMJD to the bitbucket.
bin/rundaily_riemann_script: Use env variables that are set in .bashrc .
bin/sos_apocommand: Skip all non-excellent images and test exposures.
      (But not actually done, see ticket #684).
bin/sos_apocontrol: Run a status after start.
bin/sos_aporedo: Outout b1 in real time and wait for all processes to complete.
bin/sos_runnerd.py: Changed method of executing commands and handling svn.
      Now command output is displayed as the command executes, not all
      when it finishes. Files are not added to svn as they are created,
      but right before check-in.

-------------------------------------------------------------------------------
v5_4_9 (Apr 16, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tag to fix install problem.
Built against specflat v1_11, elodie v1_3, idlutils v5_4_13.

opfiles/Makefile: Need Makefile for install.

-------------------------------------------------------------------------------
v5_4_8 (Apr 16, 2010) idlspec2d tested on IDL 7.0 - 7.1
Substantial bug fixes to SOS scripts.
Spectro-2D uses photoPlate files in new directory tree.
Built against specflat v1_10, elodie v1_3, idlutils v5_4_13.

APO_LOG2HTML,APO_PLOTSN,APOREDUCE: Replace "APO Spectro" with "BOSS Spectro".
APO_PLOTSN,EXTRACT_OBJECT,FITSN,PLATESN,PLOTSN,QUICKEXTRACT:
      Consolidate all the fitting magnitudes into one parameter file,
      and use FITSN to reference that file.  This is to address ticket #750
      and ticket #749.
APOFIX: Bug fix.  Add /EXCELLENT keyword.
APOREDUCE: Copy the single-exposure S/N plot to the COPYDIR directory
      (ticket #675).
BATCH1D,BATCH2D,DOSCATFIT,EXTRACT_ROW_SAFE,FIT_TSET,FITARCIMAGE_OLD,
      FLATINTERP,FUNCCHEB,GAUSS_SMOOTH,LOCATESKYLINES_TEST,MONSTER,
      MYFLUXCALIB,READ2DOUT,READSMEAR,SPCOADD_FRAMES,SPCOMBINE,SPFLUX,USHIFT:
      Remove unused code.
BATCHPBS: Call new proc SDSS_PLATE_SORT to generate the photoPlate files.
FINDSPEC: Allow this to work with different plugmap structures by
      just explicitly using fiberid,ra,dec.
      Trim whitespace on run2d,run1d.
FITFLATWIDTH: Assume bundles have 20 fibers, and get rid of numbundles keyword.
LEDFLAT: Major changes to loop through each pixel, computing statistics
      using a subset of the best images for each pixel.
PCA_GAL: Add headers and other minor fixes.
PLATELIST: Exclude runz subdirs from searches for run1d files.
PLOTSN: On right-hand plots, only plot the objects used in the fit range
      and not all the faint, noisy points.
      Add SNMIN keyword, and default to 0.5, to exclude all the very
      low-signal fibers from the fitting.  Addresses ticket #754, although
      with the a simple solution rather than a well-motivated one.
      Show the fit line for each spectrograph.
PLUG2TSOBJ: Only look for photoPlate files in plate redux directory,
       and not in subdirectories.
QUICKEXTRACT: No need for config.
       Issue flexure warning only if larger than 0.5 pix, not 0.25 pix.
QUICKTRACE: Remove "Argon in flats" message until its triggering can be
      tracked down (ticket #755).
SDSS_PLATE_SORT: New proc for sorting photoPlate files to be the same
      as a given plugmap.  This addresses ticket #721.
SDSSPROC: Remove CHECKSUM,DATASUM keywords from headers so that they are
      not propogated to downstream files (ticket #756).
      Measure gain values for the new r2 CCD from LED flats #113197-113198,
      to be used starting on MJD 55300 (13/14 April 2010).
      The exact location, width, and counts of the serial transients
      appear to be different on the new r2 CCD as compared to the old
      r2 CCD. These values have been appropriately updated in
      SDSSPROC->SDSSPROC_BADFORMAT for starting on MJD 55300 (ticket #766).
SPCALIB: Remove deprecated keyword in FITFLATWIDTH.
SPCOMBINE_V5,SPFLUX_V5,SPFLUXCORR_V5,SPCOADD_V5: Clean up code to not
      pass the number of pixels in images, but compute based on the images.
SPCOMBINE_V5: Hack to limit the combine to either b1+r1 or b2+r2 in the
      case where any images from one of the cameras is missing.
      This addresses ticket #764, but in an inelegant way.
SPPLAN1D: Get rid of unused file name definitions.
SPREDUCE: Look for photoPlate files in current reduction directory,
      rather than using env variables to determine.
SPTHROUGHPUT: Remove hard-wired number of fibers.

bin/loadSN2Value,updatePluggingStatus: Better db error-handling.
bin/sos_aporedo,sos_redorunner,sos_runnerd.py:
      Results have an option to now go into
      http://sdss3.apo.nmsu.edu/~observer/sosredo/logfile-current.html and
      /data/boss/sosredo.
etc/BG14.txt,FG3.txt,altbg14.txt,blue.bkpts,brg.08.gk.01,f8v.ab,f8vspline.dat,
      fluxcorr.bkpts,intrinsic1.dat,intrinsicF2.dat,red.bkpts:
      Remove unused files.
Makefile: Add opfiles subdirectory.
examples/opLimits.par: Increase the values for XSIGMA based upon the
      best achievable on MJD 55300.  Yellow at 1.10 1.15 1.10 1.25 (b1 b2 r1 r2)
      and red if 0.05 worse than tose values.  Decrease the values for
      WSIGMA to yellow at 1.05 in all cameras, red at 1.15.
opfiles/opSNlimits.par: New file for tracking the S/N-fitting magnitudes.

-------------------------------------------------------------------------------
v5_4_7 (Mar 31, 2010) idlspec2d tested on IDL 7.0 - 7.1
Substantial changes to SOS scripts.
New Spectro-2D with rewrite of wavelength fits and use BOSS pixel flats.
Built against specflat v1_9, elodie v1_3, idlutils v5_4_13.

APOD: New cheat script for running SOS at Apache Point (not documented).
APOFIX: Update default astrolog_dir.  Remove all of the code to edit
      the APO logfile, and instead spawn a call to sos_aporedo.
APO_LOG2HTML: Include links to S/N plot for each individual exposure.
APO_LOG2HTML,APOREDUCE: Include cartid in the last HDU of the logfile,
      and display on the web page.  This does change the data model for
      the logfile, meaning that we cannot have this and the previous
      version of SOS writing to the same file.
APO_PLOTSN,APOREDUCE: Generate S/N plots for individual exposures as well
      as for the full plate.
ARCFIT_GUESS, EXTRACT_IMAGE, GEN_SCATTER, MYFLUXCORR, SKYSUBTRACT,
SMOOTH_HALO2D, SPFLUX_READ_KURUCZ, VDISPFIT, ZCOMPUTE, ZCOMPUTE_QSO:
      Commented out some print updates that were making the PBS log files
      large (all those with string(13b)).
APO2D,QUICKTRACE,SPREDUCE: Simplified call to READPLUGMAP, and remove
      call to SORTPLUGMAP.
APOREDUCE: Get airtemp from the MC1TEMDN or MC2TEMDN keyword for BOSS,
      since the AIRTEMP keyword does not exist.
APOREDUCE,APO_PLOTSN: No need to use the configuration file to determine
      the number of fibers.
BATCHPBS:  Add option to join stderr and stdout in log file (kushner)
      Create a set of files per MJD observed, even though they should be
      identical.
COLLIMATE: Report failure if Hartmann's not in proper sequence - KD
COMBINEBPM,FLATFIELD: New routines for generating BOSS pixel flats from LED
      images (Olmstead).
CONFIGURATION__DEFINE: Increase spcalib_trace320cen_deltax by a small
      amount for the r1 camera to be consistent with the median solution.
FIND_RESOLVE: Bug fix for 3-digit plate numbers.  Deprecate, putting the
      logic internal to PLUG2TSOBJ, which is the only place this was called.
FINDSPEC: Make consistent with platelist files.
FITARCIMAGE: Major changes to the iteration of the fitting and the
      tracking of rejected arc lines.  Iterate the full fits, rejecting at
      most 1 arc line per iteration.  Track the reason for rejecting lines
      and return in REJLINE.  Final fits are done where the higher-order
      terms in the trace-set are replaced with polynomials (cubics).
      Those final fits use the actual centroid locations + errors, rather
      than the "replaced" positions (as was done in the last version of this
      code).  Using the actual centroids should be fine with the smoothed
      higher-order terms.
      Warning message if Cd I 3610 lamp not good (ticket #641).
      Issue warning about big wavelength gap is bigger than log10=0.05
      instead of 0.04, such that a gap between 3650-4046 is barely OK.
      Comment back in the failure if log10>0.10.
      The fits were sometimes being effected by a fiber with very bad
      fits, where loglam would be nonsense values.  The floating point
      precision was then making the fits to all of the fibers much noisier.
      An example of this was on palte 3651/55246 on the frame
      sdR-b2-00108656.fit .  For such bad fibers, always interpolate over
      those fiber coeffs before calling traceset2xy.
FLUX_DISTORTION: Bug fix where some values of 320 that represented the
      plate radius in mm were replaced with the number of fibers.
      Change those numbers to 325 mm to avoid future mis-interpretations.
      Change MINFLUX to a 5-element array, with the minimum flux reduced
      from 5,5,5 nmy in gri-bands to 2.5 nmy in r-band.
IDLSPEC2D_VERSION: Replace spawn to shell script bin/idlspec2d_version with IDL
      (Weaver).
LEDFLAT: New proc for making pixel flats from Natalie's LED flats.
LOGSHEET: Print timestamp from TAI-BEG in header, since TAI keyword no
      longer exists.
PCA_GAL: Updates from Weaver.  Add optional BINSZ keyword.
PLATELIST: Include all of the GAL_CMASS* flags for the high-z LRGs.
PLATELIST,UPDATE_PLATELIST,UPDATE_PLATE_RELEASE: Move the spPlateList.par
      files from this product to the speclog product.
PLATEMERGE: Changes to the outputs in the ASCII file, make shorter aliases
      for some of those ASCII headers, and trim unneccessary whitespace
      from the string values.
      Include manual redshifts and comments from spInspect files.
      Include more values from the new plugmaps (lambda_eff,bluefiber,zoffset).
      Make the new target flags 64-bit (bug fix).
      Add /INCLUDE_BAD option.
PLATESN,PLOTSN: Make the fiducial magnitudes all brigher by 0.80 mag, so that
      one is analyzing w.r.t. the same magnitudes as SOS.  PSF magnitudes
      are used for stars here, whereas fiberflux2 are used for SOS.
PLOTSPEC: Smooth flux values for /allexp option.
PLUG2TSOBJ,READPLUGMAP,SPREDUCE: Fix and simplify finding photoPlate files,
      insisting that one exist for each plate+MJD that a plate is observed.
QAPLOT_ARCLINE: Plot rejected arc lines (in red).  Make sure all arc lines
      show up in the lower plot by at least putting a point near the location.
QAPLOT_SKYSUB: Plot median |chi| rather than chi^2, and compare to Gaussian.
READONESPEC: Work with either the 2048-row SDSS-I spectra or the 4128-row
      BOSS spectra (but still assume same number of rows in blue or red).
READPLUGMAP: Do the sorting internal to this routine, rather than a later
      call to SORTPLUGMAP.  Include SPECTROGRAPHID,FIBERMASK to call.
      Fix crash condition in ticket #604.
      Demand that FIBERMASK is not already set.
READSPEC: Add optional output ZMANUAL.
      For cases where the data files cannot be found, default to either 640
      or 1000 blank rows in the outputs based upon MJD, with 1000 fibers
      assumed for data starting on MJD 55025.  (One-line change at line 206.)
SDSSPROC: Bug fix for ticket #610 in identifying the pixel shifts.
      There was a bug in defining one of the overscan transients in the b2 CCD
      (line 144).  Aside from that, the transient is not always easily detected
      in all rows.  The somewhat hacky solution is to apply the same shift
      (or no shift) to any row where the transient is not easily measured.
      Re-organize to call much of the code, like bias and flat-subtraction,
      for either SDSS or BOSS data.
      Look for compressed pixel bias or pixel flat images.
SORTPLUGMAP: Remove this routine, and make it internal to READPLUGMAP.
SPADD_GUIDERINFO: If this is an old SDSS-I file, then the timstamps are all
      offset and need correcting; if BOSS, then no corrections.
      Test that FWHM values are not NaN.
SPCALIB: Print proftype.
SPCALIB,SPREDUCE: Add REJLINE to the ARCSTRUCT structure, allowing one to
      include rejected arc lines in the QA plots.
SPCALIB,QUICKWAVE: Remove numberBundles in call to FITARCIMAGE.
SPCOADD_V5: Remove unneccesary keyword to FLUX_DISTORTION call.
SPMANUAL: New function to read manual inspection files (spInspect).
SPREDUCE1D: Replace spawn of Unix mkdir command with FILE_MKDIR.
SPTHROUGHPUT: Fix directory structure for BOSS.
SUPERFLAT: Change min + max wavelength ranges such that it spans the range
       that includes at least one good pix.  Bug fix in computing the
       flux scaling between the fibers.

bin/sos_apocommand: Process all images, even non-BOSS images
bin/rundaily, rundaily, rundaily_riemann_script: Always exit zero so as
       not to upset cron.
bin/sos_redorunner, sos_aporedo, sos_aporedomakecmd: New re-do command
bin/sos_apostart: Don't sued nuce.
bin/rundaily_riemann_script: Added /zcode.
bin/sos_runnerd.py: Only do svn ci durring bookeeping.
bin/sos_runnerd.py, sos_classes.py: Add exposure number option.
bin/loadSN2Value, updatePluggingStatus: New code to load S/N^2 values
       into platedb.
doc/www/spectroSOS.html: Update SOS stop / restart instructions.
       Document warning message pertaining to ticket #641.
etc/lamphgcdne.par: Add back in the lines as 3650+3654 and do not mark
       as blends, so that the 3650 line can be used when the 3610 line
       is too faint (ticket #644).  Also add back in 6506, 8408, 9313 lines
       since the code is more robust against bad lines now.  Add new
       lines at 9657, 9784 (both faint Ar I lines).
etc/spPlateList.par: Move this file to $SPECLOG_DIR/opfiles.
examples/opLimits.par: Update WAVEMID values for sp2 to center up
       the new collimator masks (ticket #636).
pro/Makefile: Add specflat subdirectory.
src/Makefile: Make compatible with GNU make (Weaver).
ups/idlspec2d.table: Added setupOptional("platedb")

-------------------------------------------------------------------------------
v5_4_6 (Feb 9, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tagged to fix critical ticket #600 on SOS.
Built against specflat v1_8, elodie v1_3, idlutils v5_4_12.

Major environment change: Global replace of SPECTRO_DATA -> BOSS_SPECTRO_REDUX
(B. A. Weaver, 2010-01-26)

BATCHPBS: Typo fix for making match files.  Add /ZCODE option to setup up
      and run Zcode.
BESTFOCUS: Dawson and Olmstead code for solving for CCD focal plane.
CCDTILT: New proc to measure CCD tilt from a whole sequence of Hartmanns,
      based upon the COLLIMATE routine.
CHUNKINFO: Read info from $PLATELIST_DIR/platePlans.par file.
FINDSPEC: Warning message for missing files.
PLATELIST: Fix bug finding the spDiagcomb file.
      Fix umask for the PBS log files (Weaver).
      Add interpretation of the BOSS target flags, and include
      %LRG1,%LRG2 in the outputs.
      Include SURVEY, PROGRAMNAME, CHUNK and remove PROGNAME,CHUNKNAME.
      Also included are TILE, RACEN, DECCEN, EPOCH from platePlans.par
      since those are probably more trusted than other sources.
      Include N_TOTAL as total number of objects (640 or 1000).
PLATEMERGE: Optional calling sequence with RUN2D rather than with PUBLIC.
      Read all input data from READSPEC instead of other various wrappers.
PLUG2TSOBJ: Simplify to only support photoPlate and calibPlateP files.
      Remove PLUGMAP option and add RUN2D option.
READSPEC: Small changes to support change to PLUG2TSOBJ.
SPREDUCE: Read TILEID from the plugmap file, since it is no longer
      in the sdR file headers (ticket #562).
TRACE320CRUDE: Bug fix for when only a few good pixels exist in a row
      (ticket #600).

bin/rundaily, rundaily, rundaily_riemann_script: Scripts for after daily
       data transfers.
bin/sos_apospammer: Updated to roll log and reset error messages.
etc/spChunkList.par: Remove file, as this is deprecated by
      $PLATELIST_DIR/platePlans.par
examples/opLimits.par: Remove the warnings for SUCCESS_QSO in the platelist.

-------------------------------------------------------------------------------
v5_4_5 (Jan 23, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tagged to fix batch processing of BOSS data.
Built against specflat v1_8, elodie v1_3, idlutils v5_4_12.

APO_CHECKLIMITS: Different font formatting (Weaver).
BATCHPBS:  Add automatic plate matching (Weaver), but adds dependency
      on the sas product.
EXTRACT_OBJECT: Fix bug where FRAMESN2 was being set to 1 instead of 0
      when there was no flux on an exposure.
GET_MJD_DIR: Use FILE_SEARCH() instead of calls to SPAWN, and only
      return directories and not file names.
PLATELIST: Support new RUN2D,RUN1D directory structures.
      Put RUN2D,RUN1D in the html files rather than PROG,CHUNK.
      Switch from html to xthml (Weaver).
      Only mark plates as 'bad' or 'good', not 'marginal' (too confusing).
PLOTSPEC,READSPEC,READONESPEC: Add support for RUN2D,RUN1D.
READPLUGMAP: Remove PSFFLUX*,FIBERFLUX*,FIBER2FLUX*, since those appear
      to all be zeros in the platelist files.
SPCOMBINE_V5: Accidentally had removed setting the name of one plot file.
SPREDUCE2D: Fix mis-formatted names for output log and PostScript files.

bin/sos_apostart,sos_apocontrol: Added a delete for the socket file.
      Created more descriptive error and warning messages
bin/sos_apocontrol: Update stop messages.
pro/Makefile: Include all the pro/science subdirs.

-------------------------------------------------------------------------------
v5_4_4 (Jan 18, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tagged to allow batch processing of BOSS data.
Built against specflat v1_8, elodie v1_3, idlutils v5_4_10.

pro/Makefile: Turn this into a common makefile for all subdirs.
pro/*/Makefile: Remove these old makefiles.

-------------------------------------------------------------------------------
v5_4_3 (Jan 17, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tagged to allow batch processing of BOSS data (but crashes).
Built against specflat v1_8, elodie v1_3, idlutils v5_4_10.

BATCHPBS: Remove accidental return before calling qsub.
SPREDUCE2D,SPCOMBINE_V5: Fix typos.

-------------------------------------------------------------------------------
v5_4_2 (Jan 17, 2010) idlspec2d tested on IDL 7.0 - 7.1
Tagged to allow batch processing of BOSS data (but crashes).
Built against specflat v1_8, elodie v1_3, idlutils v5_4_10.

READSPEC,SPREDUCE1D,READONESPEC,SPCOMBINE_V5,SPPLAN1D,SPREDUCE,
      SPPLAN2D,SPREDUCE2D: Implement new data model for directory
      structure that makes use of $RUN2D and $RUN1D subdirectories.
      Remove some of the file name declarations in the plan files
      in preference to generating those just based upon plate+MJD.
APO_COLOR2HEX: Change the yellow color from a bright yellow that's hard
      to see to a darker yellow.
APO_LOG2HTML,APOREDUCE: Generate a JPEG file instead of a GIF.
APO_PLOTSN: Change fit magnitudes passed to PLOTSN from 20.33 to 22.0 in g-band
      and from 20.06 to 20.0 in i-band, and set the other unused bands to zero.
APOREDUCE: Create output directory if it does not exist.
ARCFIT_GUESS: Allow more than 4 coefficients in initial wavelength solution.
BAD_BOSSFORMAT: New routine to search for shifted rows in raw images,
      like on MJD 55176 exp #104648,104652
BATCHPBS: New proc for batching both Spectro-2D and Spectro-1D with PBS.
BOSS_GAIN: New proc for computing gains on BOSS CCDs.
COLLIMATE: Display specific commands for observers to cut & paste.
      Simplify the basic call to this routine to compute the Y offsets
      in a hard-wired region in the center of each CCD.  The offset maps
      are produced only if the /DOPLOT option is set.
      Tested against BOSS data on MJD 55113, and SDSS-I data on MJD 54932.
      Changed calibrations that convert from pixel shifts to offsets.
      Test for proper values of FFS, NE, HGCD in headers.
CORRECT_CROSSTALK: Include crosstalk correction in the spec2d processing chain
EXTRACT_OBJECT: Evaluate the S/N at fainter mags: change from g,i=20.2,19.9
      to 22.0,20.0.
FITARCIMAGE: Filtering of initial crude centroids was done with xy2traceset
      with only 3 coefficients, which is too few for BOSS.  Change to
      using the value of NCOEFF (line 224).
      Add more traceset fits at the end, rejecting arc lines that are too
      noisy or too far offset from the solution.  Do the final fit by
      weighting each line by its scatter from the previous solution.
FITSN: Change magnitudes to fainter values.
FITDISPERSION,FITFLATWIDTH: Return the medians in each quadrant
      excluding masked portions of the CCD.
FITFLATWIDTH: Generate a mask that is the same within each bundle
      before sending the width to the trace-set fitting.  This fixes a
      crash condition on plate 3538/55124-r1, where there was a fiber
      with only a few unmasked pixels that was getting a crazy fit.
      For the case of no input mask (INMASK), then generate a mask
      to use only good pixels.
GUIDERMONFILE: New procedure to create guiderMon file using proc-gimg files.
IDLSPEC2D_VERSION: Now have this just call the shell script idlspec2d_version.
LOCATESKYLINES: Do not use any sky lines that don't have at least 80%
      good centroids.  This mattered for 3790/55208-b1, where the line
      at 6363 Ang was only being well-fit in a few fibers.
LOGSHEET: Default to 'b1' only.
PLATESN: Change fiducial mags from [20.2, 20.25, 19.9] to [22.0, 21.0, 21.0].
PLOTSN: Change fiducial mags from [20.0, 20.2, 20.25, 19.9, 19.0]
      to [20.0, 22.0, 21.0, 21.0, 20.0].
      Plotting range to include FITMAG and SNMAG.
PLOTSPEC: Add option to do on-the-fly template fits with "z".
PLUGMAP_VERIFY: New code to run some sanity checks on plate designs
      (plPlugMapP files).
QUICKBIAS: Reject if >40% pixels bad, not 10%, since we are currently
      masking 31% of the blue images and 12% of the red that are beyond
      the useful wavelength ranges.
QUICKEXTRACT: Include more calling parameters to fitflatwidth.
      Change mangitudes at which to evaluate S/N from 20.33 to 22.0 in g-band
      and from 20.06 to 21.0 in i-band.
      Remove the code that would issue the warning messages
      to the SOS web page about bad chi^2 residuals.
      No longer pass SKYCHI2SET to SKYSUBTRACT routine, and do not output
      to the FITS file.
      Trigger flexure warning message at 0.25 pix instead of 0.15.
      Include the raw data header in the output FITS (sci-*) file,
      including the "FRAMESN2" keyword.
QUICKTRACE: Fix typo.  Include more calling params to trace320crude.
      Consider a fiber bad only if any of the following mask bits are set,
      but specifically not if BADTRACE is set.
QUICKTRACE,SPCALIB: Change call to XY2TRACESET to ignore values that
      fall on bad parts of the CCD.
QUICKWAVE: Include more calling params to fiberflat and fitarcimage.
RDNOISE_HISTORY: New proc for computing read noise history of BOSS CCDs.
SDSSGUIDE: Comment-out the parts of code that reads the plugmap files
      and that computes the telescope offsets.
      Remove the camera offsets that were used by the old camera hardware;
      the code will presently only work with the new camera.
SDSSPROC: Images are rotated 180 deg starting on MJD 55113.
      So we no longer need to rotate those images.  The gains have
      been remapped, and the masked regions, to these rotated coordinates.
      Declare Hartmann exposures (Left or Right) to be 'test'.
      Update BOSS gain values based upon outputs of BOSS_GAIN flat-field tests.
      Add keyword /APPLYCROSSTALK and call to cross-talk fixing code.
      Pass /SILENT option to SPHDRFIX.
      Only call WARN_DAYTIME if not called silently.
      Saddlebags swapped between r1 and r2 on MJD 55132.  This changes
      the gain on both CCDs.  The high noise on the lower-left of r1
      is now fixed, and we've moved a higher noise on r2 (but not as bad).
      Measure gain from LED flats on MJD 55142 on exposures 103065+103066.
      No longer splice in columns to the center of b1+b2 from the edges;
      the central columns were supposedly fixed on MJD 55141, and data
      predating that actually looks like it shouldn't have two extra
      columns in there either.
      Only call WARN_DAYTIME for science exposures.
      Remove BZERO,BSCALE from the headers.  These appear newly in
      the BOSS headers, and otherwise propogate to the reductions.
      This is ticket #400.
      New internal proc SDSSPROC_BADFORMAT to identify and fix shifted
      rows in the raw image (ticket #423).
      Cache the code versions, since they involve calls to spawn that
      are very slow.
SKYSUBTRACT: Only call REDMONSTER routine if RELCHI2SET keyword is passed,
      thus disabling those error messages from appearing on the SOS
      web page.
SORTPLUGMAP: Bug fix assigning dead fibers (as with plate 3674/55153).
SPADD_GUIDERINFO: Interpret the new guiderMon files generated by
      GUIDERMONFILE, while being backwards-compatible with the old ones.
      Guider offsets measured for all enabled fibers, and FWHM measured
      from only those where focusoffset is <100 microns (in-focus fibers).
SPFLUX_V5: Fix plotting limits.
SPHDRFIX: Add /SILENT option.
SPREDUCE1D: Force the use of /CHOP_DATA until we fix the templates.
SUPERFLAT: Fix plotting range.
      Better selection of which fibers to use (otherwise fails
      on plate 3604/55146-b1), not getting thrown by a few fibers.
TRACE_CEN: In intial fit, explore a small range of fiberspace around
      the nominal, as well as the cross-correlation.  That scale range
      is +/- 0.5%.

Makefile: Add config to install directories.
bin/aporsync_alllog.sh, aporsync_blue.sh, aporsync_logs.sh, aporsync_red.sh,
      data_rsync.sh, killdata.sh, sos.sh, sos_redo, sos_start, sos_status,
      sos_stop, spamdup, spreduce_batch, spsyncrobot.sh, spsyncrobot_start,
      spsyncrobot_stop, startapo.sh: Remove all these deprecated routines
bin/fb_classes.py, getPlugmap, sos_apoclog, sos_apocontrol, sos_apostart,
      sos_batchd, sos_classes.py, sos_runnerd, sos_runnerd_processlist,
      sxpar.py: New routines for Son-of-Spectro
bin/idlspec2d_version: Script to return SVN version of the idlspec2d product.
      This is to replace the IDL version of this.
bin/run_collimate.csh: Script to run collimate in parallel processing (Dawson).
bin/sos_README: Updated documentation for Son-of-Spectro
doc/www/spectroSOS.html: Include warning message about "Electronics shifted".
examples/cartridgeInfo.par: Add entries for cartridges 10-17, with the
      same values for all of them.  This is for SDSSGUIDE.
examples/lamphgcdne.dat: Remove the Ne I line at 8118 Ang, since the
      arc line at 8115 was being called 8118.
      Remove the line 7943 which appears to get incorrectly identified.
examples/opLimits.par: Define the XMID,WAVEMID to be those observed
      with plate 3552/55142 on cartridge 11.
      Set S/N^2 limits as 16 in blue and 26 in red for "good", and
      13 + 22 as "marginal" (yellow).  The red limits are based upon
      an analysis posted by Peter Brown on Nov 30.
examples/plPlugMapP-verify.par: Data file of header keywords to check
      using the PLUGMAP_VERIFY code.

-------------------------------------------------------------------------------
v5_4_1 (Sep 25, 2009) idlspec2d running on IDL 5.4 - 7.1
Tagged to begin development for BOSS spectrographs, backing
out SEGUE-specific development.
Built against specflat v1_8, elodie v1_3, idlutils v5_4_4.

APOREDUCE,QUICKTRACE,QUICKWAVE: Use BOSS configuration.
CALCSCATIMAGE: Fix for non-square images!
COLLIMATE: Update to work on the BOSS data.  Simplify the code to
      only look for offsets in Y, and do so by looking at subpixel
      shifts rather than fitting to the shift from integer-pixel shifts.
      The calibration for the collimator and focus rings will be
      different for BOSS, because the CCD pixels are smaller by 15/24.
      Add /PRINT option to print the table of values used for the figure.
CONFIGURATION__DEFINE: Configuration file to set pipeline parameters
      for either SDSS-I or BOSS.
EXTRACT_OBJECT: Simplify call to CALCSCATIMAGE.
      Make calls to DIVIDEFLAT less verbose.
      Bad columns only if 30% of pixels (not 10% previously for SDSS-I).
EXTRACT_ROW: Hack to keep the C code from failing, by setting masked
      pixels to have values of invvar slightly above zero.
      This is ticket 298.
FITARCIMAGE: Pass parameters (ACOEFF,DCOEFF) to ARCFIT_GUESS using _EXTRA.
      New input keyword WRANGE to explicitly limit the wavelength range
      of the arc lines used.
      New input keyword NUMBERBUNDLES.
      Get rid of /STICKY in all to XY2TRACESET, since that rejects too
      many arc lines.
GET_TAI: Work if only TAI_BEG and EXPTIME are defined (which is all we
      seem to have for BOSS commissioning).
PLOTSPEC: Support for plotting BOSS files with different numbers of fibers.
      Print old or new target names.
QAPLOT_ARCLINE: Minor plot changes.
QUICKTRACE:
      Call to XY2TRACESET using errors, which is much slower (by 10X),
      but prevents crashes from extrapolating the traces to bad positions.
READPLUGMAP: Read the plateHoles file and append some tags to the plugmap
      structure.
READSPEC: Support for reading BOSS files with different numbers of
      fibers per plate.  This should be backwards compatible, except
      with different behaviour if one tries to read non-existent files.
      Previous behaviour was to return 640-length vectors of zeros.
      Now return 1-length vectors of zeros, since we in general don't
      know how many objects there are per plate.
      Optional return value of NFIBER to tell the number of fibers per plate.
SDSSPROC: Hack for reading the first BOSS test data on MJD 55052,
      which are not yet properly-formatted images.
SKYSUBTRACT: Change calls to bspline_iterfit to pass all double-precision.
SPCALIB,SPCOMBINE_V5,SFLUX_V5,SPFLUXCORR_V5,SPCOADD_V5:
      Changes to use Alex's new configuration definitions for SDSS-I/BOSS.
SPCALIB: Pass configuration values to FITARCIMAGE.
SMOOTH_SUPERFLAT: Return zeros for the returned image outside of the
      wavelength range used for the fit.  Also don't include the
      crazy values outside the fit region in the plots.
SPECHEADERS: New routine for consolodating all of the spectro FITS headers
      into a single FITS binary table.
SPPLAN1D,SPPLAN2D,SPREDUCE1D,SPREDUCE2D,SDSSPROC,
      SPCOADD_FRAMES,SPCOMBINE,SPCOMBINE_V5: Use the /noshell option
      for some calls to spawn (except for mkdir,uname,ls).
SPPLAN_FINDRAWDATA: Look for .fits files as well as .fit, since such
      files were written on MJD 55052.
SPREDUCE1D: Add CHOP_DATA keyword for reducing the new BOSS spectra with
      the old SDSS templates that do not have sufficient wavelength range.
SUPERFLAT: QA plot now only plots percentiles of the fiber values at
      each wavelength, rather than a very large number of points.
TRACE_CEN: New routine for finding the initial X positions of the traces,
       to replace TRACE320CEN.  The logic is based upon the new code
       in the fiber-mapper.
TRACE320CEN,TRACE320CRUDE: Fix error in guessing the position of the
      first fiber.  Add new keyword MTHRESHFACTOR, defined in configuration.
TRACE320CRUDE,SPCALIB: Use TRACE_CEN instead of TRACE320CEN.
ZFIND: Add /mask_emission option (Vaishali), although should this be
      done external to this routine?

etc/lamphgcdne.dat: New lines and their fluxes added in the UV
      and the near-IR for the BOSS detectors.  Remove the line
      at 6506 Ang from the list because it gets confused with
      a line at 2nd-order in the b1 spectrograph.
examples/opLimits.par: New parameters for BOSS.  Not made to be
      backwards-compatable with SDSS-I.
examples/opConfig-55025.par,opECalib-55025.par: CCD parameter
      files for Lauren's original simulations.
examples/opConfig-55026.par,opECalib-55026.par: CCD parameter
      files for real BOSS data based upon Gunn's document
      "Arrangement of Serial Data for BOSS CCD Images Into Images".
      We don't yet use these for real data, but use all the hacks
      within SDSSPROC instead.
ups/idlspec2d.table: Add optional dependence on the platelist product,
      which is used to add information from the plateHoles files to the
      plPlugMapM files.

-------------------------------------------------------------------------------
v5_4_0 (June 19, 2009) idlspec2d running on IDL 5.4 - 7.0
Tagged to begin development for BOSS spectrographs, backing
out SEGUE-specific development.
Built against specflat v1_7, elodie v1_3, idlutils v5_4_2.

ARCFIT_GUESS: For the red camera, extend the range of the last
      polynomial term, which is necessary for some test data taken
      where the wavelength ranges were shifted by large amounts.
BATCH1D,BATCH2D,NEBULAR_BATCH: Fix the priority option to call
      '/bin/nice -19' rather than '/bin/nice -n 19' (for example).
CALCSCATIMAGE: Change default break points to NSCATBKPTS=16 (from 40).
EXTRACT_ASYMBOX: Variant of the boxcar-extraction routine that allows
      for asymmetric and/or variable windows (Burles).
EXTRACT_BOXCAR: New /IDL keyword to call pure IDL boxcar extraction (Burles).
EXTRACT_OBJECT: Roll back to using RA,DEC from the headers, and try to fix
      that upstream of this if it's ever a problem.
      Don't return SIGMA from call to FITSN (since it's not used).
      Output X structure as HDU #7 to be complient with data model.
      Output superflat as HDU #8 (which is used by SPTHROUGHPUT).
      Remove HDUs after that unless/until added to the data model.
FIBERFLAT: Fix test as to whether B-spline fit failed.
FLUX2MAGGIE: New simple wrapper for FILTER_THRU.
GET_PLATECENTER: Remove since we'll want this functionality upstream
      if needed.
GUIDERMOVIE,GUIDERMPEG: Update to use the dark frames for the original
      SDSS guide camera that are now checked into the etc directory,
      rather than a hard-wired file name that only existed at sdsshost.apo.
PLUG2TSOBJ: Remove undocumented PLUGFILE keyword.
READSPEC_FOOTPRINT: New routine for reading all spectro objects
      within the footprint of a specified plate.
SDSSGUIDE: New IDL guider for the Sloan Telescope.
SOLVEFILTER: Update to use current photometry files.
SPCOADD_V5: Re-remove the synthetic magnitude HDU and the S/N HDU
      that should have never been at the end of the spPlate files.
      Add superflat as HDU #8.
SPFLUX_V5,SPCOMBINE_V5: Revert to v5_2_0 version until we document
      and go through v5_3 branch changes.
SPFLUX_BASESPLINE,SPFLUX_BYEXP,SPFLUX_FITTEMPLATES,
      SPFLUX_MAKETELLURICTEMPLATES,SPFLUX_MASKLINES:
      Remove from the main-line, and we'll presumably merge back in from v5_3.
SPFLUX_BASESPLINE: Bug fixes in case the wavelength range is 10s of Ang
      away from the canonical setup.  Our blue throughput tests on
      plate 2587/54137 was such a case, where this code crashed.
SPPLAN2D: Get the plate ID from the final output structure, which has
      excluded bad files.
      Only define code versions once, since it involved a slow spawn command.
      Crash if the output directory cannot be created or written to.
SUPERFLAT: Print warning message and return 0 if the wavelength mapping makes
      no sense (this could have crashed before, and did for UV test data).

bin/speclog_update: add -forcecvs option, to help recover from nights
      which were copied in, but had CVS problems.
doc/www/spectro_home.html: Add instructions for downloading DR6.
      Update Data Model for spCFrame files for superflat in HDU #8.
etc/dark-??-*.fits: Dark frames from the original SDSS guide camera,
      copied from sdsshost.apo.nmsu.edu:/data/spectro/guiderDarks.
      These files are now used by GUIDERMOVIE,GUIDERMPEG.
etc/emlines.par: Add 2 more nebular lines of interest to Andrew West:
        [N_II] 5755 and He_I 5876.
etc/spChunkList.par: Add chunks 162-167,168,169-172.
      Chunks 99, 99A and 100A should have been "main" rather than "special".
      Add chunks 173-192 and 34A.
etc/spPlateList.par: Update from 2005 through summer 2007 shutdown
      (MJD 54275).  This adds a total of 226 new plates to the list, and two
      plates have had their MJDs changed: 1026/52534 and 1028/52562 are
      removed from the list and replaced with 1026/52532 and 1028/52559.
      Denote 349 plates as DR6 plates, including 22 that are marked as bad
      in the v5_1 reductions.  There is just one inconsistency in MJDs on
      the sdss.org web site, which is they include plate 1135/53018 instead
      of 1135/53024 (which has one exposure from that later date).
      This DR6 plate list is from http://www.sdss.org/dr6/coverage/alldr6spectro.par
examples/cartridgeInfo.par: Data file for SDSSGUIDE copied out of the IOP/SOP
      product.

-------------------------------------------------------------------------------
v5_2_0 (February 1, 2007) idlspec2d running on IDL 5.4 - 6.3
Built against specflat v1_7, elodie v1_1, idlutils v5_2_0.

 Merge from v5_2_test branch, with the following changes:

ELODIE_FILELIST, PCA_ELODIE: Handle v1_1 and later elodie products
      with a template list and blue cutoff.par file. Handle Elodie v3
      catalogs, even though we don't use them. Update
      spEigenElodie.fits to match. [This was mostly in by v5_1_7, but
      there have been some bugfixes since. ]
PLUG2TSOBJ, BATHCH2D, READPLUMAP: If the TSOBJMAPROOT environment
      variable is set, read Survey $TSOBJMAPROOT/tObj-$PLATE files
      instead of $SPECTRO_DATA/calibObj/calibPlateP-$PLATE files.
CALCSCATIMAGE, EXTRACT_OBJECT, SPCALIB, DOSCATFIT,
DOSCATTER, GEN_SCATTER, examples/scattering-CAM-MJD.fits: Add
      per-camera scattering models; modify spcalib and extract_object
      to call doscatter to generate them.
SPFLUX_MASKLINES: Move out of splux_f5. Add /o2 and /h2o options.
SPFLUX_MAKETELLURICTEMPLATES, examples/spFluxTemplates-CAM.fits:
      Create telluric template files.
SPFLUX_V5, SPFLUX_BASESPLINE, SPFLUX_BYEXP, SPFLUX_FITTEMPLATES:
      Generate flux calibration vectors based on per-exposure
      low-order splines plus scaled telluric templates.
FITARCIMAGE: Add /dofirst option to allow getting crude results from sparse
       plates, etc.
SPCOADD_V5: Re-add the deprecated synthetic magnitude HDU and the
      (ugh) S/N HDU. Appended to end of spPlate.fits

doc/spphoto.ps: Added JEG notes on spectro-photometry.

-------------------------------------------------------------------------------
v5_1_8 (January 9, 2007) idlspec2d running on IDL 5.4 - 6.3
Tagged for Son-of-Spectro.
Built against specflat v1_7, elodie v1_0, idlutils v5_1_7.

APOPLOT: Bug fix -- use the implied wavelength limits from fcalib_default

-------------------------------------------------------------------------------
v5_1_7 (January 5, 2007) idlspec2d running on IDL 5.4 - 6.3
Tagged for Son-of-Spectro.
Built against specflat v1_7, elodie v1_0, idlutils v5_1_7.

ARCFIT_GUESS: Change search range for the central wavelength from
       0.05 in log-wavelength to 0.15 in log-wavelength.  This is
       for UV throughput tests that we want to do (see PR #7190).
       Until now, the search would only cover +/-200 Ang from 3800 Ang
       on the blue side.  This is the default DCOEFF[0]=0.05.
       The default DCOEFF[0] has been increased to 0.15, for a search
       of approx 3200-4520 Ang for the blue side of the blue CCDs.
DESIGN_SDSS3TEST: New proc to design test plates for SDSS-3.
DESIGN_PLATE: Modified to not use most of the dumb TCL scripts in the
        "plate" product.
ELODIE_BEST,PCA_ELODIE: Small change to call the new function ELODIE_FILELIST,
        and pass MINLOGLAMCLIP to READ_ELODIE.
ELODIE_FILELIST: New function for returning only good Elodie files (Loomis).
EXTRACT_OBJECT,SPCOADD_V5,SPFRAME_READ: Add the spatial traces to the
        spFrame and spCFrame files as the last HDU (#7), as per the request
        of PR #7137.
EXTRACT_ROW: Catch divide by 0 in reduced chi^2.
LINEBACKFIT: Fix crash condition for when no BACKGROUND vectors are set.
        Add /SILENT option.  Add BACKGUESS keyword.
        Make all loop variables type long (2 places where this could matter).
READ_ELODIE: Updates for the new Elodie-3 catalog.  Add keyword MINLOGLAMCLIP
        and an internal spline-interpolation over masked pixels.  The code
        should still return exactly the same results for Elodie-2.
READ1SPEC: Remove this deprecated routine.
READONESPEC: Add optional EXPNUM return value.  Add support for reading
        the spatial traces (XIMG) from the new outputs.
SIMPLE_PLATE: This is essentially a re-write of DESIGN_PLATE that
        still calls all the dumb TCL scripts in the "plate" product.
SPREDUCE1D: Comment-out the STAR_DVELOCITY code for the time being,
        since it is not yet debugged but takes many CPU cycles.
ZCOMPUTE: Add FIXED_TEMPLATE as optional input, and ZANS_FIXED output.
ZFIND: Add optional ZANS_FIXED return keyword from ZCOMPUTE.

bin/spsyncrobot_start: Insist that the SSH keys we were told about can
        actually do what we need them to (Loomis).
doc/www/spectro_home.html: Update for DR5.  Add info to data model about
        spatial traces (XIMG) for spCFrame files.
doc/www/specroSOS.html: Add warning message corresponding to the fix
        for PR #6840: "Wrong number of elements for reddeningMed",
        which was fixed in v5_1_2.
etc/emlines.par: Add 8 more nebular lines of interest to Andrew West:
        [Ne_III] 3868, [Ne_III] 3970, H_epsilon, He_II 4685, He_II 5411,
        [O_I] 5577, [S_III] 6312, [Ar_III] 7135
etc/spChunkList.par: Add chunks 148-157, 153A, 158-162.
examples/opECalib-50000.par,opECalib-51430.par,opECalib-51577.par:
    Raise the full well limit to 65535 from 35000, as the detectors
        are not showing signs of saturation.
    Make the (unused) linearity adjustements 1.0, just for clarity.
        PR #6592 discusses these issues in detail.
lib/Makefile: Correctly copy built libraries for platforms other than Linux.

-------------------------------------------------------------------------------
v5_1_4 (May 31, 2006) idlspec2d running on IDL 5.4 - 6.2
Built against specflat v1_6, elodie v1_0, idlutils v5_1_4

EXTRACT_OBJECT: Print a WARNING statement if either RA or DEC are
        missing from the header, since that will result in an invalid
        AIRMASS calculation (see PR #6953).  Also, report AIRMASS=0
        in the header if RA, DEC or TAI are zero.
FITARCIMAGE: Detector wavelength limits were not being accounted for
    when checking for big wavelength gaps (Loomis).
LRGMODEL_SPECTRA: New routine, split out of LRGMODEL_PHOTOZ and/or LRGSIM,
        for generating the LRG model spectra.
PLATELIST: Fix the bit of code that finds all input plate files to be
        more robust to large number of plates, since a dumb use of
        the FINDFILE() function will overflow.  Instead, first get the
        list of all directories, and then search within each of those.
PLOTSPECQA: Wrapper to PLOTSPEC to select only standard stars or skies.
SDSSPROC: In response to PR #6893 against Son-of-Spectro, don't print
        any error messages if the spawn of 'speclog_version' fails.
        That bash script only exists in the speclog product, which is
        not required for Son-of-Spectro.
SKYSPEC_PARANAL: New function to return the sky spectrum at Paranal.
SKYSUBTRACT: The rescaling of the errors with RELCHI2FIT seems to fail
        in the case where all sky fibers but 4 have been rejected.
        This happened on plate 2333/53679 exposure b1-00034582,
        which is a bright SEGUE plate with all sorts of S/N problems.
SPFRAME_READ: Add option to read superflat vectors from spFrame files.
SPFLUX_V5: We were writing calibration vectors in HDU #0 of the spFluxcalib
        files that were double-precision.  Recast those to single precision.
SPFLUXCORR_V5: Allow a range of 0.1-10 for the flux correction vectors,
        which had been 0.2-5.  There were perverse cases (like for plate 321,
        c.f. PR #6774) where these large flux correction vectors were
        necessary, although the correct solution in that case was to
        reject three bad exposures.  Also, print a Warning message if the
        flux-correction vector is out-of-bounds and then ignored.
SPTEMPLATE_REBIN: New function to read and optionally rebin spectral
        templates.  This is for use for Monte Carlo simulations of
        a spectroscopic survey at different resolutions.
SPTHROUGHPUT: New function to return the throughput and efficiency for
        a given plate+camera+exposure

bin/sprobot_start,sprobot_stop,sprobot.sh: Remove these scripts that
        loaded the Spectro cron robot, which have now been split off
        into the rsync and reduce cron jobs started with spsynrobot_start
        and spredrobot_start.
bin/spsyncrobot_start,spsyncrobot_stop,spsyncrobot.sh,
        spredrobot_start,spredrobot_stop,spredrobot.sh:
        Split sprobot.sh script into an rsync task that will
        be run as a cron job by the "dssdata" user, and a processing task
        that will be run as a cron job by "dssrun" user. The intent is to
        match the photoop userid logic, where data is copied as one
    user and reduced as another.
doc/www/idlspec2d_install.html,spectro_inspect.html: The CVS repository
        has been changed from spectro.princeton.edu to
        sdsscvs.astro.princeton.edu .
etc/spChunkList.par: Add chunks 139-142, 143-144, 145-147.
examples/opECalib-blank.par: Files with gain, bias, linearity, set to 1,0,1
        to make it a bit easier to investigate raw frames with the standard
        tools (Loomis).
examples/opHdrFix.par: Reject some exposures on plate 321 (M67) where the
        telescope was clearly not guiding.  This addresses PR #6957.
templates/bc03_padova1994_chab_z*_ssp.fit.gz: These are 4 FITS files with
        the full BC03 SP unnormalized grids (ages in years, wavelengths
        in Angstroms, and fluxes).  These files came from Christy Tremonti
        on 14 Feb 2006 with the following notes:  "The ages are kind of
        oddly spaced -- I'm not really sure why, that's just how they come.
        Note that the wavelengths are not uniformly spaced outside of the
        optical and extend to from 90 A - 1600000 A. (If you quickly plot
        wave vs flux, you won't see anything b/c the optical is compressed
        at the left edge of the plot!)  I created these FITS files using
        a handy IDL BC03 reader "im__read_bc03.pro".  It was written by
        John Moustakas."
templates/fluxed_sky_*.fits: These files contain fluxed sky spectra
        from Paranal, all in units of 1e-16 erg/sec/cm^2/A/arcsec^2.
        From http://www.eso.info/observing/dfo/quality/UVES/pipeline/sky_spectrum.html

-------------------------------------------------------------------------------
v5_1_3 (Feb 14, 2006 idlspec2d running on IDL 5.4 - 6.2
Built against specflat v1_6, elodie v1_0, idlutils v5_1_3
for bug fix in fluxing.

FLUX_DISTORTION: Add MAXDPERSTEP keyword with a default value of 0.03,
        which is the maximum peak deviation in flux distortion image
        allowed per iteration from a change in any one parameter.
        This prevents the fit from jumping to crazy solutions with
        high order quadratic terms (PR #6774).  Note that an update
        to the MPFIT code was also necessary for the correct behaviour
        of the MPMAXSTEP parameter.
PLATEMERGE: Add EXCEPT_TAGS keyword, and default to excluding tags
        with the name '*COVAR', since those are typically large
        covariance matrices that I've added recently to the ZANS structure.
QUICKEXTRACT: Bug fix in print statement "Whopping fiber #..."

etc/spChunkList.par: Add chunks 135-137.

-------------------------------------------------------------------------------
v5_1_2 (Feb 2, 2006 idlspec2d running on IDL 5.4 - 6.2
Built against specflat v1_6, elodie v1_0, idlutils v5_1_2
improving robustness of B-spline routines.

APOFLUXCALIB: Generalize this routine to work from any plates, and fix
        to work with the Spectro v5 outputs.
APOPLOT: Break the flux-calibration code out into the FCALIB_DEFAULT function.
CALCSCATIMAGE,COMBINE1FIBER,FIBERFLAT,MYFLUXCALIB,SKYSUBTRACT,
        SMOOTH_SUPERFLAT,SPFLATTEN2,SPFLUX_V5,SUPERFLAT,TELLURIC_CORR:
        Include specification of REQUIREN in call to the B-spline
        fitting code (BSPLINE_ITERFIT) for robustness, often just
        setting this to 1 or 2.
FCALIB_DEFAULT: Function for default flux-calibration vectors, where this
        code is based upon what was internal to APOPLOT.
FIND_NMINIMA: Recast some arguments as double-precision.
GET_TAI: Fix a WARNING message that was always spuriously triggered.
LINEBACKFIT: Fix crash condition when not specifing the background terms.
        Add options ZLIMITS and SIGLIMITS.
PLATEMERGE: Bug fix whereby the SPECPRIMARY flag was not being set properly
        for any object observed multiple times, as pointed out by Hennawi
        in PR #6841.
READONESPEC: Add the CAMERAS option for specifying only blue or red CCDs.
        Set default return values to zero.  Make robust to missing Spectro-1D
        reductions, and just return vectors zeros for SYNFLUX in those cases.
        Propogate the /SILENT flag everywhere.
        Add option to read LINEFLUX, resampled to the output wavelengths.
READPLUGMAP: Make robust to "reddeningMed" in the plug-map file header
        being either missing or not having 5 elements, as happened with
        the Orion plate 1245 on MJD 53742.
SPCOADD_V5: Print the dynamic range off the flux distortion image, and
        print a warning and disable the correction in the dynamic range
        exceeds 100.
SPCOMBINE_V5: Change some print statements (use PRELOG in SPLOG command).
SPFLUX_V5: Print statements.
SPFLUXCORR_V5: If flux-calibration failed (for ex, if no standard stars),
        then issue a warning message and then use FCALIB_DEFAULT() to
        apply a default flux-calibration vector.
SPREDUCE: If plug-map file not found, then print an ABORT message and return.

etc/spChunkList.par: Add chunks 133-134.
examples/spFluxcalib-b1.fits,spFluxcalib-b2.fits,
        spFluxcalib-r1.fits,spFluxcalib-r2.fits: Update thse default flux-
        calibration vectors with the v5 reductions of plate 406/51817
        generated by APOFLUXCALIB.
lib/.cvsignore: Add appropriate files to ignore by "cvs update".

-------------------------------------------------------------------------------
v5_1_0 (Dec 19, 2005 idlspec2d running on IDL 5.4 - 6.2
Built against specflat v1_6, elodie v1_0, idlutils v5_1_0 for upgrading SOS;
fix double-precision on OSX and Linux64.

ARCFIT_GUESS: Change the FIX() functions to LONG(), though I don't believe
        this was causing any trouble.
APO_LOG2HTML,APOREDUCE,BATCH1D,BATCH2D,CATPLOT,SDSSPROC,
APO_PLOTSN,PLOTSN: There was a problem long ago whereby the fiber magnitudes
        from photo changed, and we decided to change the magnitude at which
        Son-of-Spectro computes the S/N for each exposure.  This was fixed
        in Oct 2003 as documented in PR #5642 and sdss-obs/4029.  However,
        the S/N plots from SOS still use the old magnitudes.  I've changed
        those g,r magnitude limits from 20.20,19.90 -> 20.33,20.06 to be
        consistent with the SOS tables.  Note that the old limits will still
        be used by the full Spectro-2D reductions (since those are now tied
        to PSF magnitudes in newly-generated calibObj files).
ATVRAWSPEC: Plot a red column over every bad column, not just a box around
        each bad region.  For ex, the 4 bad columns (1112-1115) on r1 will
        not appear with a 4 red lines.
BATCH2D: Allow PLATENUMS to be integer-valued, in which case they are
        recaste as zero-padded strings that are 4 characters long
        (such that they match the directory names).
CHECKSN,MAKE2DMERGE,SPALLCOMBINE,SPALLREDUCE,SPMULTI,SPPLANCOMB,SPPLAN:
        These are all deprecated Fermi-only routines that would no
        longer work with the v5 versions of this code, so remove them.
COMBINE1FIBER: Make robust to the B-spline code failing (and return zeros).
        Fix a rare crash condition that happened on plate 321: It is
        possible for NUMINSIDE to be zero (on the inner loop), if the
        input data points span an extremely small wavelength range,
        within which there are no output wavelengths.
COMPUTECHI2: Add optional outputs COVAR,VAR.
        Explicitly do all arithmetic in double-precision, due to the change
        in behaviour of IDL on the Mac and 64-bit Linux where matrix multiplies
        have less precision (as described in PR #6754).  If the change is
        only made here, then there is alot of recasting of arrays that
        will slow the code.  Therefore, in practice we'll want to recast
        these arrays in the calling routines (like in ZCOMPUTE).
        Fix the computation of VAR and COVAR in the case of one template
        vector in AMATRIX.
ELODIE_BEST: Trim to stars not labelled as binary or triple stars, according
        to the Q_VR keyword in the Elodie FITS headers.  Rockosi brought
        this to my attention on Sep 20, 2004.
ELODIE_BEST,FITREDSHIFT,FITMEANX,FITWITHMX,MYFLUXCALIB,SDSSPROC,TRACE_FIT:
        Add /double keyword to STDDEV() call, such the behaviour will be
        the same on 32-bit or 64-bit machines.
EXTRACT_BOXCAR,EXTRACT_PROFILE,EXTRACT_ROW,SSHIFTVEC:
        Call IDLUTILS_SO_EXT() to get the suffix for dynamically
        loaded libraries (rather than assuming ".so").
EXTRACT_OBJECT: Write as HDU #8 an image of the relative chi^2, or an
        image of all 1's if no such structure was ever made in the SKYSUBTRACT
        code.  Note that these values are not truncated to be >=1, as they
        are when we re-scale the sky errors.
        If there is a telluric image (which we've deprecated for the v5 code),
        then it is now in HDU #9.
FIBERFLAT: Replace the /EACHGROUP keyword in BSPLINE_ITERFIT with appropriate
        GROUPSIZE keywords.  The former was a holdover from the days
        of the Fortran Slatec code.
FIND_NMINIMA: Catch the status from calling MPFITPEAK, and deal with it
        appropriately if the fit failed.
FINDSPEC: Complete re-write to match against long lists of objects quickly,
        rather than the slow loop over one object at a time.  Also, address
        PR #6583 to deal with the crazy possibility of the same object (with
        the same RA+DEC) appearing on the same plate.
FITARCIMAGE: Print the wavelengths of any rejected arc lines.
FITREDSHIFT,QAPLOT_FCALIBVEC,SOLVEFILTER,SPREDUCE1D,VELDISP,
        FLUX_DISTORTION,SDSSPROC: Change calls from the deprecated STDEV()
        to STDDEV().
FITSN: If fewer than 20 good points within the default fitting mag range,
        then redefine that fitting range to be [0,+1] mag from the median
        of good magnitudes.  This makes the plots look better from Spectro-2D
        and from SOS.  It should also help address PR #6325, by choosing
        more reasonable fit ranges for SEGUE plates with bright stars.
FLUX_DISTORTION: There was a bug in the way objects were being rejected
        in the main iteration loop.  Basically, objects were being rejected,
        but then had chi=0 in the next iteration, and then were put back
        in the fits.  I now have a /nomask option in flux_distort_fn()
        that allows me to compute chi even for rejected points.
        Also, always start the fitting routine with tiny values for
        the coefficients.  This is to prevent us from "walking away" from
        the correction solution in the case where some initially bad points
        effect the fit.
        Add two more terms, which are quadratics in the wavelength parameter
        (one for each spectrograph).  This takes out curvature in the spectra
        which I otherwise couldn't fit out -- though if the AB zeropoints are
        not correct, then these terms enforce consistency but are not correct.
        Add the functionality to have multiple offset pointings on the same
        plate, which is true for SEGUE plates 2247 and 2255 (the latter was
        already observed).  Do the standard flux-distortion corrections from
        the first offset (where OFFSETID=1).  If there are repeated objects
        between that offset and others (as determined by matching RA,Dec),
        then solve for the mean flux-correction vector between those offsets.
        Otherwise, scale the fluxes according to SCI_EXPTIME in the plugmap.
        When fitting for the ratio vectors, use THISIVAR internally instead
        of OBJIVAR (the former masks out bad sky-subtraction regions).
LINEBACKFIT: The calculation of LINEEW_ERR was incorrect, as noted in PR #6235.
LRGMODEL_PHOTOZ: Optionally compute and return FITFLUX.
PCA_CVSTAR,PCA_GAL,PCA_QSO: Insist that all requested spectra exist.
PCA_GAL: Make plots.
PCA_SOLVE: Make loop variables long ints.
        Make the internal arrays double-precision instead of floats
        before calling COMPUTECHI2 due to round-off errors on some
        platforms (PR #6754).
PLATELIST: Use FINDFILE() function to see if files exist before calling
        MRDFITS(); this should be a slight speed-improvement.
        Since the v5 version of this code will combine data with as few as
        1 exposure in a given camera, set the plate quality to 'bad' if there
        is only 1 exposure, or 'mariginal' if only 2 exposures in any given CCD.
        Allow INFILE to be an array.
PLATEMERGE: Add the fields CALIBFLUX,CALIBFLUX_IVAR which are explicitly
        copied over from the plug-map structures.
          Get rid of the ZFILE option in place of the PLATE,MJD options.
          Make robust to the spZLine structures being different for
        different plates, for ex. if different code versions were used.
          Re-write the bit of code that matches objects.  This was necessary
        to address PR #6583, since there are now some bizarre, special
        plates where the same object appears twice.  Note that this also
        fixes the bug whereby some objects are not matched if the plate list
        has incorrect central RA,DEC positions (such as plate 1274 on MJD 52995
        where those values are NaNs).  The new implementation uses SPHEREGROUP.
        Also, the logic for setting SPECPRIMARY was slightly changed.
PLOTSN: Choose which objects are "good" on a filter-by-filter basis,
        to avoid stars with crazy magnitudes (like 0 or -9999) from
        throwing the plots (for example, on SEGUE plate 2255).
        Trivial bug fixes to prevent crashes when making plots with
        a single point.
PLOTSPEC: Add capability to plot reconstructed frames (added by Blanton).
        Fix units on Y axis to /cm^2 instead of /cm (was fixed in v4_9_13
        when plotting to files, but not when to the terminal).
        Break out call to displaying photo images with a call to
        the new routine PLOTSPEC_IMAGE.
PLOTSPEC_IMAGE: New routine called by PLOTSPEC for displaying images
        with calls to the photoop product.
PLUGMAP_TYCHO: New proc for plotting bright Tycho stars on a plate.
QAPLOT_FCALIBVEC: Put plots for each spectrograph on its own page, and
        put offsets between the plots for all objects, F stars, and QSOs
        so that we can see the plots more easily.  Also, smooth the plots
        a little bit after the median-filtering.
QUICKEXTRACT: Remove the end of the warning message for "Whopping fiber"
        which used to say "(may have adverse afffect on S/N)".  This was
        being interpreted as chaning the S/N on the whole plate, when in
        fact it usually just affects a few fibers.
        For the warning message "Large flexure...", append the shift
        number to the message (in response to PR #6239).
        Only print the fiber numbers for the first 5 whopping fibers.
        Change cod to be consistent with SKYSUBTRACT, which now returns
        RELCHI2SET rather than RELCHI2STRUCT.
READPLUGMAP: Fix bug when replacing unknown fluxes in the calibObj
          structure with old values in the plug-map file.
        Add OFFSETID and SCI_EXPTIME to the output structures, which
          are obtained from an optional PLUGMAPTARG structure in the
          plPlugMapM file.  The plate where I've added that is SEGUE plate 2255,
          which has multiple offsets in the same exposure.
        Do not use magnitudes in the input file not in the range [0,50],
          in order to avoid overflows when magnitudes are set to crazy
          values like -999.
        Add missing iobj, so that the call from QUICKTRACE with the /DEREDDEN
          option works.
        Add HDR return keyword, which is used by SPREDUCE routine.
READONESPEC: Return all headers in FRAMEHDR.
READSPEC: Change how the internal procedure READSPEC1 works, such that
        arrays of zeros are returned if data is missing.  This allows us
        to return a good one-to-one list of objects from an input list
        of plate,mjd,fiberid.  However, I'm not positive that this is always
        the desired behaviour.  For ex, requesting a non-existent plate
        will now return 640-element arrays of zeros.
        Make this routine robust to missing data when reading in structures,
        such as plugmap, zline, tsobj.
REDMONSTER: Make robust to the perverse case of the number of (good) pixels
        in the spectrum being less than the median filter size of 25 pixels.
        This happened for saturated data on plate 2333, but does not happen
        on any other plates.
REDUCE_PLATE: Removed (old code).
SDSSPROC: Re-enable the call to 'speclog_version'.
        Add call to FITS_PURGE_NANS in order to address PR #6032, 6084,
        whereby the DA has written invalid FITS header keywords.
        Use the measured read noise (rather than the value in the op file)
        for constructing the inverse variance image.
        Add three more possible warning messages from testing the statistics
        of the bias region:
          "expected read noise = ..., measured = ... DN",
        and
          "bias region difference at xxx-th-percentile =... DN",
        and
          "Amp #... way too many pixels (xxx%) below bias-5*sigma=... DN."
        This replaces the warning message:
          "Std. dev. in bias region for amp#... is ... DN (5-sig clip)".
        These tests should be more robustly sensitive to PR #2335
        (when r2 was randomly flipping bits on 22/23 Aug 2000), and
        the more recent PR #6143 (r2 electronics problems in Aug 2004).
SKYSUBTRACT: Return the trace-set RELCHI2SET instead of RELCHI2STRUCT,
          for use by the EXTRACT_OBJECT code.
        Fix a bug, where the "airmass_correction" term was not squared
          when applied to the sky variance (on line 285).
        Apply a ratio of "number of sky pixels in a breakpoint bin" to the
          number of degrees of freedom in the fit to the correction to
          local chi^2.
        Recast "fullfit" to floating-point to avoid returning a double-
          precision sky array.  This was happening due to same changes to
          the B-spline code to support double-precision.
        Replace the /EACHGROUP keyword in BSPLINE_ITERFIT with appropriate
          GROUPSIZE keywords.  The former was a holdover from the days
          of the Fortran Slatec code.
SLITHISTORY: Do not plot missing measurements (zeros).
SMOOTH_SUPERFLAT: Bug fix, whereby we could trigger a warning message when
        the ends of the wavelength range did not have any good data points.
        In such a case, the fits are meaningless, and any value could result.
        This was triggering false warning messages on plate 1053/52468 in r2,
        plate 1051/52468 on r2, etc.  This should now be fixed by setting
        the internal variable RATIO=1 for bad points.
SPBIASAVE,SPFLATAVE: Fix bug where filename matching is off-by-1.
SPBIASGEN: Trivial bug fix to mask bad pixels.
SPCALIB: Change call from SMOOTH_HALO() to SMOOTH_HALO2D() for fitting
        the scattered light background.  This should do a more proper treatment
        of the scattering, but in practice does not seem to make much
        difference.
SPCOADD_V5: Apply the flux-distortion image to the sky vectors, as well
        as to OBJFLUX,OBJIVAR.
        Match objects between exposures by XFOCAL,YFOCAL in the plugmap
        rather than using RA,DEC.  This is because there are the bizarre
        plates like SEGUE plate 2255 that has the same object several times.
        Add keywords NEXP_B1,NEXP_B2,NEXP_R1,NEXP_R2 to output header.
SPCOMBINE_V5: Make the (dangerous!) change of setting the minimum score
        for an exposure to a S/N value of >0 rather than >1.  This is
        necessary for some SEGUE plates, but is dangerous for main survey
        plates if some data is not marked bad.  Hopefully, we'll track
        all those bad data down with PR #6722.
SPFLATGEN: Discard exposures where the quality keyword is set to 'bad'.
SPFLATTEN2: Recast an internal variable to float to prevent double-precision
        output files.
SPFLUX_READ_KURUCZ: This function was pulled out of SPFLUX_V5.
SPFLUX_V5: Pull out the SPFLUX_READ_KURUCZ() code as a separate function.
        Comment-out the median/mean rescaling factor in SPFLUX_MRATIO_FLATTEN(),
        since I think that could potentially be mis-matched between the blue
        and red sides.  For rejecting the F stars, start by rejecting any
        stars with more than 20% bad points in any image.  (This fixes a
        problem with plate 662/52147 where a bad star throws the fits.)
        Rescale the per-fiber plots of the spectro-photo vectors using
        the FLATARR such that they should all lie on top of one another.
        The "Flux-calib" plot for spectro-2 incorrectly listed fiber numbers
        between 1 and 320 instead of 321 and 640 -- fixed.
        Only select spectro-photo stars from OFFSETID=1, which will deal
        with multiple-offset plates like SEGUE plate 2255.
SPFLUXCORR_V5: Return chi instead of sqrt(chi2) from the function FCORR_CHI_FN.
        Add INPARAMS option to SPFLUXCORR_SOLVE2() function.
        In the final loop, first do a fit using the SPFLUXCORR_SOLVE() code
        that does not rescale the errors, then use those fits as the starting
        point when calling SPFLUXCORR_SOLVE2().
        Test all solutions up to MAXPOLY terms, not necessarily stopping
        when there is no improvement to chi^2.  This is because one could
        imaging that going from 1->2 terms is very little improvment, but
        then 2->3 is substantial improvment.
        Generalize the internal routines SPFLUXCORR_SOLVE,SPFLUXCORR_SOLVE2
        and rename it to SOLVE_POLY_RATIO in the idlutils product.
SPGAIN: Revamp this code, trying to measure the gain from a set of flats
        taken on MJD 53114 for this purpose.
SPPLAN1D,SPPLAN_FINDRAWDATA:
        Replace calls to the obsolete function RSTRPOS()
        with STRPOS(/REVERSE_SEARCH).
SPREDUCE: Pass exposure time to READPLUGMAP, which now uses that for
        multiple-offset plates (like SEGUE plate 2255).
        Return plugmap-header from call to READPLUGMAP(), since it is
        used to get the CARTID for the output files.
SPREDUCE1D: (Use the B-spline spectra for QSO-fitting).
        When computing FRACNSIGMA,FRACNSIGHI,FRACNSIGLO, ignore points
        blueward of rest-frame 1216 Ang, since these numbers would then
        be dominated by LyA absorption in QSOs.  (This is PR #2703.)
        Add call to STAR_DVELOCITY, but only for stars, even though in
        principle it should work for any objects.
SSHIFT,SSHIFT2D: Remove these routines that are in the idlutils product.
STAR_DVELOCITY: New proc to solve for velocity shifts between multiple
        exposures.
SYNTHSPEC,ZFIND: If the eigenspectrum file does not contain in image in HDU #0,
        then look for a B-spline in HDU #1 and assume that it describes
        a B-spline.  (This is what we're trying to use for QSOs now.)
TRACE320CRUDE: This routine was not actually setting the default value
        of RADIUS, but was getting it from an internal call to TRACE_CRUDE.
        This has been fixed (necessarily, after a similar fix to TRACE_CRUDE).
ZTWEAK_STAR: Add optional keywords.
ZCOMPUTE_QSO: A version of ZCOMPUTE that is basically the same code, but
        using a B-spline composite spectrum that must be evaluated at each
        redshift.  Because there are multiplicative polynomials rather than
        additive polynomial terms, this may fail to find weak em-line QSOs.
ZCOMPUTE,ZCOMPUTE_CHI2: Recast the fluxes and models in double-precision
        before calling COMPUTECHI2 due to round-off errors on some
        platforms (PR #6754).
ZCOMPUTE: Add THETA_COVAR to the output structure.  Instead of storing all
        of the coefficients for the fits at all lags, add a final call
        to COMPUTECHI2 at the end to compute THETA and THETA_COVAR.
        These changes relate to PR #6757.
ZFIND: Mask any pixels on the templates where the first template contains zeros.
        This is useful, in particular, where the stellar templates have zeros
        at the beginning or end of the spectral range due lack of wavelength
        coverage.  This is done by setting the STARMASK parameter that is
        passed to ZCOMPUTE.  This should fix PR #5903.
        Return THETA_COVAR as computed by ZCOMPUTE (see PR #6757).
bin/aporsync_alllog.sh, aporsync_blue.sh, aporsync_logs.sh, aporsync_red.sh,
        killdata.sh, sos_start: Pull the data (sdR files and log files)
        from the machine specified by the environment variable
        $RAWDATA_HOST rather than from the hardwired sdsshost.apo.nmsu.edu.
        Set the default value to sdssfiles1.apo.nmsu.edu in the sos_start
        script.
bin/aporsync_alllog.sh, aporsync_blue.sh, aporsync_logs.sh, aporsync_red.sh:
        Remove the "--rsync-path" option to these scripts, which was used
        to point to the only working version of rsync on sdsshost.apo.
        Now that the IRIX machine sdsshost.apo has been replaced with
        a Linux machine, that is no longer necessary.
bin/spreduce_batch: Script to batch a single Spectro-2D or Spectro-1D job.
bin/sprobotlist.sh: Only run the PLATEMERGE command for all data, but
        not all the subsets such as DR1, etc.  No need to recreate those
        every day!
doc/www/idlspec2d_reduce.html,spectro_home.html: The machine alias name
        sdssdata.princeton.edu should really be sdssdata.astro.princeton.edu
doc/www/spectro_home.html: Add info for downloading DR4.
etc/lamplist.dat: Remove this file, since we use "lamphgcdne.dat" instead.
etc/spChunkList.par: Add chunks 91 through 107, 99A, 100A, 108, 109,
        110, 111, 112, 113, 114, 115-118, 119, 120, 121, 122, 123, 124, 125,
        126, 127, 128, 129, 123A, 131.
etc/spPlateList.par: Add 436 new plates, through MJD 53360 (Dec 21, 2004).
        Add the DR4 public plates, consistent with sdss-archive/2374.
        (I posted some inconsistencies about these plate lists to
        sdss-archive/2376.)  Note that I have all the same plates being
        marked as public, except there are four plates from the EDR
        the FNAL has dropped from their lists: 314/51641, 357/51813,
        362/51999, 412/51871.
        The following plates are public, but bad:
          504       52316 DR2 bad Bad spectrograph collimation
          704       52205 DR4 bad Bad spectrograph collimation
          721       52228 DR2 bad Bad spectrograph collimation
          761       52266 DR2 bad Bad spectrograph collimation
          769       52282 DR2 bad Bad spectrograph collimation
          770       52282 DR2 bad Bad spectrograph collimation
          775       52295 DR2 bad Bad spectrograph collimation
          778       52337 DR2 bad Bad spectrograph collimation
        List each plate in one and only one data release (the first time
        it is released).
        The most recent list from Fermi (from March 15, 2005;
        pointed to in sdss-archive/2439) misses the following plates
        that I have in my list from earlier e-mails.  All of these are
        repeats of other observations of the same plates:
          293 51689  EDR
          352 51694  EDR
          360 51780  DR1
          412 51931  EDR
          476 52027  DR4
          496 51973  DR4
          525 52029  DR4
          574 52347  DR4
          574 52366  DR4
          581 52353  DR4
          641 52176  DR4
          722 52206  DR4
          903 52385  DR4
          1296 52738  DR4
        Add another 233 plates through MJD 53566 (July 14, 2005).
        Marked plates for DR5, according to sdss-archive/2661 (226 plates) and
        sdss-archive/2684 (89 plates).  Note that I already had the following
        two plates in DR4: 712/52179 and 1664/52965, and will keep them there.
        I've also added 1138/53228 and 1144/53238 to DR5, since the Spectro v5
        reductions turn these plates into 'marginal' rather than 'bad.
        Note that the following 18 'good' or 'marginal' plates could be
        included (c.f. sdss-archive/26744):
          230       52251  special
          231       52221  special
         1244       52674  special
         1247       52677  special
         1250       52930  special
         1251       52964  special
         1252       52970  special
         1253       52974  special
         1254       52972  special
         1256       52902  special
         1257       52944  special
         1259       52931  special
         1637       52992  special
         1638       52999  special
         1641       53032  special
         1907       53265  special
         1913       53295  special
         1917       53295  special
        Remove the plates 521/52325 and 574/52337, which were only
        partial reductions that should not be in this list.
examples/opBC-50000.par,opBC-51809.par,opBC-51813.par: Added a partial
        bad column on the b2 CCD that is responsible for some of the absorption
        glitches seen in fibers 343+344 (c.f. PR #3681).
examples/opECalib-51577.par: Update the gains based upon work by Eric Switzer
        and a more careful look at a recent set of identical flats taken
        on the night MJD 53114.  I've updated the numbers as follows for
        the two gain and two read noise values per CCD:
           b1:  1.13 1.13  3.9 3.3  -> 1.10 1.05  3.86 3.24
           b2:  1.32 1.32  3.7 3.26 -> 1.23 1.26  3.88 3.38
           r1:  1.15 1.00  3.7 3.7  -> 1.09 1.00  4.08 4.04
           r2:  1.00 1.05  3.7 3.7  -> 1.05 1.05  4.32 4.12
        Note that this is the opECalib file used for the vast majority of data.
include/export.h: New export.h file in the IDL 6.2 beta distribution.
lib/Makefile: For "make clean", also remove ".a" and ".dylib" files.
pro/Makefile: Remove reference to pro/fplan directory, since all those
        deprecated routines have been removed.
pro/photoz/Makefile: Add this Makefile.
templates/eigeninput_star.par:
        Shift all of the normal stellar templates (O through M) to
        agree with the Elodie redshifts in the v5_0_0 reductions.
        Shift the CarbonWD and Carbon star templates by +65 km/sec.
        No change to the WD or WDmagnetic velocities (out of ignorance).
templates/spBsplineQSO-53115.fits: Fist attempt at a B-spline composite
        for QSO spectra as a fn. of redshift (made by Burles).
templates/spEigenCVstar-53724.fits,spEigenGal-53724.fits,spEigenQSO-53724.fits,
        spEigenStar-53724.fits: Rebuilt these templates using an untagged
        version of the reductions essentially equivalent to v5_1_0, such
        that the spectrophotometry will be improved.  Note that we still
        mean to improve these templates at some later date by improving
        the lists of input objects, especially for stars.
templates/wfEigen*.fits: Add WFCCD templates from Prochaska

-------------------------------------------------------------------------------
v5_0_0 (Feb 19, 2004 idlspec2d running on IDL 5.4 - 6.0
Built against specflat v1_5, elodie v1_0, idlutils v5_0_0.
The speclog product was also tagged at v1_3, valid through MJD=53054 (today).

Next major release of Spectro-2D, with the "Version 5" data model.
Only minimal changes to P-1D, but search galaxy redshifts to z=1.

APO_PLOTSN,QUICKTRACE: Need the /APOTAGS in the call to READPLUGMAP(),
        which has been re-written to be used by the full 2D reductions too.
BADFMAGS: Find bad F star photometry that might get used by Spectro-2D.
BADFSTARS: Find bad F stars used for spectro-photometry in the Spectro-2D.
BATCH2D: Call SPCOMBINE_V5 instead of SPCOMBINE.
        Update the list of output files to correspond to the new v5 outputs.
COMBINE1FIBER: Add the skies by inputting SKYFLUX and outputting NEWSKY.
        The skies are combined in the same simplistic manner as the
        dispersion pixel map.
        Make loop variables type long.
        In this case of no good points, set the NODATA bit everywhere.
        Also, if NOPLUG is set in the first input bit-mask, assume it
        should be set everywhere in the output bit masks.  No other mask bits
        are set in this case of no data.  This should address PR #3690.
DJS_FLUXCORR,FLUXCORR: Remove these deprecated routines, which are now
        replaced with FLUXCORR_NEW (if using SPCOMBINE) or SPFLUXCORR_V5
        (if using SPCOMBINE_V5).
EXTRACT_OBJECT: Turn off telluric-corrections by default, which must now
        be enabled with the /DO_TELLURIC keyword.  Also, delete some old code.
        Compress (with gzip) the output file.
FIBER_ROLLCALL: This code has been broken out of PLATESN.
FILTER_THRU: SDSS filter curves are now in the idlutils products under
        the subdirectory data/filters.
FIND_NMINIMA: Fix bug when plotting.
FLUX_DISTORTION: New function for computing the overall flux-distortion
        on an entire plate using the spectrophotometry compared to the
        fluxes in the plug-map structure.
FSTARS_PLOT: New code to make color-color plots of spectro-photometric stars
        as compared to the stellar locus and BD+17.  This code actually dates
        back to Sep 2002, but was never checked in.
GET_TAI: Report warning about exposures less than 2 minutes only
        for science or smear exposures.
JEG_SPHOTO_COEF: Christy's spectrophotometry code using Jim Gunn's functional
        form to correct using the PHOTO magnitudes.
KURUCZ_FITSFILE: New proc for generating a single FITS file from a list
        of ASCII-formatted Kurucz models.
LINEBACKFIT: Consolodate some of the print statements from MPFIT onto 1 line.
LRGMODEL_TRAIN: Calling script for training the Bruzual-Charlot models
        for photo-z's.
PCA_GAL: Set the starting wavelength to 1850 Ang so that we can go to z=1.0;
        it was 2300 Ang, which only let us fit out to z=0.6.
PCA_STAR: Interpolate over bad pixels in the middle of any spectra,
        but still set any bad end pixels to zero (as before), which should
        make those pixels be ignored in the redshift-fitting code.
PLATELIST: Get rid of the SMEARUSE entry, since it is now deprecated.
        Include any public plates in the default output file; this is
        because there are some DR1,DR2 plates that are called 'bad', but
        we probably still want them in the full merge files.
        Read the spectro-photometry keywords [GRI]OFFSTD,[GRI]OFFRMS, etc.
PLATESN: Remove the code that adds the spectro-photometry keywords to
        the output headers, since P-1D does this more carefully.
        Split out the fiber "roll call" code into FIBER_ROLLCALL.
        Add a bunch of spectro-photometry keywords to the FITS header,
        such as GOFFSTD,GRMSSTD,... -- These will be read by PLATELIST.
PLOTSIGNAL: New routine for making diagnostic plots of the signal seen
        by the spectrographs, unlike most of our routines that show S/N.
PLOTSN: Re-write of the code that makes all the plots beyond the first
        page of S/N plots.  Compare the spectro-photometry to the CALIBFLUX
        entries in the plug-map structure if they exist.
PLOTSPEC: Add the /SKY option for over-plotting the sky.
        Add the /ALLEXP option for plotting the fluxes from all exposures,
        rather than the co-added spectrum.
PLUG2TSOBJ: Add /SILENT option.
PLUGFILE_RELABEL: Relabel the OBJTYPE's for specified objects in all
        plPlugMapM files.
READONESPEC: New proc for reading single exposure spectra (from spCFrame files).
READPLUGMAP: Many changes to this code, which is now used by both SOS
        and by Spectro-2D.  Options /APOTAGS,/DEREDDEN are for the SOS code.
        Option /CALIBOBJ is for the Spectro-2D reductions, and re-calibrates
        the photometry to the Princeton calibObj files.
        Also read SFD_EBV (reddening values) with the /CALIBOBJ option.
READSPEC: Add support for reading the sky (SKY=) from HDU #6 of the spPlate
        files.
        No longer name the returned plug-map structure, since we may be
        adding tags to this structure, and I believe structures no longer
        need to be named in order to concatenate them in IDL.
SKYSUBTRACT: Fix possible crash condition, whereby the re-fit to the
        supersky is not done if the first fit failed and FULLBKPT does
        not exist (line 243).
SPBIASGEN,SPFLATTEN2: In the output headers, start numbering the EXPID
        keywords at EXPID01 instead of 00.  Also, drop MJD from that string.
        This makes it consistent with the keywords in the spPlate files, for ex.
SPCALIB: Change the way we spawn the gzip command.
SPCOADD_FLUXED_FRAMES: Christy's code that now de-reddens the spectra;
        definitely do not use!
SPCOADD_FRAMES: Get rid of some unused lines of code.
        Get rid of returned synthetic mags + S/N values from PLATESN,
        since I've excised that code, and don't write the undocumented
        last two HDUs to the spPlate files.
SPCOADD_FRAMES,SPCOADD_V5: For the EXPIDxx keywords in the output spPlate file,
        start the numbering with EXPID01 (instead of 00) because that's more
        like the FITS standard, and SXPAR('EXPID*') can then be used.
        Also, drop the MJD from this identifying string, so that the first
        11 characters can be used to directly determine the names of the
        individual spFrame or spCFrame files.
        Call FIBER_ROLLCALL from this routine, rather than doing it in PLATESN.
SPCOADD_V5: New code to replace SPCOADD_FRAMES for version 5 outputs.
        The sky vectors are now combined in some semi-rational way,
        and output as HDU #6.
SPCOMBINE: Pass all arguments if this proc is called recursively.
SPCOMBINE_V5: New code to replace SPCOMBINE for version 5 outputs.
        Add call to FLUX_DISTORTION to compute the 2-D spectro-photometric
        corrections.  This modifies the fluxes both in the spCFrame and
        the spPlate files.  This is a fairly major change, in that the
        spectro-phometry is now explicitly tied to the plugmap-structure
        magnitudes and colors (at least in the mean).
        We currently hard-wire the rejection of all smears, all exposures
        with any CCDs with (S/N)^2 < 1, and any with (S/N)^2 less than 20% of
        the best exposure.
SPFLUX_V5: New code to replace SPFLUX for version 5 outputs.  This computes
        the spectro-photometry vectors on an exposure-by-exposure basis
        (though doing the fit on all exposures at once).  The low-order
        per-object flux-correction vectors that used to be handled
        (through a call to FLUCORR_NEW) must now be handled separately,
        and *after* the call to this routine.
SPFLUXCORR_V5: New code to replace FLUXCORR_NEW.  This will be called
        by SPCOMBINE_V5.
SPFRAME_READ: Routine for reading specified HDUs and fibers from either spFrame
        or spCFrame files.
SPREDUCE: Abort and return from this procedure if no good flats exist.
        Call READPLUGMAP() to read the plug-map file, and get the photometric
        calibrations from the calibObj files.
SPREDUCE1D: Dispose of COUNTS_SPECTRO,COUNTS_SYNTH in favour of the fields
        SPECTROFLUX,SPECTROSYNFLUX which are in nano-maggies (1e9 larger).
        Also compute SPECTROSKYFLUX,SPECTROFLUX_IVAR,SPECTROSYNFLUX_IVAR
        from the sky vectors, which are now in the new spPlate files.
        Log peak memory usage.
        Fit galaxy redshifts out to z=1.0 (instead of 0.6).
        Add the /verbose option to the zfind() function for the main loop
        finding galaxy redshifts and QSO redshifts, since those are the two
        loops where this code spends most of its time.
SPREDUCE2D: Report peak memory usage.
SPREDUCE,SPREDUCE2D: Pass the optional /DO_TELLURIC along to EXTRACT_IMAGE.
UPDATE_PLATE_RELEASE: Code to mark the DR2 plates (for example) from
        the "etc/dr2spectro.par" file into "etc/spPlateList.par".
VDISPFIT: Change the SPLOG of "Using previously cached..." to a simple
        print statement so it doesn't go in the log files so many times.
ZCOMPUTE: Do not be so verbose (printing a line to the log for every fit)
        unless a /verbose keyword is set.  This is because the log files
        were being dominated by this one line!

etc/dr2spectro.par: List of DR2 plates from the web site
        "http://www.sdss.org/dr2/coverage/dr2spectro.par".
etc/spChunkList.par: Add chunks 87-89.
etc/spPlateList.par: Add list of DR2 plates.
etc/sdss_*.dat: Remove these SDSS filter curves, which are now in the
        idlutils products under the subdirectory data/filters.
etc/skylines.par: Updates many of the sky lines to agree with the NIST 2.0
        database at "http://physics.nist.gov/cgi-bin/AtData/main_asd".
        The changes are very minor.  This does not update any of the OH lines.
        Change the HgI 5460.74 wavelength to 5460.94 Ang; this is completely
        ad hoc, simply because it *looks* like the line always ends up there
        (c.f. PR #3259).  This may be the actual centroid of the line since
        it is pressure-broadened in a funny way, but this should definitely
        be checked (the PR will not be closed).
include/export.h: Change to be consistent with the file by the same name
        in the idlutils product.  This has two minor changes for SGI 64-bit.
templates/eigeninput_star.par: Remove the 3 objects labelled Carbon_DQred,
        since those were actually BAL quasars (c.f. PR #3953).
        Also, rename the "Carbon_DQ" objects as "CarbonWD".
templates/kurucz_stds_raw_v5.fits: FITS file with Kurucz templates
        generated by KURUCZ_FITSFILE.  This is simply the set of Kurucz
        ASCII files collapsed into a single FITS file, which is then
        used by SPFLUX_V5.
templates/spEigenCVstar-53054.fits, spEigenGal-53054.fits,
        spEigenQSO-53054.fits, spEigenStar-53054.fits:
        These are a new set of templates built from almost exactly the
        same list of objects as before, but using preliminary v5 reductions.
        Also, some mis-classified stars removed from the star list.

-------------------------------------------------------------------------------
v4_11 branch + v4_11_0 (Feb 6, 2004)

This branch was created by Lupton for FNAL operations.
The branch point was v4_10_7 == v4_11_0, with the following changes:

Four files copied from the mainline as they were on this date
which was a tag on the mainline called RHL-create-v4_11):
  pro/fluxfix/jeg_sphoto_coef.pro : New routine
  pro/fluxfix/spcoadd_fluxed_frames.pro : Only changed by Tremonti
  pro/spec2d/platesn.pro : Only changed by Tremonti
  pro/spec2d/plotsn.pro : Bug fixes by DJS and later changes by Tremonti.

-------------------------------------------------------------------------------
v4_10_7 (Dec 11, 2003 idlspec2d running on IDL 5.3 - 5.6
Built against specflat v1_5, elodie v1_0, idlutils v4_10_7.
Tagged for fixing SOS PR #5735.

COLLIMATE: Since the DJS_SVDFIT() function was removed in v4_10_1,
        explicitly compute the chi^2 minimum with a matrix inversion.
FIND_NMINIMA: If the fit value of YPEAK is less than zero, then change
        it to zero.  This code is always used for chi^2 minimization,
        and a negative value for the chi^2 would not make sense.
LRG_PHOTOZ: New simple photo-z finder for LRGs using a single template.
LRG_PHOTOZ_TEMPLATE: Code to tweak the photo-z template used by LRG_PHOTOZ().
LRG_PHOTOZ_TEST: Code to test the photo-z's.
LRGMODEL_PHOTOZ: Photo-z finder using Bruzual-Charlot elliptical galaxy models.
LRGMODEL_TWEAK_TEMPLATE: Code to tweak the Bruzual-Charlot model parameters
        used for the templates in LRGMODEL_PHOTOZ().
NEWSPCOMBINE: Christy's code: changed so that if one frame does not make
        the S/N cut then all 4 frames of that exposure are rejected.
PLATELINKS: Call SPAWN with the /noshell option to greatly increase
        the speed of this procedure.
PLATEMERGE: Major re-write to use less memory.  All of the ZANS structures
        are read into memory at once, but not all of the TSOBJ structures.
        The output file are written one plate at a time, with the TSOBJ
        structure for that plate read only when it is needed.
        Functionally, the outputs are exactly identical.
PLOTSN: Christy's last page of plots calls GAUSSFIT(), which can crash
        with too few points.  This happened on the special plate 1180
        on MJD 52974.  I've changed this to using DJS_ITERSTAT.
QUICKEXTRACT: The logic to trim away extra sky fibers when there are
        more than 20 appeared to be incorrect, and could trim away most
        or all sky fibers.  I fixed this, and also now choose 40 skies
        in the case of many skies.
SDSSPROC: Don't print bias noise level if /silent is set.
SPREDUCE2D: Print the version of "speclog".

bin/sprobot_start: Insist that the cvs version of speclog be set up
        for running this robot.
doc/www/idlspec2d_install.html: Change instructions to installing with EvilUPS.
doc/www/spectro_home.html: Include instructions to download EDR and DR1
        using wget.
etc/spChunkList.par: Add chunks 80-84, 85-86.
pro/Makefile: Add photoz directory
templates/spLRG-52928.fits: LRG templates for LRG_PHOTOZ function.

-------------------------------------------------------------------------------
v4_10_6 (Oct 15, 2003 idlspec2d running on IDL 5.3 - 5.6
Built against specflat v1_5, elodie v1_0, idlutils v4_10_6.

ATMDISP_COR
DJS_SFIT_ITER
DR1_SPPLATE_COR (removed)
FLUXCALIB_RESID (removed)
FLUX_STANDARD (removed)
FRAME_FLUX_CALIB
FRAME_FLUX_TWEAK
KURUCZ_RESTORE
NEWSPCOMBINE,
PCA_FLUX_STANDARD
PLATE_FLUX_RECAL (removed)
RECTIFY
SMEAR_COMPARE
SPCOADD_FLUXED_FRAMES
SPDATA2MODEL_RATIO
SPHOTO_CALIB
SPMEDIAN_REBIN
SPPLATE_CORRECT (removed)
SPREAD_FRAMES
STYPE_STANDARD: More development by Christy.
UNDO_SMEAR (removed)
ZEROPT_COR (removed)

APOPLOTGEOM: This is a plotting routine to visualize the geometry of the
        arc lines on the CCD from the Son-of-Spectro outputs.  It was
        written in Nov 2002, but never checked in.
COMPUTECHI2: Do the chi^2 computation in double-precision.
DAYTIME_TEST: Proc to look for spectro exposures taken during the day
        and not marked as test.
DR1LIST_BEST: Proc to determine which plates *should* have been in DR1
        that match the tiles of those actually chosen.
FILTER_THRU: Make silent in call to xy2traceset.
FIND_UNPLUGGED: Proc to find all unplugged fibers that still seemed
        to get a spectrum in the reduced data.
FITSN: Changed call to the obsolete function POLYFITW, to the newer
        but worse POLY_FIT.
        Apply a work-around to the apparent change in PHOTO fiber-mags,
        as discussed in sdss-obs/4029 and PR #5642.  Shift the blue
        and red fit magnitudes from:
          [18.20,19.70] -> [18.33,19.83] in blue
          [17.90,19.40] -> [18.06,19.56] in red
LISTEXPTIME: New simple proc for listing all exposure times.
PCA_SOLVE: Added /quiet keyword.
PHOTO_LOADER: New proc to write PHOTO outputs from SDSS_READOBJ() to an
        ASCII stream for direct input into Postgres; written by Hogg
        and Schlegel.
PLATECEN_TEST: Proc to check the consistency of the RA,DEC positions in
        the output spPlate file headers.
PLATESN: New header keywords ROFFSET & RSIGMA store the offset and standard
        deviation of the r-band difference in the spectro and photo mags.
        GIOFF and GISIGMA store the offset and scatter in the (g-i) color.
        Changed (g-i) to (g-r).
PLOTSN: Fixed histogram scales, changed colors for histograms.
        Changed (g-i) to (g-r).
        Tremonti has added return values for ROFFSET,RSIGMA,GROFFSET,GRSIGMA,
        but these are not documented.  Also, ignore objects with PLUG.MAG[2]
        <= 0 (but what would those be?).  Plotting ranges changed.
        A 3rd set of plots for histograms.
        (Revert this code back to v4_10_1 if need be.)
PLUGFILE_UNMAPPED: Proc to list which fibers in a plPlugMapM file are unmapped,
        and the info that might help decide where those fibers should be.
QUICKEXTRACT: Apply a work-around to the apparent change in PHOTO fiber-mags,
        as discussed in sdss-obs/4029 and PR #5642.  Shift the mags at
        which to evaluate the S/N from:
          mag=20.20 -> 20.33 in blue
          mag=19.90 -> 20.06 in red
SDSSPROC: Compute the standard deviation in the bias region again,
        but using a weaker 5-sigma clipping.  This is done solely
        for the purpose of identifying any electronics problems,
        such as that on the left half of r2 on MJD 51779.
        Trigger a warning message if above 10 ADU.
        This addresses PR #3700.
SMEARTIMES: Proc to list the TAI timestamps of 'smear' exposures in a log file.
        The purpose of this is to get an exact list of times and determine
        from the TPM logs whether the telescope moved in the way that it
        was supposed to during these 'smear' exposures.
SPREDUCE1D: Add the "UNPLUGGED" value to the ZWARNING flag.
        Add the fields SPECTROFLUX,SPECTROSYNTHFLUX,SPECTROSKYFLUX
        which are the same as the COUNTS* fields but in nanomaggies
        instead of maggies, which are the same units as our imaging outputs.
UPDATE_PLATELIST: Proc for easily updating the spPlateList.par file.

doc/spectroSOS.html: Add the warning message about "Std. dev. in bias region".
etc/atmdisp_vec_am1.1.see2.0.fit - Tremonti's atmos. dispersion corrrection?
etc/atmdisp_vec_am1.2.see2.0.fit - Tremonti's atmos. dispersion corrrection?
etc/atmdisp_vec_am1.3.see2.0.fit - Tremonti's atmos. dispersion corrrection?
etc/atmdisp_vec_am1.4.see2.0.fit - Tremonti's atmos. dispersion corrrection?
etc/atmdisp_vec_am1.5.see2.0.fit - Tremonti's atmos. dispersion corrrection?
etc/emlines.par: The [O_II] lines were updated from Peter van Hoof's web
           site at: http://www.pa.uky.edu/~peter/atomic/
etc/kurucz_stds_v5.fit: Made with new SPECTRUM code.  Use white dwarf
           correction to colors.
etc/kurucz_model_fix.fit (removed)
etc/kurucz_stds_interp.fit (removed)
etc/spChunkList.par: Add chunks 28A, 71, 68A.  Chunk 62 should be "special",
           not "main".  Add chunks 77,78,79.
etc/spPlateList.par: Update from 20 Nov 2002 to 11 Sep 2003.
pro/Makefile: Add the plan subdirectory.
ups/idlspec2d.table: Get rid of all the $UPS_PROD_FLAVOR references for
           dependent products.

-------------------------------------------------------------------------------
v4_10_2-2003/8/13
This is an untested version of the code with the files in some
state between v4_10_1 and v4_10_6.  It was created retro-actively
by RHL on 18 March 2004 to tag the code as is stood on 13 Aug 2003.

-------------------------------------------------------------------------------
v4_10_1 (Jun 18, 2003 idlspec2d running on IDL 5.3 - 5.5
Built against specflat v1_5, elodie v1_0, idlutils v4_10_1.

Builds spAll summary files using Princeton calibObj files.

DJS_SVDFIT: This proc removed, since it was a temporary fix to
           be called for solving a singular matrix from FIND_NMINIMA.
FIND_NMINIMA: Remove use of DJS_SVDFIT (which didn't work on the Mac
           anyway).  Re-write the fitting to exactly three points
           with an explicit solution of the quadratic equation.
           Add another error code (-7L) for the case where all of the Y
           values are identical, in which case the fit is impossible.
FINDSPEC: Rationalize the calling sequence to be more consistent
           with SDSS_FINDIMAGE.  Get rid of /DUPLICATE keyword, and
           add /BEST keyword.  Allow matching multiple objects per plate
           if the search radius is large.
FITMEANX: Add MINSDEV and INMASK optional keywords.  Both these are
           used by LOCATESKYLINES to prevent the S/N of some lines getting
           infinitely large.  This happened for the r1+r2 exposures on
           plate 336/51999, where the first sky line was off the edge
           of the plate for most of the lines.
GET_TAI: Add /SILENT option.
LOCATESKYLINES: Change MAXSHIFT from 2.0 pixels to 3.5 pixels.  The worst-
           case real arc->science flexure that we've seen is 3.2 pix
           for the r2 camera on plate 192 MJD 51461.
           Use the INMASK keyword in the call of FITMEANX().
PLATELIST: Use PLUG_RA,PLUG_DEC to match duplicate observations of
           individual objects, rather than RA,DEC (which can be zeros
           if there was no match to the photometry).
PLATEMERGE: Small changes to allow using the (new) calibObj files
           instead of the (old) tsObj files.
           For the ASCII output, write MODELFLUX instead of COUNTS_MODEL.
           In call to PLUG2TSOBJ, pass PLUGMAP so that warnings of unmatched
           sky fibers are not printed.
           Add SPECOBJ_ID and NSPECOBS to the output structure.
PLUG2TSOBJ: Small changes to allow reading of the (new) calibObj files.
           For now, assume these files are in $SPECTRO_DATA/calibobj.
           Print a warning message for non-matched objects only if they
           are not skies.
READSPEC: Add internal function RSPEC_ZLINE_APPEND() for appending two
           zline structures, even if they are different structures or
           have different number of lines measured.
SDSSPROC: Call the new proc WARN_DAYTIME.
SPCALIB: The correct TSET structure was not always being written
           to the spFlat files (though those files aren't actually
           used for anything), nor the FIBERMASK array.
           Write those files directly from the FLATSTRUCT,ARCSTRUCT
           structures instead.  Also, gzip those two output files.
SPPLAN2D: Exclude files where the plate number does not match that
           in the map name.  This happens, for ex, for exp #14970 on
           MJD 52405, which has the MAPNAME for plate 802 but a PLATEID
           of 9999.
SPREDUCE: Major change to how the flat+arc calibrations are chosen.
           Now choose the flat that is good and nearest in time to
           the midpoint of all the science exposures.  Select the arc
           that was used for that flat (regardless of whether it was
           the best arc).  Previouly, we chose the flat that was nearest
           in time to each exposure, and we chose the best arc regardless
           of the time it was taken.  This had the potential to choose
           an arc taken during the afternoon (as happened for plate 820
           on MJD 52405, c.f., PR #3966) if it is not explicitly marked
           as a test exposure.
WARN_DAYTIME: New proc to print a warning if an excellent-quality exposure
           taken with the Sun up.  For example, this is how the bad arc
           exposure got in to ruin plate 820/52405 (PR #3966).

bin/speclog_update: New bash script to update the "speclog" product for one
           or more MJDs from the astrolog directory.
bin/sprobot_start: Put the environment variable $CVS_RSH into the cron file,
           for use by the "speclog_update" script.
           No longer set $SPECLOG_DIR=$ASTROLOG_DIR, since now they
           really are different.
bin/sprobot.sh: After copying the astrolog files, call the "speclog_update"
           script to make a CVS-versioned copy from $ASTROLOG_DIR->$SPECLOG_DIR.
doc/www/spectroSOS.html: Add warning message for "Sun above horizon."
examples/opHdrFix.par: Go through all the headers looking for flat, arc,
           or science exposures taken while the sun was up.  Discard them
           in this file, which takes care of all corrections through
           MJD 52426 (1-Jun-03), after which the sdHdrFix-$MJD.par files
           are used.
ups/idlspec2d.table: Add dependency on "speclog" product.
ups/Makefile - Get rid of the confusing dependency on
               $(SDSSTOOLS_DIR)/bin/install_ups_table.

-------------------------------------------------------------------------------
v4_10_0 (Apr 8, 2003 idlspec2d running on IDL 5.3 - 5.5
Built against specflat v1_5, elodie v1_0, idlutils v4_10_0.

Test against new idlutils.

APOHEADER: Allow an optional keyword MJD (to speed things up).
CREATE_LINESTRUCT,LINEBACKFIT,SPREDUCE1D: Replace LINENPIX with the number
           of pixels to the left and right of the line center, LINENPIXLEFT
           and LINENPIXRIGHT.  Use both of those to trigger the warning
           NEGATIVE_EMISSION from quasars, which was triggered sometimes
           when there were only pixels to one side of the line center
           (PR #3797).
FLUX_STANDARD: Added empirical correction to SPECTRUM-Kurucz models.
           Then got rid of them!
GET_TAI: Trigger a Warning if (TAI-END) - (TAI-BEG) < EXPTIME + 20 sec.
PLATECOMPARE: Also plot any objects that have ZWARNING set to zero
           in one observation and non-zero in another.
PLATELINKS: New proc for generating symbolic links to either all of the
           interesting files in the $SPECTRO_DATA tree, or one of the
           public subsets (e.g., "EDR" or "DR1").
PLATEMERGE: Create spAllLine files.  Allow PUBLIC to be a keyword specifying
           any of the public subsets (e.g., "EDR" or "DR1").
PLOTSPEC: Fix trivial bug (had "EXTRA" instead of "_EXTRA") in passing
           additional plotting keywords to plots.  Also, pass those
           keywords along to the XYOUTS commands.
PLOTSN: The last plot was accidentally showing i-band residuals instead
           of r-band.
SPHDRFIX: Test if the opHdrFix file (or the directory!) even exist at all.
           Otherwise, if the directory does not exist, we'll get stuck in
           an infinite loop.
READSPEC: Fix minor bug that would truncate the wavelength mapping
           when spectra are read from multiple plates and /ALIGN not used.
SPPLATE_CORRECT: Fixed small bug so that it works with the smear left in.
SPREDUCE1D: In setting the NEGATIVE_EMISSION flag for QSOs, demand that
           the line be negative by at least 3-sigma.
STYPE_STANDARD: Fixed error in smoothing box size.
ZEROPT_COR: Added range checks to get rid of seg faults.

bin/sprobot.sh: Instead of looking for "/data/spectro/$MJD" to get
           an MJD list, look for "/data/spectro/astrolog/$MJD".
           This will get the log files for MJDs where there are no
           spectroscopic data.
bin/sprobotlist.sh: Add calls to PLATEMERGE for the EDR and DR1 subsets.
etc/kurucz_model_fix.fit - New file for empirical corrections to
           SPECTRUM-Kurucz models, used by FLUX_STANDARD.
examples/opHdrFix.par: More updates, in an attempt to identify
           all exposures with wrong exposure times in their headers
           due to various SOP and DA bugs.
           Flag a bunch of old data as bad, where I've specifically searched
           for short science exposures.
           Change all FLAVOR='unknown' entries to QUALITY='bad'.
pro/fluxfix/Makefile - Forget to add this Makefile, which is needed
           to prevent the "make install" from crashing on an IRIX platform.
ups/idlspec2d.table: Change flavor to "ANY".

In idlutils:

DUST_SDSSFILTER: New proc to integrate the extinction curve over
           a selection of representative source function and the SDSS filters.
DUST_INTFILTER: New proc to integrate the extinction curve over a
           given source function + filter curve.
GSC_READ_TABLE: New proc to read one table from the Guide Star Catalog.
HOGG_SCATTERPLOT: New proc to plot greyscale scatterplot with contours.
MWRFITS_CHUNKS - Do not always create a new file (unless /CREATE is set).
NONNEG_MULT_UPDATE,NONNEG_MULT_UPDATE_SOLVE: New code from M. Blanton
           for non-negative least-squares solving.  This is a special
           case of box constraints in quadratic programming, as suggested
           by Sha, Saul, & Lee (2002), "Multiplicative updates for
           nonnegative quadratic programming in support vector machines"
           (UPenn Tech Report MS-CIS-02-19)
STRUCT_PRINT: If /NO_HEAD is set, do not increase the width of a column
           to occomodate the column name.  New FORMATCODES option.
STRUCT_TRIMTAGS: Would not have worked if only the very 1st tag were selected.
YANNY_WRITE: New options /ALIGN and FORMATCODES, even though these options
           make it possible to write invalid Yanny files.

Various astrometric routines have been moved from the hoggpt product
into pro/astrom.  The USNO routines have been modified for reading
the USNO-B1.0 catalog (as well as USNO-A1,USNO-A2).
LL2UV
USNO_CONE
USNO_READ
USNO_READZONE
USNOB10_EXTRACT
UV2LL

Various "mangle" utilities added by M. Blanton in pro/mangle.

evilinstall: Moved to the photoop product.
evilmake: Turn on optimization for all platforms except IRIX.
           Previously, we tried to set -O3 on IRIX, which crashes
           builds on the machine sdsshost.apo.
src/spheregroup/chunks.c - Minor bug fixed.
ups/idlutils.table: Change flavor to "ANY".

-------------------------------------------------------------------------------
v4_9_13 (Nov 24, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

Support for Mac OS X platform.  New features + minor fixes for SOS.
First check-in of Tremonti's flux-calibration code, though not integrated.
Check-in of dust map code.  Re-write of YANNY_READ.

APO_LOG2HTML: Default link to GIF plot, with another link to PostScript.
APOPLOTARC: New proc for plotting arc spectra from the Son-of-Spectro outputs.
APOPLOTSKY: New proc for plotting sky spectra from the Son-of-Spectro outputs.
APOREDUCE: Convert the PostScript plot to GIF format using "pstogif",
           which is in idlutils.
EXTRACT_ROW: Be sure to pass "whoppingct" as type LONG to the C code.
           If not, then it fails on the Mac OS X platform.
FIND_NMINIMA: Fix tiny bug for optional plots.
FINDSPEC: Add the optional keyword SEARCHRAD.
GUIDERMOVIE: The format for the date in the header of the guider images
           has changed.  This code should now comptabably read the old
           or new date format.
HELIOCENTRIC: Moved to idlutils product.
LINEBACKFIT: Change how the error on equiv. width (LINEEW_ERR) is computed.
           I believe it was incorrect before, and should simply be
           computed from LINEAREA_ERR,LINECONTLEVEL_ERR.
PLATELIST: Replace the plate center RA,DEC with that of the object
           closest to the center for those cases in which the spPlate
           headers got the wrong coordinates (see PR #2419).  When
           these are replaced, print a WARNING statement.
           Be more silent when calling MRDFITS(),HEADFITS().
PLATEMERGE: Search for overlaps in plates with a somewhat larger radius,
           just to be somewhat immune to errors in listed plate centers
           (for ex, see PR #2419).  Also, print some more informational
           messages.
PLOTSPEC: Bug fix to allow one to specify the output file name with PSFILE=.
           Fix units on Y axis to /cm^2 instead of /cm.
QUICKEXTRACT: Change print statement for whopping fibers to one per line.
           Write SSET,RELCHI2STRUCT to the output "sci-" file.
READ_ELODIE: Use INTERPOL() instead of POPULATE_IMAGE for interpolating
           the high-resolution Elodie spectra onto the log-wavelength binning.
           I'm still uncertain as to the absolute units of the spectra.
READSPEC: Add PATH option, which can override TOPDIR.
           Determine the MJD dynamically if set equal to 0.
SDSSPROC: Fix silly bug trying to set QUALITY='excellent' when undefined.
SLITHISTORY: New proc to plot history of spectro slit-head positions
           based upon the (new) plSlitps files from the mapper.
SOLVEFILTER: New proc to determine the 2.5-m filters from the spectra.
SKYSUBTRACT: Optionally return SSET, which is the B-spline structure
           for the supersky.  This will be used by APOPLOTSKY.
SPCOADD_FRAMES: Change BUNIT header keywords in output files to have
           the comment '1E-17 erg/cm^2/s/Ang' instead of the incorrect
           comment '10E-17 erg/cm/s/Ang'.
WRITE_UROS: Add Flatvec,Rnois to output files.

New procs from Tremonti in pro/fluxfix:

DR1_SPPLATE_COR: Modify a list of spPlate files for improved spectrophotometry.
FLUX_STANDARD: Solve the flux-calib vectors for a single camera+spectrograph.
PLATE_FLUX_RECAL: Called by SPPLATE_CORRECT.
SPPLATE_CORRECT: Correct the flux calibration of the spPlate files for DR1.
STYPE_STANDARD: Spectral type the standard stars and save the result as
           a FITS file. (This should probably be changed to return the result).
UNDO_SMEAR: Create correction vectors for 1 plate which can be used to
           remove the the effects of "smear" from the spectra.
ZEROPT_COR: Compute a zeropoint correction to the flux calibration.

aporsync_alllog.sh: New shell script for copying all of the log files
           from sdsshost.apo:/astrolog/$MJD to the sos.apo machine.
           This will be done once per day at 7:45.  This rsync must
           follow symbolic links on sdsshost.apo, since it now looks
           like quite a few of the files there are now symbolic links.
           (That's crazy, but what's a guy to do?)  Copy the last 7 nights
           of logs, whether or not there was spectroscopy.
aporsync_logs.sh: The last line of the first rsync command was accidentally
           dropped in this last version - fix.  Also, only copy sdHdrFix file
           if it exists.  This addresses PR #3968.
           Also copy plSlitpos*.par,plPlugMap*.log files.
export.h: Update this file to agree with the IDL 5.5beta for Mac OS X.
Makefile: Support for new "fluxfix" subdirectory.
opHdrFix.par: Fix the RA,DEC positions in the raw file headers to fix
           some remaining problems for PR #3009.  Specifically, the following
           plates were getting the wrong RA,DEC in the platelist files:
           351/51780, 355/51788, 356/51779, 360/51780, 385/51783, 391/51782,
           395/51783.
           Discard exposures 14967-8 for plate 820/52404.
sos_start,sprobot_start: If the environment variable PATH has more than 1020
           characters than abort.  This is because the PATH appears to be
           truncated beyond that point on certain Linux systems.
           Run the mail program at 8:10 in the morning, rather than 7:20.
           This addresses PR #4194.
spEigenElodie.fits: Recreate with fixed READ_ELODIE().  New first eigenspectrum
           now looks like a normal stellar spectrum.
sprobot_start: Fix tiny typo (extra quotation on line 141).
           Start the main job at 10:30am instead of 10:00am.
sprobot.sh: Change the name of the astrolog directory on sos.apo.nmsu.edu
           from /astrolog -> /data/spectro/astrolog (they changed it!)
sprobot.sh,sprobot1d.sh,sprobot2d.sh,sprobotlist.sh:
           Output the environment variables $IDLSPEC2D_DIR,$IDLUTILS_DIR.
spChunkList.par: Added chunks 48-55.
spPlateList.par: Change yet again to agree with the latest posting from JEG
           of 291 plates.  About a dozen have changed since the Annis list
           dated 13 Oct 02.

In idlutils:

BSPLINE_BKPTS: Integer roll-over bug fixed by DPF for more than 2^30
           data points (doesn't matter for SDSS pipelines, but it
           does for DEIMOS).
DFPSPLOT: Added optional XSIZE keyword.
DJS_BATCH: Add optional keyword SELECTHOST.  This will be used
           for the HoggPT processing of 2.5-m data.
           The inputs LOCALFILE,OUTFILE are now optional.
DJS_LOCKFILE: Add /append option.
DJS_LOCKFILE,DJS_UNLOCKFILE: These routines had a small chance that
           more than one process could lock a file at once.  This
           small chance is now eliminated on Unix platforms running
           IDL 5.4 or later by building a symbolic link as the lock file.
DJS_SFIT: New proc for surface fitting to tabulated data with errors.
EXT_CCM,EXT_ODONNELL: Move these old dust-related routines here since
           they are general-purpose.  They were not previously in any
           repository.
FITS_WAIT: Allow DELTAT,TMAX to be zero.
HELIOCENTRIC: Moved from idlspec2d product, since this is of general use.
HOGG_ITERLINFIT: General-purpose sigma-clipping linear fitting routine
           copied over from the hoggpt product.
HOGG_STRSPLIT: New support proc for YANNY_READ.
LOOKFORGZIP: Also look for ".Z" file if others not found.
POLY_ITER: Change "LT" logic to "LE" to handle case where residual
           is 0 (e.g., a perfect fit)
POPULATE_IMAGE: Fix possible crash condition under Mac OS X when IMAGE
           is 1-dimensional (and NY was not type LONG in the call to C-code).
RADEC_GREATCIRLCE: New proc to solve for the great circle for a set
           of RA,DEC positions at a set of times.
SPLOT: Bug fix in the autoscale code (splot_autoscale_x) that crashed
           on Mac OS X.
YANNY_READ: Make use of Hogg's procedure HOGG_STRSPLIT, which should be more
           robust for parsing strings and speed things up.  Not yet thoroughly
           tested.
           Pre-allocate a large array of length MAXLEN for each structure.
           This should save a huge amount of time when reading large files,
           since we used to concatenate structures with a=[a,b] every time
           a new line was read.
           Add support for compressed files, with file names ending with
           either '.gz' or '.Z'.  This is somewhat complicated by the fact
           that we need to start by getting the number of lines in the file.
           Return an errcode of 0 in the case of no file, which conforms
           to the behaviour of previous versions of this code.
YANNY_READONE: New proc; wrapper for YANNY_READ.
YANNY_WRITE: Default to having the variable names in the typedef's in
           lower-case (not that it matters).

The pro/djsphot directory has been moved from the hoggpt product.
This includes:

DJS_NEFF
DJS_PHOT
DJS_PHOTCEN
DJS_PHOTFRAC
DJS_PHOTSKY
FIND_SIMPLE
QUICK_PHOTFRAC
SQUAREPHOT

These SFD dust routines have been moved here:
BH_RDFORT
DJS_PLANCK
DUST_GETVAL - And modified to read I12, I25, I60 maps also.
FAC_TEMP2FLUX
FAC_FLUX2TEMP
PLANCKCORR
PREDICT_SYNC
PREDICT_THERMAL
SETLOG
WCS_COORD2PIX
WCS_GETVAL

Various astrometric routines have been moved from the hoggpt product
into pro/astrom:
ANGLE_FROM_PAIRS
ASTROM_ENGINE
ASTROM_TWEAK
OFFSET_FROM_PAIRS

evilmake: Add "Darwin" (Mac OS X) as a possible platform.
           Export F77=g77 for the platform.
           This doesn't work yet for Blanton's spheregroup code or Fortran.
export.h: Update this file to agree with the IDL 5.5beta for Mac OS X.
           (There are actually 5 copies of this file in this product!)
sprobot.sh: Comment-out the code that exits if there is no new data.
           This way, we still launch BATCH2D,BATCH1D even if no new data
           has been copied over from Apache Point.

-------------------------------------------------------------------------------
v4_9_12 (Jun 26, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

Minor enhancements for SOS.  For P-1D, now able to generate larger summary
files and improvements to the web site.

APO_LOG2HTML: Change link from SOS web pages to new location at
           "http://sdsshost.apo.nmsu.edu/idlspec2d/spectroSOS.html".
           For the total S/N^2 on a plate, only include exposures
           where quality='excellent', as per PR #3898.
CATPLOT: New proc. Modified version of SPLOT by Tremonti for inspecting spectra.
COLLIMATE: Clarify the output text to say "RMS across CCD", rather
           than implying this is a measurement error (with "+/-").
LINEBACKFIT: Fix typo for setting default value for SIGGUESS.
MAKE_SKYINVVAR: New proc. First attempt to reconstruct the sky background
           with a v4 spPlate file.
PLATEHIST: Select "good" plates based upon "platequality" field
           from PLATELIST.
PLATELIST: Use manually-assigned platequality from "spPlateList.par"
           file when it exists.
           Add fields N_TARGET_MAIN,N_TARGET_LRG,N_TARGET_QSO.
           Add fields SUCCESS_MAIN,SUCCESS_LRG,SUCCESS_QSO.
           Use STRUCT_PRINT to print all ASCII and HTML files.
           Use APO_CHECKLIMITS() to check limits of tabulated values
           and color-code them in the HTML files.
PLATEMERGE: Use MWRFITS_CHUNKS to allow us to write bigger files
           (approximately up to your memory size).
           Add PROGNAME,SPECPRIMARY to ASCII output.
           If SUBCLASS contains several words, then use a plus sign between
           the words in the ASCII file rather than a space (so that awk will
           work).
PLOTSPEC: Added option to use Blanton + Hogg's java viewer (Blanton).
PLUG2TSOBJ: Slight change to find Blanton's files which are now named
           tsObjPlate-*.fits rather than tsObj-*.fit.
SDSSPROC: If MJD <= 51813, then set QUALITY=excellent unless this is
           over-written by SPHDRFIX.  This is because for the early data,
           this keyword was arbitrarily set to 'unknown', 'bad',
           'acceptable', or 'excellent'.  Note that because of this,
           early data will not have their plan files built properly for
           versions v4_9_10 or v4_9_11.
WRITE_UROS: New proc to generate ASCII files of individual exposures
           on spectra for Uros Seljak
ZPLOT: Change "brg" names to "lrg".

aporsync_logs.sh: Add an rsync command to copy the "sdHdrFix*.par" file
           from the sos.apo machine to sdsshost.apo.  Do *not* rsync
           this file from sdsshost.apo -> sos.apo.
mailhtml.sh: Make archival copies of the SOS log file (sos.log), naming
           them sos.log.1dayold, sos.log.2dayold, ....
make_room.sh: Simple script to remove old MJD data directories on sos.apo
           in order to bring free space to above 5%.  Not called by any
           other scripts -- could be dangerous!
opLimits.par: Use the SKYPERSEC limit for either science or smear exposures.
           Add limits for use by the PLATELIST procedure.
spPlateList.par: Update to data through MJD 52413 (19 May 2002).
           Add PLATEQUALITY,QUALCOMMENTS to Yanny structure.
           Remove the following (bad) plates from public data releases:
             266/51602 (Internal LEDs), 360/51780 (b1 CCD warmed up).
sprobotlist.sh: Call the IDL commands ZPLOT and PLATEHIST each night
           from the Spectro-Robot.
sprobot_start: Add a line to the cron job to run at 12:59 am that
           copies the sprobot.log file to sprobot.log.1dayold and
           sprobot.log.2dayold.

In idlutils:

FLOATCOMPRESS: Handle Infs and NaNs.
MWRFITS_CHUNKS: New proc to write a FITS binary table in chunks
           (used by PLATEMERGE).
REPSTR: Change loop indices to type long, which was necessary to the
           call from PLATEMERGE.  We should be sure that this gets
           into Landsman's code version.
STRUCT_PRINT: Add options TARRAY, /NO_HEAD, /HTML, FDIDIT, DDIGIT, ALIAS.
STRUCT_TRIMTAGS: New procedure.
SXASCII_READ: Fixes for sxascii_read, I think it might actually work?!
YANNY_READ: Hacked by Christy to fix the bug to allow semi-colons
           within quotes.  This adds the internal function YANNY_INQUOTES().
           I suspect there may be a better way to do this using REGEXP().
           If someone ever figures that out, the version before this was 1.31
           (which appeared in v4_9_10,v4_9_11).

evilinstall: One line change to do one more check for proper sdsstools.

-------------------------------------------------------------------------------
v4_9_11 (May 31, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

Fix "make install" bugs and crash condition for P-1D.

LINEBACKFIT: Fix crash condition just introduced (testing for return
           status from MPFITFUN).
LOGSHEET: Include UT time, NAME, CARTID, and QUALITY in outputs.

doc/Makefile: Remove invalid copy line.
etc/Makefile: Change copy of "*" to "*.*" so the "make install" does
           not crash on IRIX+6 platforms.
pro/Makefile: Remove invalid copy line.
pro/inspect/Makefile: Added this makefile.
pro/science/qso/Makefile: Fix Makefile.
templates/Makefile: Change copy of "*" to "*.*" so the "make install" does
           not crash on IRIX+6 platforms.
spectroSOS.html: More comments on the QUALITY keyword.

In idlutils:

MJD2DATELIST: Make MJEND optional, so that this can convert one date
           into a string.

evilinstall: Use "awk" instead of "head -1c" so that this script will
           run on an IRIX+6 platform.
bin/Makefile: For the "make install", explicitly copy file names
           rather than just "*".  Using the wildcard tries to copy
           the CVS directory on an IRIX+6 platform, which then
           crashes the install.
goddard/text/Makefile: We were missing this Makefile.
src/math/Makefile: Comment-out the build of the code that Hogg
           just added but doesn't build: idl_nnls,nnls,diff,g1,g2,h12.

-------------------------------------------------------------------------------
v4_9_10 (May 28, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

New version for Son-of-Spectro with more development work.

APO_CHECKLIMITS,opLimits.par: Allow text limits in the opLimits.par file,
           and allow the use of wildcards for flavor,field,camera.
APOFIX: Use QUALITY header keyword to declare exposures bad (as specified
           by PR #3687).  Enclose any string in single-quotes, so that
           the SPHDRFIX routine can desriminate between strings and numbers.
           Add lots of explicit checks for valid values for each keyword,
           and only allow the modification of a small list of keywords.
           Also add /test option.  If the QUALITY card is edited, then
           go through the logfile (logsheet-$MJD.fits) and explicitly
           change the QUALITY fields in those FITS tables (but don't
           regenerate the HTML table?).
APOHEADER: Use SDSSHEAD() instead of HEADFITS() to read the headers, such
           that this printout includes any observer edits to the headers.
           Also fix so that this proc works if both a ".fit" and ".fit.gz"
           file exist on disk.
           Also list the QUALITY keyword.
APOREDUCE: Add the following to the output structure: QUALITY,NAME,OBSCOMM
           RADEG,DECDEG,AIRMASS.
APOREDUCE,QUICKBIAS,QUICKEXTRACT,QUICKTRACE,QUICKWAVE,REMOVE2REDO: Make
           use of /do_lock keyword when calling SDSSHEAD() or SDSSPROC.
APO_LOG2HTML: Add QUALITY column to output table.
GET_MJD_DIR: Comment-out test that MJD directories contain files, since
           that's so bloody slow.
GUIDERMOVIE,GUIDERMPEG: New procs for looking at the spectroscopic guider
           images for a night.
INSPECFILES,INSPECTGEN: New routines for generating prototype files
           for manual inspection.
LOGSHEET: Do not include both uncompressed and compressed files in a listing.
           Remove the INDIR option, and add MJD and CAMERA keywords.
PLATEHIST: Use call to MJD2DATELIST.
PLATEMERGE: Include logic for setting the SPECPRIMARY field in the outputs.
           Speed this up by pre-generating the exact output structure,
           and use structure assignments rather than copy_struct_inx.
           Exclude some tags from the output structure, spec. ROSAT*,FIRST*.
PLOTSPEC: Some major re-organizing of the main routine to allow PLATE,MJD
           to be passed as vectors.  Add optional ZHDR return value.
           Add /RESTFRAME option.
QUICKEXTRACT: Add warning messages for "Median sky-residual chi2"
           and "Max sky-residual chi2".
QUICKTRACE,QUICKWAVE: Do not write the tsetfile or wsetfile if the
           quality of the exposure in not 'excellent' (and remove any
           such file for that exposure if it already exists).
READSPEC: Fix the re-sorting of the ZLINE output structure, which is
           complicated by being a multi-dimensional structure.
REMOVE2REDO: Only allow this proc to run on a machine named "sos",
           unless /not_sos is set.  This is the same logic used by APOFIX.
SDSSPROC: If the OBSCOMM keyword contains the words "dithered" or "focus",
           then assume this is test data (set QUALITY='test').
SDSSHEAD,SDSSPROC,SPHDRFIX: Add /do_lock option to lock the sdHdrFix files when
           running Son-of-Spectro, which can dynamically alter those files.
SPPLAN2D: Exclude all files where the QUALITY header keyword is not 'excellent'
           (as per change requested by PR 3687).
SPREDUCE1D: The output FRACNSIGLO was being computed completely wrong -- Fixed.
ZFIND: Bug fix for when NPOLY=0.

aporsync_logs.sh: Include the "sdHdrFix*.par" files as the first ones
           to copy over from sdsshost.apo -> sos.apo.
data_rsync.sh,killdata.sh: Two minor fixes: (1) gives proper syntax to
           remove files in spectrolog directories, and (2) excludes
           uncompressed guider files from being rsync-ed to rawcopy.
idlspec2d.table: Add optional dependency on "spinspect" product.
pullspectra: New bash script for pulling SDSS spectra from Princeton
           to other institutions.
opHdrFix.par: Update through MJD 52413 (May 2002 dark run).
opLimits.par: Change exposure time limits to [599,1804] sec, in response
           to PR #3653.
spectro_apodisplay.html: Include more links to spectro.princeton web site.
spectro_inspect.html: New file for instructions on manual inspection of spectra.
spectroSOS.html: Include more links to spectro.princeton web site.
           Update to include comments regarding freeing up disk space (PR 3675).
           Update to include changes to declaring exposures bad (PR 3687).

In idlutils:

BSPLINE_ITERFIT: Added /double to computation of INVVAR (line 107).
DJS_BATCH: Fix invalid return codes in a sub-proc.
NNLS: New non-negative least-squares fitting code from Hogg.
POPULATE_IMAGE: Do not recast if image already float (speeds up 4x)

diff.f,g1.f,g2.f,h12.f,idl_nnls.c,nnls.f: C+Fortran code for NNLS proc.

-------------------------------------------------------------------------------
v4_9_9 (Apr 26, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

New version for Son-of-Spectro with added functionality.

APO_LOG2HTML: Add columns for EXPTIME and AIRTEMP to web page tables.
           Comment-out lines that set FONT SIZE="+4", since that shows up
           as huge on the mozilla web browser.
APOALL,APOREDUCE: Add the /no_diskcheck option.
APOHEADER: New proc for the observers' to print the subset of interesting
           header keywords from the raw sdR files.
APOFIX: New proc for declaring exposures bad, or fixing other header files,
           by using sdHdrFix-$MJD.par files (a new file type).
APOPLOT: Bug fix to prevent crash when specifying EXPNUM.
APOREDUCE: Add CARTID,AIRTEMP,CCDTEMP to all output structures.
BATCH1D: Add spZline file to list of output files.
EXTRACT_OBJECT: Mitigate possible crash condition if relchi2struct not set.
LINEBACKFIT: Fix crash condition if there is at least 1 data point, but
           too few points to fit.  When this happens, MPFITFUN() returns
           with STATUS=0 and does not set PERROR, etc.  This crashed
           plate 230/52251.
PLATELIST: Add NGUIDE,FBADPIX,FBADPIX1,FBADPIX2 to structure.
           No longer compute airmass from TAI, since TAI is now an average
           time and may even correspond to the middle of the day if a plate
           is observed over two nights.  Trust the average airmass in the
           spPlate header.  Add PLATESN2,PLATEQUALITY fields.
PLATEMERGE: Limit output file to only 'good' or 'marginal' plates.
           Get rid of /QSURVEY option.  Add the following columns to
           the output FITS file: progname, chunkname, platequality,
           platesn2, specprimary (not using that last field yet).
QAPLOT_SKYSUB: Don't crash even in the case of a single sky fiber
           (as for plate 218/51461).
QUICKEXTRACT: Return the relchi2struct from SKYSUBTRACT, and put SKYCHI2
           in the output structure.
           For the warning message "Whopping", report the fiber numbers
           as 1 to 640, rather than the 0-indexed fibers on each spectrograph.
SKYSUBTRACT: Merely clean out some commented-out code and update internal
           comments.  Avoid a possible crash condition in the case of
           all (or most?) bad sky fibers.  Version v4_9_8 would still crash
           on the bad data for plate 296/51578 on exposure b2-00002076.
           Insist that if we use "everyn" keyword for b-spline fits,
           that it's >=1.
SPHEADERFIX: Use the new file "sdHdrFix-$MJD.par" that can be written
           by the observers' at APO using APOFIX, rather than using the
           same mechanism through the sdReport file (which was never used).

opHdrFix.par: Declare exposures #14537,14571,14638,14653 bad, which were
           previously declared bad in the sdReport files.  But we're no
           longer using the sdReport files for reductions.
opLimits.par: Impose limits on EXPTIME for bias,arc,flat,smear.
           Impose limits on (S/N)^2 for smear exposures.
spChunkList.par: Add chunks 40-42.
spPlateList.par: Update to include list of DR1 plates.
spectroSOS.html: Document the new procs APOHEADER,APOFIX.
sprobotlist.sh: Get rid of "platemerge, /qsurvey" since that option
           no longer exists.

In idlutils:

BSPLINE_FIT: The YFIT vector was not always being computed, depending upon
           how this routine completed.  Also, some Schlegelization of the code.
DJS_BATCH: Quit if REMOTEHOST is not set, or if any entries are null strings.
           This allows us to disable the Spectro robots by commenting out
           all lines in the batch2d.par,batch1d.par files.
DJS_MEDIAN: Allow ARRAY to be a vector, and pass DIMENSION=1; this is the
           degenerate case where a scalar is returned.
FITSDIR,MRDFITS,MWRFITS,READFITS,SXADDPAR: Fink merged the latest bug fixes
           from Goddard.
FITS_READ: This Goddard routine seems to have had a bug introduced,
           whereby MESSAGE is not always set when reading a partially-written
           FITS file.  I *think* this is fixed, but should see what Landsman
           says about this change.
FITS_WAIT: Add _EXTRA keyword for passing options to FITS_READ, such
           as /HEADER_ONLY or EXTEN=.
HOGG_OPLOT_COVAR: New ellipse plotting routine.
YANNY_READ: No need to read the data in this file (only the header
           and structure definitions) if PDATA is not to be returned.
           Get the ABORT statement all on one line.
YANNY_WRITE: Put quotes around empty strings.  Otherwise, this is not
           a valid Yanny file.  Bug fix for when passing STNAMES.

build_links: Over-write existing links, since that's what I'm usually doing.
pstogif: Perl script for converting PostScript to GIF; copied from /usr/bin
           on sos.apo.
export.h: Put a copy of this file in src/slatec and src/trace, though
           perhaps we should really just have an /include subdirectory?

-------------------------------------------------------------------------------
v4_9_8 (Apr 12, 2002 idlspec2d only) running on IDL 5.3 - 5.5
Built against idlutils v4_9_7, specflat v1_4.

Finish development work for 2D and P-1D before big reprocessing.

EXTRACT_OBJECT: Clean up the calls to SKYSUBTRACT, and only modify
           the pixelmask in the final call to SKYSUBTRACT (when we
           do the 2-D sky-subtraction).
PLOTSPEC: Bug fix to label emission lines with /ZLINE.
REDMONSTER,SKYSUBTRACT: Change threshhold for flagging both the BADSKYCHI
           and REDMONSTER mask bits to a relative chi^2 of 4.0, which is
           what we have traditionally used (except in the last tagged version).
SKYSUBTRACT: Do not modify the input PIXELMASK, but make a copy NEWMASK
           which is modified and returned.  This allows several calls to
           SKYSUBTRACT from EXTRACT_OBJECT, where only the last call
           actually modifies this mask.
SPREDUCE1D: Identify subclasses for galaxies and quasars based upon
           emission lines.  Currently set the following possible subclasses:
           AGN, STARFORMING, STARBURST, BROADLINE.

sprobot_start: Fix trivial bug in setting DISPLAY environment variable.

-------------------------------------------------------------------------------
v4_9_7 (Apr 10, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

More development work for 2D and P-1D.
Traceset routines moved from idlspec2d -> idlutils product.

COMBINE1FIBER: Bug fix to get the NODATA bad pixel set in the ANDMASK
           where-ever it is set in the ORMASK.
ELODIE_BEST: Add FITINDX keyword. Expand default fitting range to +/-1000 km/s.
EXTRACT_OBJECT: Add "OPTCHI2" keyword to output header, recording the
           mean chi^2 of the optimal extraction.
           Add "SKYCHI2" keyword to output header, recording the mean chi^2
           of the sky-subtraction.
MYFLUXCALIB: Put the plate+MJD+camname in the plot titles.
PIXELMASK_BITS: Now simply call the new function SDSS_FLAGVAL().
PCA_SOLVE: Allow OBJLOGLAM to either be a vector or an array
           (now passing only a vector from PCA_STAR).
PCA_STAR: Now read the Yanny file "eigeninput_star.par", and use cz.
           Clean up the code, always using the same wavelength mapping
           for both input and output spectra -- this allows us to do
           away with the internal procedure SPAPPEND.
PLATELIST: Make consistent with changes to spChunklist.par.
           Add the elements: WSIG(MA,MIN,MAX), XSIG(MA,MIN,MAX),
           XCHI2(,MIN,MAX),SKYCHI2,SCHI2(MIN,MAX).
PLATESN: For the roll call, output both the number of bad fibers for
           fiber masks, and the fraction of bad pixels for pixel masks.
PLOTSPEC: Added /ORMASK, /ANDMASK keywords.  Plot text for the zwarning flags.
           Use /normal coordinates for plot labels, so they stay on
           the plot even when zoomming in and out.
QUICKEXTRACT: Do not issue warning message for spatial widths on smear exposures
           since S/N can be so low.  This addresses PR #3511.
READSPEC,SPEC_APPEND: Add the /ALIGN option for aligning all the spectra
           in wavelength.  Also, fix a bug whereby reading objects from
           multiple could get mis-aligned if the OBJHDR keyword was specified
           (this bug was just introduced in the last version).
REDMONSTER,SKYSUBTRACT: Lower threshhold for flagging both the BADSKYCHI
           and REDMONSTER mask bits from a relative chi^2 of 4.0 to 3.0.
SDSS_FLAGNAME: Re-write to include many more types of mask bits
           from the file "spMaskbits.par".
SDSS_FLAGVAL: New function, which is the inverse of SDSS_FLAGNAME().
SKYMASK: Remove the rejection of andmask/BRIGHTSKY, and add rejection for
           ormask/BADSKYCHI.  Now we reject based upon that and
           ormask/REDMONSTER.  For good plates, this will be rejecting fewer
           points.  For the recent horrible data (like plate 889/52346),
           many more points are rejected since the sky chi^2 are so horrible.
           This change will need some real testing.
SKYSUBTRACT: Fix stupid bug where sky-fits are rejected if the mean
           sky is negative, though that only happens rarely.  This did
           cause all the b1 exposures on plate 283/51584 to get rejected
           (one of at least several such examples).
           Fix another rare indexing bug triggered on plate 318/51580-r2,
           and clean up the code that re-selected the sky break points
           based upon the S/N as a function of wavelength.
           Do not set BADSKYCHI mask bit when NOSKY is already set.
           Raise the threshhold for setting the BRIGHTSKY mask bit from
           1.25 * (median sky) to 2.0.
SPCALIB: Save "medwidth" from call to FITDISPERSION in the arcstruct.
           Save "medwidth" from call to FITFLATWIDTH in the flatstruct.
SPCOADD_FRAMES: Average keywords XCHI2,SKYCHI2,XSIGMA,WSIGMA in output header.
           Add output keywords XCHI2MIN,XCHI2MAX,SCHI2MIN,SCHI2MAX,
           XSIGMIN,XSIGMAX,WSIGMIN,WSIGMAX.
           Compute the fraction of bad pixels in total, and on each
           spectrograph.  Bad pixels are any with SKYMASK(INVVAR)=0,
           excluding those where the NODATA bit is set in the pixel mask.
           Then set the header keywords FBADPIX,FBADPIX1,FBADPIX2.
SPREDUCE: Add XSIGMA,WSIGMA to output headers.
SPREDUCE1D: Use SDSS_FLAGVAL() to set the zwarning mask bits.
           Make consistent with changes to line names in "emlines.par" file
           when setting the NEGATIVE_EMISSION mask bit.
           Call ELODIE_BEST() for stars, and append to spZbest output structure.
TELLURIC_CORR: Center the plot title.
ZTWEAK_STAR: New proc for getting the zero-point of the stellar
           templates by matching to the Elodie spectra.

eigeninput_star.par: Version of "eigeninput_star.dat" as a Yanny file.
           Add more Carbon_DQ stars.  Use cz instead of z.
           For stellar types O through late K, change the classifications
           to agree with Elodie (hopefully the fit from 4100-6800 Ang
           is good enough for this), and tweak the redshifts of those
           stars also (using ZTWEAK_STAR).
emlines.par: Couple the N_II emission line ratios at 1:3.
           Append the wavelength to the LINENAME structure element for clarity
           in the output files.
spChunkList.par: Remove verstarg from structure, and add progname.
spEigenStar-52373.fits: New stellar eigentemplates based upon
           eigeninput_star.par.
spMaskbits.par: Heavily modified file to include many more types of mask bits.
sprobot_start: Set the environment variable "DISPLAY=" so that any
           IDL jobs launched from these scripts don't use any additional
           IDL licenses.

In idlutils:

EX_MAX_PLOT: Added panel features.
HOGG_USERSYM: New symbol-making routine.
SXCOMBINEPAR: Add optional _EXTRA keywords to pass to SXADDPAR.

goddard/Makefile: Remove tape_io from the subdir list, since this causes it to
            crash when building under IRIX+6.

The following IDL routines were moved from the "idlspec2d" product:
pro/trace/fchebyshev.pro
          fchebyshev_split.pro
          flegendre.pro
          fpoly.pro
          func_fit.pro
          trace_crude.pro
          trace_fweight.pro
          trace_gweight.pro
          traceset2pix.pro
          traceset2xy.pro
          xy2traceset.pro
The following C code was moved from the "idlspec2d" product:
src/trace/Makefile
          evilmath.c
          evilmath.h
          trace_crude.c
          trace_fweight.c
          trace_gweight.c

-------------------------------------------------------------------------------
v4_9_6 (Mar 29, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_4.

Son-of-Spectro procs for spectrograph focus; changes in SOS data format.
More development work for 2D and P-1D.

APO_CHECKLIMITS: Default to returning the strings '','yellow',or 'red',
            and only turn into an HTML color if /HTML is set.
APO_LOG2HTML: Add FLAT/XSIGMA and ARC/DISPSIGMA to output tables.
            Remove the line of Java-script from the HTML file that
            does the auto-refresh (we'll only put that line in the
            file "logfile-current.html", as created by APOREDUCE).
APOALL: Major updating of this calling script to conform with current
            environment variables ASTROLOG_DIR,RAWDATA_DIR,SPECTROLOG_DIR.
            Also, reduce bias,dark,smear exposures.
APOREDUCE: No longer do the test in the beginning of this procedure that
            the FITS file should exist, since FITS_WAIT() will do that test
            and repeatably look for the file for several minutes.
            Log the versions of IDL,idlspec2d,idlutils into the log file.
            When copying the HTML file to "logfile-current.html", add
            the line of Java-script that does the auto-refresh.
BATCH1D,BATCH2D: Set the DISPLAY environment variable on remote machines
            to always be "", so that only one IDL license on each
            remote machine.  Also, pipe the commands through the bash shell
            on the remote machine, which means the UPS environment must
            be set up in the .bashrc file on the remote machine.
COLLIMATE: New proc for collimating the spectrographs.
CREATE_LINESTRUCT: Make the LINEWAVE element double-precision.
ELODIE_BEST: New function in development for finding best-fit Elodie spectrum.
EXTRACT_IMAGE: The values in XSKY are noisy measurements, so replace them with
            the predicted positions based upon the arc solution when making
            the call to SKYLINE_DISPERSION() -- otherwise, it can crash
            because the positions may not even be properly sorted!
EXTRACT_OBJECT: Remove call to QAPLOT_SKYDEV, since that QA plot contains
            no more information than QAPLOT_SKYSHIFT.
FINDOPFILE: Add /silent option.
FITARCIMAGE: List the (0-indexed) fiber numbers that in which
            any or all arc centroids are fixed.
FITDISPERSION: Re-organization of this code  Add support for SIGMA being
            a scalar, vector, or array.  Optional MEDWIDTH output.
            Output warning messages if out-of-focus.
FITFLATWIDTH: Re-organization of this code  Add support for SIGMA being
            a scalar, vector, or array.  Optional MEDWIDTH output.
            Output warning messages if out-of-focus.
FOCUSHISTORY: First stab at a proc for plotting the spectrograph focus
            as a function of time.  Simply use the wavelength dispersions
            from the arcs, which we have in the spPlate files.
LINEBACKFIT: Force the output sigmas to be non-negative (which also
            prevents a bug later in the code that assumes this is true
            when measuring the chi^2 of each line, as pointed out by
            John Moustakes).
            Remove any lines where LINENPIX=0 by setting its AREA,EW to zero
            and their errors to negative error codes, and remove from YFIT.
            Evaluate YFIT even at points not included in the fit (if INVVAR=0).
            Add SIGGUESS option, and allow SIGGUESS and ZGUESS to be either
            scalars or vectors (one per line fit).
PLATECOMPARE: Fix 1-character typo preventing selecting the MJD
            when using the TOPDIR keyword also.
            Pass TOPDIR to READSPEC rather than explicitly resetting
            the $SPECTRO_DATA environment variable.
PLOTSPEC: Add options /ZLINE, /NOSYN, /NOERR, TOPDIR.
QAPLOT_SKYLINE: Divide the skyline flux values by the airmass, since those
            lines basically scale with airmass.
QUICKEXTRACT: Make call to FITFLATWIDTH, and trigger warning messages if
            the spatial widths are too large, indicating that the spectrographs
            may be out-of-focus (see PR #3462).
            Add XSIGMA_QUADRANT,XSIGMA to output structure.
QUICKTRACE: Call the optimal-extraction code EXTRACT_IMAGE for the sole
            purpose of measuring the spatial profile widths, then use
            FITFLATWIDTH to trigger any warning messages if the spectrographs
            appear out of focus (PR #3462).
            Add XSIGMA_QUADRANT,XSIGMA to output structure.
QUICKWAVE: Call to FITDISPERSION to trigger warnings in the spectrographs
            look out-of-focus in the wavelength dimension.
            Add DISPSIGMA_QUADRANT,DISPSIGMA to output structure.
READ_ELODIE: Optionally return the Elodie header in HDR.
READSPEC: Add TOPDIR input keyword and ZLINE,LINEFLUX outputs.
            Use DIMS0 keyword in primary header of spZall,spZline files
            if it exists to determine the dimensions of [NPER,NOBJECT]
            multi-dimensional arrays.
            Option to return OBJHDR.
SDSSPROC: Add /silent option.
SKYSUBTRACT: Trigger a warning if the airmass exceeds 2.5 (note this proc
            is also called by SoS).
SPADD_GUIDERINFO: Fix crash condition when very little guiding info
            and indexing goes negative.  Add NGUIDE to header.
SPCOADD_FRAMES: Total the NGUIDE header keywords.
SPECLINEFIT: Major re-organization of this procedure, allowing one to either
            pass a plate file name, or all the input arrays (as is now done
            from SPREDUCE1D).  Now fit to emission lines for all object
            types, not just galaxies.
            Pass only those lines within the wavelength range of the spectrum
            (+/- 6000 km/sec) to the line-fitting engine.  This saves CPU
            time that would otherwise be spent determining that these lines
            cannot be fit.
SPPLAN2D,SPPLAN1D: Add more informational messages.
SPPLAN2D: If $SPECLOG_DIR is not set, then use $ASTROLOG_DIR.
SPREDUCE1D: Simply overwrite any existing spZ files, rather than
            using cpbackup to save old ones.
            Call SPECLINEFIT from the end of the code, since it now fits
            emission lines for all types of objects (not just galaxies).
            Add another ZWARNING flag for QSOs with negative emission lines.
SPREDUCE2D: Output the version of the specflat product at the start of the log.
SDSSPROC: Add "WARNING" to the warning messages about invalid or
            missing BC files.
SKYLINE_DISPERSION: Re-write to get the indexing correct.  The first version
            was not comparing the skyline widths to the correct arcline widths.
            The measurement should mean something now.
SKYSUBTRACT: Some cleaning up of the code and catch crash conditions
            for when all the sky fibers are bad (as happened for
            exposure #10965 of plate 644/52173).  For most cases,
            the code should be functionally equivalent.
TRACE320CRUDE: Fix a bug just introduced in v4_9_5 that would cause
            the code to crash if ystart at any trace falls off the
            left or right edge of the CCD.  This caused the
            plate 0179/51580 (and some others) to crash.
ZFIND: Make EIGENFILE an optional input, so that STARFLUX,STARLOGLAM0
            can be specified directly instead of passing a file name.

emlines.dat: Add Ly_alpha,N_V,C_IV,He_II,C_III] for QSOs.
            Let the widths for the Balmer series be independent from
            those of other emission lines, but still constrain the Balmer
            lines and other lines to have the same redshift.  One such
            example where the Balmer lines have a different (narrower!)
            width is 406/52238-362.
idlspec2d.table: Added optional dependence upon "elodie" product.
opBC-50000.par,opBC-51809.par,opBC-51813.par: Extended two bad columns
            in r1 to the top of the CCD (cols 1201+1586).
opHdrFix.par: Declare data bad on MJD 52336-52337 due to spectrograph
            mechanicals problems, and other problems from 52312-52337.
opLimits.par: Add error values for FLAT/XSIGMA and ARC/DISPSIGMA.
mailhtml.sh: Comment out the rm lines (as in 1.18) and leave to killdata.sh
spChunkList.par: Add chunks 36-39.
spectroSOS.html: New warning messages if the flats or science frames
            appear out-of-focus according to their spatial profile widths
            (will only appear in v4_9_6 and later).
            New warning messages if arcs appear out-of-focus according
            to their dispersion profiles.
            Add FLAT/XSIGMA and ARC/DISPSIGMA to output tables.
sprobot.sh: Add more time stamps to the robot log file.
            Change the ssh command that retrieves the MJD directory list
            from the remote machine -- it appears that something about the
            sed command no longer works the same.
sprobot_start: Comment-out "spamdup" job in the cron file, since we don't
            seem to need that hack any more to keep the NSF-automounts alive.
            Set $SPECLOG_DIR=$ASTROLOG_DIR for the purposes the the Spectro
            robot.

In idlutils:
ASINH2: Better asinh (from Blanton for PROFINTERP procedure).
BSPLINE_ITERFIT: Always reset OUTMASK so that the input value does not matter.
            Set YFIT to all zeros in the case that the fit fails.
EX_MAX_PLOT: Moved from /math to /plot.
FAST_FIT_SERSIC: New proc.
FIT_SERSIC,PROFINTERP,SERSIC: Bug fixes, and use ASINH2.
HOGG_INTERVAL: New proc.
MAGGIES2LUPS: New proc.
MJD2DATELIST: New proc to construct a list of MJDs and date strings
            spanning a range of MJDs (useful for plot limits).
PPMTOMPEG: New proc.  Wrapper for ppmtompeg, the open-source UNIX mpeg writer.
RADEC_TO_FIELDS: Configurable option allfieldfile.
SEEING_RADIAL: New proc.
SERSIC_PARAMS: New proc.
SPLOG: Add /NO_STDOUT keyword.
SXPAR: Landsman fixed to handle CRVALn of different type properly
YANNY_READ: If reading a Yanny file aborts, then log the file name,
            the line number of the failure, and the line itself.
            Small speed improvement made in internal proc YANNY_READSTRING.
src/spheregroup/chunks.c: Roundoff error problem fixed.
eviltarball: Comment out the reference to sdsscvs.
evilinstall: Use UPS_PROD_FLAVOR environment variable (not UPS_FLAVOR).

In specflat:

First set of global biases (pixbiasave-*.fits) from many nights of data.
Pixel flats now based on more nights of data.
specflat.table: Added "Flavor=Linux"

-------------------------------------------------------------------------------
v4_9_5 (Mar 1, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_3.

Minor bug fixes for SOS.

APO_LOG2HTML: Generate the HTML file name even if the FITS file has a path
            in the name, as happens when being called from REMOVE2REDO.
BATCH2D: Include 'smear' exposures when generating list of output files.
            (Not doing this caused a crash for plates w/ only smears).
FLUXCORR_NEW: Provide a better test of valid smear correction, fixes PR #2478.
QUICKTRACE: Reverted to doing full trace for flats.  Time saving by only
            tracing part of the flat image introduces a risk not worth the gain.
REMOVE2REDO: Fix possible crash condition, and change calling sequence to
            DJS_MODFITS in the case that an HDU should become empty.
            If files have been removed, then update the HTML file so that the
            files to be re-reduced are removed from the web page until then.
SPCOADD_FRAMES: set BADFLUXFACTOR only for extreme smear corrections=20x median
TRACE320CRUDE:  Fix bug dependent on invvar being set.
            Small change to note number of goodrows in xmask, non-critical.

aporsync_logs.sh: Re-order the files copied so that we get the sdReport
            file first.
opLimits.par: Change the good limits for bias counts from [0,20] to [0,15].
sprobot_start: No longer reference $BATCH2DFILE,$BATCH1DFILE, which are
            no longer used.
sprobot_start,sprobot.sh: Added optional $SPROBOT_RSH environment variable
            for specifying the protocol for copying the raw data.
sprobotcopy.sh: Deleted.
sprobotlist.sh: Trimmed version of "sprobotcopy.sh", which only creates
            the plate list and summary files once per day.

In idlutils:
DJS_MODFITS: Added /DELETE_DATA keyword, which is functionality needed
            for sos_redo (the REMOVE2REDO procedure).
-------------------------------------------------------------------------------
v4_9_4 (Feb 28, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_3.

More development of 2D.
Minor bug fixes for SOS.
Runnable version for P-1D.

APOREDUCE: Check how full the disks are for both the input files (sdR images),
            and the outputs.  Issue a warning message if either is >95% full.
ATVRAWSPEC: Display a 2D spectroscopic image with bad columns marked in red.
            This is useful to see that all bad columns have been masked,
            especially when looking at the 2D pixel flats.
BATCH1D,BATCH2D: Look for the parameter file batch1d.par,batch2d.par
            in the TOPDIR directory rather than reading environment
            variables $BATCH1DFILE,$BATCH2DFILE.
CREATE_LINESTRUCT(): Function broken out of LINEBACKFIT so that it
            can be called by SPECLINEFIT.
EXTRACT_OBJECT: Added call to skyline_dispersion (for increasing the
            instrumental response width to agree with the width of sky
            lines), but correction is not implemented because the measurement
            appears to be very noisy. Check invvar with whopping fibers.
FINDOPFILE: Find the op file corresponding to a specified MJD.
            This function is broken out of SDSSPROC so that it can
            be used by other procs (like ATVRAWSPEC).
FITDISPERSION: Mask regions not neighboring lines of interest.
            Simplifies extraction of line widths.
            Minor tweaks, npoly=10 no longer valid -> changed to npoly=5.
LINEBACKFIT: Fix possible crash condition when computing LINENPIX if
            the line width is unphysically narrow and no pixels fall
            within the region of an emission line.
MATCH_TRACE: Added keyword radius, and set default to 2 (rather than 3).
            This seems to fix PR #2626 (Large bad regions not large enough
            w/LOWFLAT) and PR #2063 (Extraction problem fibers 321-400 on
            Plate 401/51788), both of which were due to some traces being
            slightly off.
PLATECOMPARE: New TOPDIR optional keyword for comparing different
            reductions of the same data.
PLOTSPEC: Optional /ZWARNING flag.  Report error if FIBERID out of range.
PLUGHISTORY: Plot the history of unplugged fibers based upon plPlugMapM files.
QAPLOT_FCALIBVEC: Generate QA plot of apparent flux-calibration errors
            by comparing spectra to synthetic (e.g., best-fit) spectra.
            This proc is called at the end of SPREDUCE1D, and generates
            figures and warning messages if the min/max apparent fluxing
            errors are large (more than 10% anywhere).
QUICKEXTRACT: Call REJECT_SCIENCE() to decide if a science exposure is bad
            due to lamps being turned on, too many saturated pixels, etc.
            If number of sky fibers > 20, then select one good sky fiber
            from each of the 16 bundles.  Assumes 20 fibers per bundle.
            This addresses PR #3238.
            Fix bug whereby bad pixels can trigger whopping fibers.
            Bad pixels can trigger whopping fibers.
READSPEC: Don't fail when asking for SYNFLUX, but the spZ file doesn't exist.
            (This prevented PLOTSPEC from plotting anything in that case.)
REJECT_SCIENCE: Check in the header that all the flat-field screens are
            open and that all the FF,NE,HGCD lamps are turned off.
            With this check, exposure #11504 of plate 727/52207 would
            have been automatically rejected for having the FF lamps
            turned on (see PR #3169).
            For now, never actually reject science frames.
SDSS_FLAGNAME: Change some of the target names to agree with what's been
            changed in the target code in the past year or so.  Note that
            I had already updated the target names in spectro_home.html.
SDSSPROC:  Change to select which op file to use based upon the MJD in the
            file name rather than the MJD in the header of a Yanny param file.
            Make the MJD selection of the op files a bit more clear.
            Issue a warning message if there is no op file with an MJD
            equal to or less than the image's MJD.
            The function FINDOPFILE is broken out into its own file.
SKYLINE_DISPERSION: Function similar to fitdispersion which measures
            gaussian line widths of sky lines given arc line dispersion set
            as initial guess.  Indices of sky fibers can be specified to
            restrict width  measurements to these fibers only.
            The measured widths and corrections are logged to the log file
            with the following info:
              xpos = X position on CCD
              ngood = number of good measurements (<= number of sky fibers)
              flux = flux of this sky line
              arc = the dispersion width measured in the arc lines
              min, max, median = a sample of the distribution of widths (in
                                 pixels) for each skyline
              med_diff = the median quadrature difference: width^2 - arc^2
              stddev = the scatter in the quadrature difference for that line
SPBIASAVE: New proc to average together a set (or all!) 2D pixel biases.
            This proc is modelled on SPFLATAVE.
SPCOADD_FRAMES: Remove the following keywords from the spPlate file:
            PIXBIAS,FLATFILE,ARCFILE,OBJFILE.
            Issue a warning message if any object fibers have OBJTYPE=NA,
            which should be impossible, but the special plate 673 and
            possibly others had some such fibers.
            Add UNAME keyword which is the result of 'uname -n'.
SPECLINEFIT: Fixed dumb mistake on indexing that could crash.
            Always create an NLINE x NOBJ output structure, with blank
            entries where we do not measure lines (currently, only
            measuring for GALAXY objects).
SPFLATAVE: Add comments to output header to track which files were used;
            change default for input directory to current.
SPFLATTEN2: Undo the last change of using the opBC-empty.par file, since
            we do want to ignore bad columns when tracing fibers, etc.
SPREDUCE: No longer issue an abort message in this proc if the science
            exposure is declared bad, but issue those messages from within
            the REJECT_SCIENCE() function.
SPREDUCE1D: The warning message for S/N > 200 pixels has been fixed,
            and another warning added for any pixels w/ flux < -10 * noise
            (e.g., unphysically low values).
            Mask out points that are unphysically negative (10-sigma negatives),
            and mask the neighboring 2 pixels in each direction.
            Call new procedure QAPLOT_FCALIBVEC to measure flux-calib errors.
TRACE320CRUDE: Add replacement code section for traces with
            bad columns near starting position.

idlspec2d.table: Added "Flavor=Linux"
eigeninput_star.dat, spEigenStar-52333.fits: Update of stellar templates.
            Use many A stars, Carbon stars, Carbon_DQ stars, WD stars
            instead of just 1 for building eigentemplates.
            Many more K stars, with subtypes Kearly,Kmid,Klate.
            No changes to F stars yet (or even checks of their velocities).
mailhtml.sh: Grep for the "APO Spectro" from the HTML file to get the
            subject line for mail; I had changed this HTML title string,
            which then gave a missing subject line in the e-mail (PR #3200).
opBC-50000.par,opBC-51809.par,opBC-51813.par: Add a small trap on r2
            at 1168,1339; extend the b1 badcols 1762-1673 to the top of
            the CCD by 10 more rows; extend the r2 badcol 1585 to the top
            of the CCD by 908 more rows.  Re-order some of the entries
            for clarity.  Make opBC-51809 identical to the others except
            for the 4 additional entries on b1 and 1 additional on r1.
opConfig-50000.par,opECalib-50000.par: Renamed copies of opConfig.par
            and opECalib.par with an MJD in their names.
opHdrFix.par: Declare bad aborted smears for plate 601 and 803.
            Declare bad exposure on plate 866.
            Don't include test data from MJD 52318.
            Declare all r2 exposures on MJD 51779 bad due to electronics
              problems (PR #2335), only effecting plate 356.
            Remove bad data for plate 727 on MJD 52207.
            Remove bad data for plate 724 on MJD 52240.
            Remove bad smear for plate 860 on MJD 52319.
spectroSOS.html: Update to reflect new warning messages.
sprobot.sh: Bug fix where we were rsync-ing all of sos.apo:/data/spectro/$MJD
            on the line where we only wanted to get the guider directory!

In idlutils:
New procedures in pro/coord for various SDSS coordinate transformations.
Many of these were in the hoggpt product:
  ATBOUND
  ATBOUND2
  ETA_TO_STRIPE
  ETALAMBDA_TO_STRIPE
  ETALAMBDA_TO_MUNU
  MUNU_TO_RADEC
  RADEC_TO_FIELDS
  RADEC_TO_MUNU
  STRIPE_TO_ETA
  STRIPE_TO_INCL
ATV: Add "R" and "C" features for overplotting rows and columns.
COMDIS: Minor bug fix, making loop variable type long.
GAUSS_KERNEL: sigma should have been sigma^2 (This proc is used
            by SKYSUBTRACT,SMOOTH_HALO,RLINE_FINDEW in idlspec2d).
SPHEREMATCH,chunks.c: Bug fix for wrap.
YANNY_DIFF: New proc to compare two Yanny files, optionally copying values
            from one to another.
YANNY_READ: Read lines up to 2047 characters long (instead of 1023)
            without resorting to the /QUICK option.
YANNY_WRITE: Add STNAMES keyword if writing out Yanny files that were
            read with YANNY_READ(/ANONYMOUS).
evilinstall: Now with all the messy confusion at Fermi, it is no longer
            possible to auto-detect Linux flavors using the $SETUP_UPS
            environment.  It is best to first set an environment variable, ie.:
              UPS_FLAVOR=Linux+2
            to over-ride the auto-detected flavor on Linux boxes, which now
            always appears to come up as Linux+2.4, which no one actually uses.

idlutils.table: Added "Flavor=Linux"

-------------------------------------------------------------------------------
v4_9_3 (Feb 12, 2002 idlspec2d only) running on IDL 5.3 - 5.5
Built against idlutils v4_9_2, specflat v1_3.

Trivial fix to Makefiles for install.
Still a buggy version for P-1D.

-------------------------------------------------------------------------------
v4_9_2 (Feb 12, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_3.

This tagged version is for running Spectro-2D.
It also addresses some rsync bugs for Son-of-Spectro.
Re-write of velocity dispersion + line-fitting for P-1D, but a buggy version.

APO_CHECKLIMITS: Wasn't matching on flavor.  Fixed.
APO_LOG2HTML: Mistakenly was listing times as hr:sec instead of hr:min!
            Remove the first word from each warning or abort message line
            (which is the name of the IDL proc that generated the message,
            and confuses the observers; we sill have the proc name in the
            original FITS file from which the HTML is generated).
APOPLOT,PLOTSPEC: Change the http address for Kent's image server to
            its new location at http://sdssmosaic.fnal.gov:8015/.
APOREDUCE: Added warning if disk space is nearly full where output
            directory resides (if 'df' command reports more than 95% full).
            (But not nessarily testing the directory where the raw FITS
            files are copied.)
DJS_SVDFIT: This is a modified version of SVDFIT from IDL 5.3, since the version
            in IDL 5.4.1 crashes when the matrix is singular!!
            Presently, this is called by FIND_NMINIMA().
FIND_NMINIMA: Add /DEBUG keyword; small changes to plotting.
            Call DJS_SVDFIT instead of the IDL library function SVDFIT(),
            since it looks like they broke the latter in IDL 5.4.1.
FINDCHI2MIN: Clean up this code some.
           This routine used to be used by VDISPFIT, but is no longer.
FLUXCORR_NEW:  Return all zeros in fluxcorr image if
                  "WARNING: No spectrophoto with high S/N"
           No longer required checking of "Bad" values for medium S/N.
GET_TAI: A short proc to determine, beginning, mid-point, and ending
           timestamps for sdR exposures.  Uses TAI-BEG,TAI-END in header
           if they exist; otherwise compute from TAI and EXPTIME.
           This is now called from the following procs: EXTRACT_OBJECT,
           SDREPORTMAKE, SPADD_GUIDERINFO, SPBIASGEN, SPCALIB.
           Note that version v4_9_1 would not reduce the early data since
           we had changed to using TAI-BEG, which did not exist for the
           early data.
LINEBACKFIT: New generic proc for fitting emission lines + linear background
           terms.
PCA_ELODIE,READ_ELODIE(): New routines for reading the Elodie eschelle
           spectra and generating eigenvectors for velocity dispersion fits.
REMOVE2REDO: Never consider the compressed (sdR*.fit.gz) files for removal,
           since those are our archived copies of the raw data.  Only remove
           the *.fit files.  That way, if the data gets removed from
           sdsshost.apo and we run this proc, we don't delete all copies
           of the data on sos.apo!
SPADD_GUIDERINFO: New routine to compute seeing and average guider offsets
           from the guiderMon param file, and add those results to a FITS
           header.
SPBIASGEN,SPFLATTEN2: Use an empty bad column file (opBC-empty.par) when
           generating the 2D pixel flats and bias images.
SPCOADD_FRAMES: Combine a whole bunch of header cards from the individual
           input exposure for the output exposure.  Specifically, this was
           to address PR 2174 to average the weather data.  The cards effected:
           'AZ', 'ALT', 'TAI', 'WTIME', 'AIRTEMP', 'DEWPOINT',
           'DEWDEP', 'DUSTA', 'DUSTB', 'DUSTC', 'DUSTD', 'GUSTS', 'HUMIDITY',
           'HUMIDOUT', 'PRESSURE', 'WINDD', 'WINDS', 'TEMP01', 'TEMP02',
           'TEMP03', 'TEMP04', 'HELIO_RV', 'SEEING20', 'SEEING50', 'SEEING80',
           'RMSOFF20', 'RMSOFF50', 'RMSOFF80'
           We also take the min of all 'TAI-BEG' cards, and the max of
           all 'TAI-END' cards.
           Don't alter incoming file list, copy to internal variable list
           of filenames.
SPCOMBINE: Set default value of MINSN2 to 0.2 instead of 0.0.  This is a
           work-around for the moment to prevent one bad exposure (#6808)
           from corrupting the combine of plate 358/51818.
           Also, go back to not including the smear exposures in the combine,
           unless one explicitly sets the /SMEARINCLUDE keyword.
           Exclude fluxcorr images with entire image = 0 -- that's now a
           possible result from running FLUXCORR_NEW where the signal is
           so low that we can't compute the flux-correction vectors w.r.t.
           the smear exposure.
SPECLINEFIT: First calling script for line-fitting code, modelled after
           SPREDUCE1D.  This can be stand-alone, or called at the end
           of SPREDUCE1D.  For the time being, only do these fits for
           objects of type GALAXY.
SPREDUCE1D: Set the ZWARNING=8 flag (synthetic spectrum is negative) only
           for stars, not for QSO's any more since we use several eigen-
           components to fit QSO's now, nor for CV stars for the same reason.
           Use the file 'spEigenElodie.fits' for computing velocity dispersions.
           Write out the best-fit velocity-dispersion spectrum as HDU#3.
           Make consistent with changes to VDISPFIT.
           Add CHI68P to output structure, for the 68-th percentile value
           of abs(chi).
           Call SPECLINEFIT at the end of this proc.
TRACE320CRUDE: Threshold to set 'BADTRACE' is now 45% bad pixels, whereas
           it used to be 20%.
VDISPFIT: Option to return the best fit with YFIT keyword.
           Mask out +/- 6 pix from emission lines instead of only 4 pix.
           Option to pass EIGENFILE,EIGENDIR rather than use default file.
           Use FIND_NMINIMA instead of FINCHI2MIN to find the minimum,
           since the latter did a spline fit that could wiggle in
           unconstrained ways.
           In cases of bad fits, return error codes as negative VDISP_ERR.
           Return a code of -4L if there is no wavelength overlap.
           Insist that convolution kernel have odd number of elements, and
           convolve with /CENTER keyword.
           Only cache over-sampled templates if the template file name
           is unchanged between calls.
           Make this routine a function that returns a structure.
           Also return VDISPCHI2,VDISPNPIX,VDISPDOF in output structure.
ZFIND: Add fields to the output structure needed for velocity dispersions.

aporsync_logs.sh :
           Changed the syntax to just copy these type of files in astrolog
           (which we *thought* we were doing, but wasn't quite working):
             Unplugged*.ps
             exposureLog*.par
             fiberScan*.par
             guiderMon*.par
             op*.par
             plPlugMap*.par
             sdReport*.par
sprobot.sh: Fix syntax bug when passing $upsversion to BATCH1D,BATCH2D.
killdata.sh,mailhtml.sh: Spectrolog cleanup is now done +25 MJDs afterwards,
           which will allow for sos_redo, apoplot and debugging to have
           a buffer.  Enable the call to data_rsync.sh again for copying
           the *.gz files locally from /data/spectro/$MJD to
           /data/spectro/rawcopy/$MJD.
sprobot.sh: Copy the guider image directory.  We mistakenly lost this copying
           when we went to explicitly copying only the sdR*.fit.gz files.
sos.sh,startapo.sh: Forget to switch to UT time in a couple of instances.
opBC-5000.par,opBC-51813.par: New bad column masks, somewhat circular dependence
           on pixflats.  Make opBC-50000.par identical to opBC-51813.par, so
           that the only different bad column masks are for the few nights from
           MJD=51809->51812 as stored in opBC-51809.par.
           For r2 (camcol=2), now mask all of columns 370-371 instead of parts.
           For r2 (camcol=2), add mask for column 1068.
           For r1 (camcol=4), mask only cols 1112-1115, not cols 1112-1117.
opBC-empty.par: New file with no bad columns for use when generating the
           2D pixel flats and bias images with SPFLATTEN2 and SPBIASGEN.
opLimits.par: Bug introduced when I reformatted the TOTAL/TOTALSN2 entries
           (done to address PR #2562 to differentiate between bias and
           dark current levels).  This fix closes PR #3185.
spEigenElodie.fits: First 70 eigen-components of the 700-ish Elodie spectra,
           generated at Sloan resolution using PCA_ELODIE.

In idlutils:
DJS_MEDIAN: Bug fix for crash condition when WIDTH is greater than
            the number of elements in the array.
DJS_REJECT  : Major bug in /groupbadpix option, should now work as intended
BSPLINE_ITERFIT: Fix major bug with /GROUPBADPIX option which is used
           by COMBINE1FIBER.
SPLOT: For gaussian line fitting, display the Area (not the peak height),
           and try fitting absorption lines as well as emission lines.
           Still not always a good fit, since I'm using the IDL build-in
           CURVEFIT() rather than MPFITFUN, which would be better.
SXCOMBINEPAR: New proc to combine values of specified header cards from
           many FITS headers.  (This option used by SPCOADD_FRAMES.)

-------------------------------------------------------------------------------
v4_9_1 (Jan 24, 2002 idlspec2d+idlutils) running on IDL 5.3 - 5.5
Built against specflat v1_3.

This tagged version is for running Son-of-Spectro; not viable for Spectro-2D.
Bug fixes to run on IDL 5.5.
Changes to how the SOS robot launches the rsync jobs and fix other SOS bugs.
Bias-subtraction now implemented (bias images in the "specflat" product).
New set of templates for P-1D; QSO's now use 4 eigentemplates.

APO_LOG2HTML,APOREDUCE: Switch from saving the Mountain standard time (MST)
           string to only storing TAI time, and computing UT on-the-fly.
APO_LOG2HTML: Compare the exposure "flavor" when looking at the operational
           limits (in the "opLimits.par" file).  This allows us to
           differentiate between bias and dark levels (PR #2562).
APO_CHECKLIMITS,APO_COLOR2HEX: These functions broken out of APO_LOG2HTML
           since they are now used by APO_PLOTSN too.
APO_PLOTBIAS: Remove ROOT_DIR keyword, but look at $RAWDATA_DIR environ
           variable instead.  Look for uncompressed or compressed raw files.
APO_PLOTSN,APO_LOG2HTML:  Only add (S/N)^2 that is not flagged as anything
           bad in the opLimits file (currently anything < 2.0 is bad).
           This should be true for both the HTML table and for the S/N plots.
APOFLUXCALIB: Procedure for generating a canonical set of flux-calibration
           vectors (including the superflat) for on-the-mountain plotting
           of spectra using APOPLOT.
APOALL,APOREDUCE: Allow setting MINEXP to 0 sec.  Change default of MINEXP
           to 0 sec, so that any exposure with non-negative exposure time
           is reduced by Son-of-Spectro.
APOPLOT: New proc for plotting spectra from the Son-of-Spectro outputs at APO.
APOPLOT,LOGSHEET,PLOTSPEC: Set the !QUIET option for procedures where it is
           annoying to see all the IDL messages.
BATCH1D,BATCH2D: Allow NICE to be set to zero.  Add UPSVERSION keyword to do
           a "setup idlspec2d $UPSVERSION" on the remote machine before
           executing the IDL job.  This allows you to batch jobs using a
           version other than that which is declared current under UPS.
BATCH2D: At the end of a batch job, spawn the following:
           spawn, 'rm -f spArc*.fits* spFlat*.fits* spSky*.fits*'
           in order to remove files that eat up too much disk space right now.
COMBINE1FIBER: Use the /GROUPBADPIX keyword for rejection in B-spline fits.
DANVB_CONVERT,DANVB_QSOLIST: Procs for generating a list of input
            QSO's from Dan van den Berk's EDR list "plateEDR.summ"
            for generating QSO eigenvectors.  The output file
            "eigeninput_qso.dat" is then used by PCA_QSO.
DIVIDEFLAT: Make INVVAR an optional keyword instead of an input for DIVIDEFLAT.
            Change the procedures that call this.
EXTRACT_OBJECT,SPBIASGEN,SPCALIB,SPREDUCE: For TAI time, use the midpoint
            of the observation as determined by TAI-BEG + 0.5 * EXPTIME
            from the header.
EXTRACT_OBJECT,SPREDUCE: No longer write the sky vectors to a different file,
            but write them to the spFrame files.  Also, always write the
            telluric-correction array, which will simply be an empty HDU
            for the blue CCDs.
FIND_NMINIMA: Retain each peak only if it is at least MINSEP from all
            previous peaks.
FINDSPEC: Crash if the plate list file is missing w/ an informative message.
            Do not crash if spPlate files missing for some plates.
FITARCIMAGE: Bug fix to prevent IDL 5.5 from crashing.
FITSN: The logic for choosing fitting limits for all possible bands
            has been moved to this function.  This function will now
            choose the full mag range [0,23] to fit if there are fewer
            than 20 points in the default ranges and at least 3 good points.
            This function is called by the following routes in Son-of-Spectro:
               APO_PLOTSN -> PLOTSN -> FITSN
               QUICKEXTRACT -> FITSN
            This function is called by the following routes in Spectro-2D:
               PLATESN -> PLOTSN -> FITSN
               EXTRACT_OBJECT -> FITSN
MULTISYNTHSPEC,SYNTHSPEC: Bug fix for when wavelength spacing is different
            between the template and the requested synthetic spectrum.
PCA_CVSTAR: New proc for generating eigen-spectra for CV stars.
PCA_QSO: Major re-write now that we're trying to use the eigen-spectra
            from this routine for the redshift-finding code, rather
            than using the single QSO template that we've used to date.
            Solve for 4 eigencomponents in rest-frame [460,9300] Ang.
            Try solving for one eigen-component at a time.  When I tried
            solving for them all simultaneously, this resulted in an
            unphysical 1st eigencomponent, probably because each spectrum
            only covers a small range of rest wavelength.
            Also, make some plots.
PCA_SOLVE: Add NRETURN keyword for returning a different number of
            eigen-components from the number used (NKEEP) for replacing
            bad and noisy data points.  Optionally return NEWFLUX,NEWIVAR.
PCA_STAR: Major changes to read stellar classes and subclasses,
          then generate the 2-component PCA solution for all M stars
          (for example) and reconstruct types M1 through M9.
PLATECOMPARE: Add /PSFILE option.
PLATELIST: Add NEXP,EXPT_B1,EXPT_B2,EXPT_R1,EXPT_R2,SMEARUSE,TAI_BEG,TAI_END,
          SEEING*,RMSOFF*,AIRTEMP,CARTID to output struct.
          Now show the status of 2D and Combine separately, which will make it
          obvious when this problem occurs. When it happens, Status2D
          might still be "Running" even though StatusCombine is "Done".
          That case would mean that one of the night's of 2D data
          probably crashed, and we combined from whatever subset of data
          did run through from other nights.  This addressed PR #2993.
          Add the /KILLPARTIAL option for deleting data from partially-
          combined nights, which only happens from the Spectro-Robot
          operating in real-time.
PLOTSN: Changed auto-scaling of fitted magnitudes, when less than 20 objects
            are in the desired range.  Now the fitting range will expand to
            [10.0, snmag + 1.0].  So in case of g' [10.0, 21.2], this should
            work much better for the photo-z S/N estimates.
PLOTSPEC: New keyword option /NETIMAGE to plot corresponding PHOTO images
            in a Netscape window using Steve Kent's web tool.
QAPLOT_SKYSUB: Don't be quite so severe with warning messages.  If a single
            sky fiber has bad flux levels, report as a "Warning" instead
            of a "WARNING".  Trigger the "WARNING" about "Max sky-residual
            chi" at 5.0 instead of 4.0.
QUICKBIAS: Remove message which preempts logging.  Instead, return a
            set of precentiles that are all -9999, which shows up as ****
            in the HTML file.
QUICKEXTRACT: Put exposure time dependence in scattered light warning.
            It is the same limit as we had before for 900-sec exposures,
            the same limit for shorter exposures, and a (scaled) higher
            limit for longer exposures.
            Include FIBERMAG in the output structure, where we use MAG[1] for
            any blue frames, and MAG[3] for any red frames.
REDMONSTER: Change the warning message to "Bad sky residuals...",
            and only send the message "Red Monster at..." if it
            is around 6400-6600 Ang, where we think the problem may
            be due to the hand-paddle LED.  This change is for the
            benefit of the observers (from Son-of-Spectro warnings).
            Also output the peak chi.
REDMONSTERLIST: New procedure: List of number of galaxies and quasars per
            plate, the number of redshifts that differ from prior reductions,
            and the fraction of various 2D flags set.
REMOVE2REDO: Make more robust, and give more descriptive messages.
            Another attempt to fix errors in remove2redo.  It might now
            work with plate argument: "sos_redo plate=665", but should
            definitely work with simple invocation: "sos_redo".
            --> Now a re-write of this, allowing either PLATE or EXPNUM
                keywords (but not both) as of 8 Jan 2002.
RLINE_FINDPEAKS: Updated to demand minimum separation, and commented.
SDSS_FLAGS: Add "SOUTHERN_SURVEY" flags for TARGET and TTARGET.
            Also, return a warning message for any bits that are set
            but whose meaning is unknown.  Previously, a wrong answer
            would just be given in that case.
SDSSPROC: Reverted to calls to specflat_version,speclog_version that work.
            New option /APPLYBIAS to bias-subtract.  This fixes PR #2595,
            subtracting the bias-induced flux at 3800-4600 Ang flux (b1) in
            fibers 17+18.
SLATEC_EFC (in idutils):  Call FILL_BSPLINE() instead of EFC2D().
SPBIASAVE: New routine to average biases already generated with SPBIASGEN.
SPCOMBINE: Bug fix for dealing with missing spFrame files (as for plate
            204/51455, where this proc would crash).
SPPLAN2D: Change the default of MINEXP to 1 sec, so that special plates
            like the M67 plate (#321) will be reduced.
            Make a plan file if either science or smear exposures exist
            (before it required the existence of science exposures).
            Get the MJD from the directory name $RAWDATA_DIR/$MJD, not
            from the header of the 1st file which may be wrong.  This
            happened on MJD 52247, where there was a bias taken on MJD 52246
            which messed up the plan file for plate 766 on MJD 52247.
            But I will at least issue a warning in the proc if there is an
            MJD that appears incorrect in one of the headers, as in this case.
SMOOTH_SUPERFLAT: Located the spurious WARNING, changed to Warning, and
            upped the threshold.  It was not the critical one of the two
            smooth_superflat warnings.
SPBIASGEN: New routine for generating mean biases for a night.
SPCALIB,SPFLATTEN2,SPREDUCE: Use /APPLYBIAS option in call to SDSSPROC.
SPCOADD_FRAMES: Convert dispersion vectors to log-lambda units (1.0d-4, PR 1870)
            When combining fibers, we used to use MAXITER=20.  Now use
            MAXITER=50, MAXREJ=1.
            Bug fix for SMEARUSE keyword in header, which was incorrectly
            always set to 'F'.
SPCOMBINE: New optional keyword MINSN2 to set the minimum S/N to include
            in co-adding; default to 0.0 for the time being (see PR 1901).
            Otherwise, special plates that have all bright objects will not
            get combined (since the extrapolated S/N at 20th mag is so low).
            Include 'smear' exposures as well as 'science' in the co-adds,
            which should let us recover some spectra that are otherwise
            saturated in 15 min exposures.
SPFLATGEN: Add optional keywords EXPNUM,EXPSTART,EXPEND.
SPHDRFIX: Add support for editing raw frame (sdR-*) headers by putting
            OPHDRFIX entries in the sdReport-$MJD.par files, of the
            same form as that used in the file "opHdrFix.par".
            We've changed the structure name SPECHDRFIX to OPHDRFIX, since
            we can use exactly the same thing for PT or 2.5-m data.
SPREDUCE1D, ZFIND, ZCOMPUTE, FIND_NMINIMA: Plotting and debugging
            tools added with the /DOPLOT, /DEBUG keywords.
SPREDUCE1D: Change flag for small chi^2 difference to be triggered
            when RCHI2DIFF < 0.01 or when RCHI2DIFF < 0.01 * RCHI2.
            This means that the difference in reduced chi^2 should be at
            least 0.01 if chi^2/DOF=1, or at least 0.10 if chi^2/DOF=10.
            Print the versions of idlspec2d,idlutils in the log file.
            If the outputs spZall,spZbest files already exist, then rename
            those files rather than destructively over-writing them (using
            CPBACKUP).
            Added search for CV's using the eigenfile 'spEigenCVstar-*.fits'.
            Search for QSO's out to z=7.0, but this will require templates
            that span [525,9300] Ang.
            For the moment, disable setting the 32L flag for ZWARNING,
            since this seems to usually be erroneously set (when it is set)
            in the 2nd pass through the ZFIND routine.  I'll have to track
            that down later.
            Fix bug that SN_MEDIAN wasn't positive definite.
            Add FRACNSIGHI,FRACNSIGLO to outputs.  Trigger ZWARNING=16 from
            only high outliers (FRACSIGHI) for QSO's, whereas we trigger
            based upon FRACNSIGMA for all other objects.
ZCOMPUTE, FIND_NMINIMA: Return a (negative-valued) error code
            from FIND_NMINIMA, which ZCOMPUTE stuffs into Z_ERR.
ZFIND: If fewer than NFIND peaks are found, then return blank structures
            for the remaining (NFIND-NPEAK).  Previously, some of those
            fields (such as TFILE,TCOLUMN) were filled with information.

aporsync.sh: Keep archiving guider images (gzipped).
aporsync.sh: Only copy the following select set of files:
             Unplugged*.ps, fiberScan*.par, guiderMon*.par, op*.par,
             plPlugMap*.par, sdReport*.par
aporsync.sh, sprobot.sh, sprobot1d.sh, sprobot2d.sh:
             Log the UID and PPID (parent process ID) to the file "sos.log",
             and record the timestamp both when this script is launched
             and finishes.
aporsync_logs.sh, aporsync_blue.sh, aporsync_red.sh:
             New scripts called from "sos.sh" instead of "aporsync.sh".
             This should be more robust, and prevent the logging+guider
             files from hanging up the whole system.
sos.sh, sos_status, startapo.sh: Use the new aporync scripts.
sos_start: Set defaults for RAWDATA_DIR and ASTROLOG_DIR appropriate for
             the machine sos.apo.
eigeninput_cvstar.dat: New file for PCA_CVSTAR.
eigeninput_star.dat: Many more M stars added for implementing changes
            to PCA_STAR.
opHdrFix.par: Correct some values for TILEID,RADEG,DECDEG for the early plates
            187, 202 and 214.
spFluxcalib-*.fits: A canonical set of flux-calibration vectors produced
            by APOFLUXCALIB and used by APOPLOT.
sos_redo: Don't allow this to be run from the machine sdsshost!
            --> Now a re-write of this, allowing either PLATE or EXPNUM
                keywords (but not both) as of 8 Jan 2002.
sprobot_start: Copy the data over starting at 10am Princeton time,
            which will be after "mailhtml.sh" is run at APO (at 7:20 am).
sprobot.sh: Run the same version of the idlspec2d product as is set up
            for this script.  For example, even if v4_9 is declared current,
            run v4_8 if that is what's set up when this script is run.
            So, you should run "sprobot_start" from the version of the code
            that you want to reduce the data.  The only exception is if the
            current version is not a UPS version, but just NOCVS; in that
            case, the version declared current on each remote host is used.

Combine all of the install instructions into one place,
in the file "idlspec2d_install.html".  The instructions
from "spectroSOS.html" have been moved there.
Add header card info to the "spectroSOS.html" document.

In idlutils:

All Goddard libraries updated to the versions as of 3 January 2002 from
the web site "http://idlastro.gsfc.nasa.gov/homepage.html".  It looks like
the last time I did any updates was exactly two years ago, on 5 Jan 2000.
The most notable update is to MRDFITS, which Wayne Landsman modified in
Dec 2001 following suggestions from Finkbeiner & Schlegel.  It explicitly
handles more data types (like UINTs, BITPIX=8, BITPIX=64) and deals with
null strings when writing structures to FITS binary tables (w/out crashing,
as it did before).
The following procedures moved within the Goddard repository:
      astro/oploterr.pro (moved from /jhuapl)
The following duplicate procedure was removed from the Goddard repository:
      misc/ydn2md.pro (other copy is in /plot)
All of the procedures in pro/tape_io have been removed from Goddard.
The following procedures are new to the Goddard repository:
      astro/cosmo_param.pro
      astro/galage.pro
      astro/lumdist.pro
      astro/observatory.pro
      astro/planet_coords.pro
      astro/gal_uvw.pro
      astro/calz_unred.pro
      astro/jplephinterp.pro
      astro/jplephread.pro
      astro/tdb2tdt.pro
      astro/jplephtest.pro
      astro/lsf_rotate.pro
      fits/fxmove.pro
      idlphot/pixwt.pro
      math/meanclip.pro
      math/minf_parabol_d.pro
      math/value_locate.pro
      math/asinh.pro
      misc/fstring.pro
      misc/n_bytes.pro
      misc/checksum32.pro
      plot/vsym.pro
Files in goddard/data and goddard/text have also been added+deleted+modified.

BSPLINE_ITERFIT: Properly passing INMASK to allow for recouping lost data
           points.  Small cosmetic changes to work clearly with INMASK
           and OUTMASK.
DJS_REJECT: Added GROW option to mask neighboring pixels.
            Added /GROUPBADPIX option, which probably fails with multi-
            dimensional data (Scott thinks).
            Also some small changes to the way grouping works.
EFCMN: Small change declaring a loop index as a long int.
EXTAST: Allow GSSS coordinate systems other than RA,DEC.  Specifically,
            allow the use of 'GLON-GSS' and 'GLAT-GSS' which we use
            in the PT image headers.  This means that our version of this
            code is currently branched from Wayne Landsman's Goddard version.
RMFILE: Bug fix for the case that one element of the filename array is blank.
YANNY_FREE: Don't crash if PDATA is not set.
YANNY_READ: If there are too few words on a line for a structure entry,
           then set ERRCODE=-1 and return PDATA=0.
           Also, increase the allowed line-length to 1023 characters
           (was 255).  The file can still have longer lines by using
           the back-slash as a continuation.  And one can still use
           the /QUICK option for lines with more than 1023 characters,
           but that option fails if continuation characters are used.
           Add the STNAMES keyword to return the names of structures
           for when /ANONYMOUS must be used.
           Special-case the replacement of {{}} with "", since it seems
           that some bonehead used the former to denote blank strings in
           the idReport files.
vector_avsigclip_mask: Fix a bug in the C code vector_avsigclip_mask
           that could potentially affect the IDL proc DJS_AVSIGCLIP
           in the case when a mask is used but all points are rejected.
evilinstall: If unable to check-out or install the code,
           then do not declare it current in the UPS table!
           Print "ABORT" for any failures in the install.
evilmake: Turn optimization flags back on, which we commented
           out some time ago because it failed on an OSF platform.
           Still might not work under OSF as far as we know, but who cares?
           We'll pick up 20% in speed for Spectro-2D under Linux by optimizing.

-------------------------------------------------------------------------------
v4_9_0 (Nov 10, 2001 idlutils only) running on IDL 5.3 - 5.5
Built against specflat v1_2.

YANNY_PAR (in idlutils): Add INDX keyword, and fix bug in returned COUNT.
         Support for KEYNAME input as an array.
evilinstall (in idlutils): If $CVSROOT is not set, then set it either
         by setting up the "sdsscvs" product or explicitly setting to the
         Fermi CVS location.  This allows the option of installing from a
         different repository (i.e., Princeton or NYU) by setting $CVSROOT
         first.

-------------------------------------------------------------------------------
v4_8_4 (Aug 29, 2001 idlspec2d+idlutils) running on IDL 5.3 - 5.4
Built against specflat v1_2.

Minor fix to 2D-combining code for running plates 214,340,270 which failed.

MYFLUXCALIB: Fix bug whereby the PCA spectrum could be negative.
     (The routine PCA_SOLVE() can return a negative-valued spectrum even
     if all the input spectra are positive-valued.)  This crashed plate 340.
PCA_SOLVE: Forgot to return optional outputs OUTMASK, USEMASK in the case
           of only a single spectrum being passed.  This happened in the
           combining of plate 214 in MYFLUXCALIB, and crashed.
SDSSPROC: Prevent dividing-by-zero when using /APPLYPIXFLAT,
          though the resulting NaN's had been caught and replaced anyway.
SPREDUCE1D: The outputs ANYANDMASK,ANYORMASK were not being constructed
            properly, and were simply wrong.  Should be fixed now.
sprobot,sprobot_start: Scripts now use the environment variables
          SPROBOT_HOST,SPROBOT_LOCALDISKS for telling which machine to copy
          the raw data from, and which local disks to write to.
          These scripts are now generalized to the point where they can
          be run from anywhere by just setting up environment variables.
spChunkList.par: Update chunk list for chunks 20-25 (up to plate 769).

BSPLINE_BKPTS (in idlutils): Do not crash even in the case of very few
         data points.  But untested whether this actually does what we want
         in that case.
BSPLINE_ITERFIT (in idlutils): Return cleanly in the case of no un-masked
         data points.
eviltarball (in idlutils): New script to export a version of a code
         and build a tar file for distribution.

-------------------------------------------------------------------------------
v4_8_3 (Aug 24, 2001 idlspec2d+idlutils) running on IDL 5.3 - 5.4
Built against specflat v1_2.

Cut version for running P-1D, improving the redshift fits + errors.

BATCH1D,BATCH2D: Added /CLOBBER option to reduce all specified plates,
         over-writing any previous reductions.
BATCH2D: Enabled keywords PLATESTART,PLATEEND,MJD,MJSTART,MJEND.
         Change the logical link to the raw data directory to be
         topdir+'/rawdata' rather than simply '../rawdata'.
         The latter would fail when outputs for some plates were
         in other linked directories, and then '../rawdata' did not
         resolve to anything.
FIND_NMINIMA: Replacement code for FIND_NPEAKS, for solving the chi^2
              minima for redshifts.  This routine will fit a quadratic
              if there are only 3 points, and a gaussian plus a constant
              if there are more than 3 points.
              If there is an error in the fit, return an error code as a
              negative integer in XERR.
GET_MJD_DIR: Make leading zeros significant.  This was necessary to fix
             the bug that '5*' would match 500 but also 050 and 150.
MJD_MATCH: New routine split out of SPPLAN1D.
READSPEC: Minor change to prevent crashing if data for some objects
          does not exist.  Specifically, if structures for some objects
          (e.g., ZANS or TSOBJ) did not exist, this routine could crash.
          Read the synthetic spectrum from the Zbest file if ZNUM is not set.
          This is much faster than regenerating the spectrum.
SPEC_APPEND: Minor change to prevent crashing if data for some objects
             does not exist.  (This routine is used by READSPEC).
SPPLAN1D: Now call MJD_MATCH().
SPREDUCE1D: Change the width in velocity space for fitting the chi^2
            minima in the redshift-finding.  These widths can be broader
            now that we'll be fitting with gaussians rather than quadratic.
            (The quadratic fits were not a good approximation when fitting
            more than a few points.)  Now always use at least 5 points.
            Add another ZWARNING flag: Set the 32L bit if the redshift-error
            warning flag is set to -1, which means that the chi^2 minimum
            was at the edge of the redshift-fitting range.
VDISPFIT: Increase chi^2 computation from [0,475] to [0,600].
ZCOMPUTE: Replace call to FIND_NPEAKS() with FIND_NMINIMA().
ZFIND: Do not modify any errors that are less than zero, since those
       can be used as just warning flags from the fit.
       Increase to search lags (as specified by PMIN,PMAX) according to
       the values of both PWIDTH and WIDTH.
ZFITMAX: Replace call to POLY_FIT with SVDFIT such that this routine
         behaves the same under either IDL 5.3 or 5.4.  It was the
         case that the errors were improperly computed using the re-
         write of POLY_FIT in IDL 5.4.

New template files spEigenGal-52146.fits,spEigenStar-52146.fits
based upon v4_8_1 reductions, though using the same input list of
spectra that we've been using for ages.

In idlutils, added MPFIT routines from Craig Markwardt.  These will
be used for the redshift-finding code (specifically, FIND_NMINIMA).

build_links (in idlutils): Do not build a link for any file if the link
        name already exists.

-------------------------------------------------------------------------------
v4_8_2 (Aug 16, 2001 idlspec2d+idlutils) running on IDL 5.3 - 5.4
Built against specflat v1_2.

Trivial changes for running this version at Fermi.

SPALLREDUCE: SPECFLAT_DIR is not set now, if SPECFLAT product exists and
          is specified (this proc only used at Fermi).

PLATECOMPARE: New proc for interactive comparison of descrepant redshifts.
PLATELIST: Added /PURGE2D, /PURGE1D options.
PLOTSPEC: Added /NOERASE keyword.  Minor fix to Y plotting range.

RMFILE (in idlutils): Add support for deleting a list of files.
SPLOT (in idlutils): Minor bug fix to avoid plotting the axes twice.
evilinstall (in idlutils): Syntax changes to work with bash on spectro.

-------------------------------------------------------------------------------
v4_8_1 (Aug 9, 2001 idlspec2d+idlutils) running on IDL 5.3 - 5.4
Built against specflat v1_2.

Cut version for re-running Spectro-2D on all data.

EXTRACT_OBJECT,SMOOTH_SUPERFLAT: Better working smooth_superflat (with a QA
          plot).  Added "Area" to plot anything above 0.01 gives a warning.
FILTER_THRU: Fix failure mode when only a 1-d WAVEIMG is passed.
PLATELIST: Add EXPTIME to output files.
PLOTSPEC: Major re-write to allow flipping through many plots on a plate
          and change plotting parameters.  Or, send plots to PostScript files.
          Usage of ZNUM changed -- see READSPEC for new usage.
          Plot labels in green for legibility in the plot window, and
          include the ZWARNING flag in the label if it is nonzero.
READSPEC: Return successfully even if redshift files not found.
          Change usage of ZNUM such that ZNUM=1 is best fit, ZNUM=2 is 2nd best.
SPCOADD_FRAMES: Set keyword SMEARUSE to T or F.
SPFLATAVE, SPFLATTEN2: Handle edge effects better.  In SPFLATTEN2, set
          any pixels more than 2 pixels from the left/right of the first/last
          fiber equal to zero.  Then, in SPFLATAVE, any edge pixels that are
          zero from all nights are set to unity.
VDISPFIT: Bug fix for objects with negative velocities.
idlspec2d.table: Make an optional dependence upon the "specflat" product.
sprobot.sh: Copy only the compressed ("sdR-*.fit.gz") files from
            sos.apo.nmsu.edu, instead of the raw files from sdsshost.apo.

evilinstall (in idlutils): Minor syntax changes to work with RH7.1 on spectro.
ATV (in idlutils): Handle unsupported CTYPE, CTYPE reversal gracefully;
                   left click on apphot (Imexam) prints coords
SPHEREMATCH (in idlutils): New code to match two lists of RA,DEC.

-------------------------------------------------------------------------------
v4_8_0 (Jul 17, 2001 idlspec2d+idlutils) running on IDL 5.3 - 5.4
Built against specflat v1_1.

First cut of v4_8 with many major changes.  Not yet tested for prime time.

******MAJOR CHANGE: spFrame output is now normalized with superflat,
                    to correct for small scale features which cannot be removed
                    by standard star correction.
                    HDU 6 now contains the superfit in spFrame
                    Telluric correction has been moved to HDU 7.
          The B-spline break-points in the files blue.bkpts, red.bkpts
          have been changed.

SKYSUBTRACT: Increased rejection limit for 1d fit.  This should be more robust
          anyway, and tighter rejection was masking out real PSF variations
          which led to very big sky residuals in 2d fit.
          Also decreased the number of blue side breakpoints to 1024.

FITVACSET :  keyword "airset" which return air wavelength solution with
          no heliocentric correction (required to properly sample superflat
          shifted to skyline frame)
FIBERFLAT :  keyword superflatset to return normalized superflat fit
DIVIDEFLAT:  removed all traces of fibermask
EXTRACT_OBJECT, SKYSUBTRACT, SPCALIB: Implement 2D-splining for sky-
          subtraction, now set to do quadratic PSF fit.
          Also, first attempt to put in airmass correction to the sky
          brightness by dividing all the sky vectors by the airmass of
          each fiber, then fitting for the supersky, then multiplying
          back in the airmass terms.
          New limits to mask in pixelflat 0.8 < flat < 1.2.
                              old values: 0.5 < flat < 1.5

EXTRACT_OBJECT: Set the "NEARWHOPPER" mask bits only for fibers within 2
          fibers of a bright fiber, but not the bright fiber itself.
          For the bright fibers, add the bit "WHOPPER" (added to the
          param file spMaskbits.par).
            Changed the rejection thresholds yet again, and also uncommented
          2-D sky subtraction to test.
EXTRACT_OBJECT, SKYSUBTRACT: Exit gracefully in the case of no good sky
          fibers.  In that case, issue an "ABORT" log message, return
          SKYSTRUCT=0 from SKYSUBTRACT, then do not write an spFrame file.
EXTRACT_ROW: Do not correct rejection levels in relative mode if chi^2 < 1.0.
             This means that we can boost the errors to be larger than the
             expected Poisson errors, but not smaller.
FIBERFLAT: Update to call SUPERFLAT() as a function instead of a proc,
           though should not be functionally different yet.
FILTER_THRU: Switch to the newly-measured filtered curves, "sdss_jun2001*.dat".
             Use the Goddard routine LINTERP instead of the IDL built-in
             INTERPOL.  Also, correct the integrations for the pixel size.
FITMEANX: Make robust to no good sky lines for tweaking wavelength solution.
          In that case, the routine LOCATESKYLINES will return SKYSHIFT=0.
FPOLY, FUNC_FIT, TRACESET2PIX, TRACESET2XY, XY2TRACESET:
             Added "poly" as one of the functions for trace sets.
LOCATESKYLINES: Test that the sky line file is successfully read.
MYFLUXCALIB: Fairly major changes: Do a pre-filtering of the spectra that
             go into the PCA-fitting of the flux-calibration vector, and
             mask out the most deviant points.  Run the PCA-fitting with
             more iterations to ensure convergence.  Also, finally comment
             this code.
PCA_SOLVE: Construct the USEMASK from the output mask (OUTMASK) instead of
           from NEWIVAR.  This is equivalent to TOTAL(OUTMASK,2).
           This should make the flux-calibration vectors produced by
           the proc MYFLUXCALIB more robust, since it rejects pixels in
           the solution based upon USEMASK.
PLATELIST: Read MJDLIST keyword from the spPlate files, which will only exist
           with future reductions.
           Include a computation of the airmass in the FITS version of the
           platelist file.
PLATESN: Pass a plot title to PLOTSN.
PLOTSN: For the 2nd page of plots with Synthesized mags. vs. PHOTO fiber mags.,
        make these residual plots.  Also, use plot titles.
QAPLOT_SKYLINE: Plot skyline strength residuals as a function of airmass,
        which in fact is exactly what they are correlated with!
        Issue a warning message if the computed airmasses are out of the
        range [1,3].
REJECT_SCIENCE: New proc to reject science exposures if they are blatantly
                bad (typically, if they are saturated).  We have already been
                doing this for arc + flat exposures.  This proc is called
                by SPREDUCE, and will issue an "ABORT" log message if a
                science frame is rejected.
SDSSPROC: Add VERSLOG, VERSFLAT keywords to specify versions of the
          products SPECLOG, SPECFLAT.
          First search for files "pixflatave-*.fits", and if not found then
          look for "pixflat-*.fits".
SDSSPROC, SPCALIB, SPREDUCE, SPREDUCE2D: No longer pass the name of the pixel
          flat between all these files.  Instead, just let SDSSPROC find the
          correct one in the "specflat" product, in $SPECLOG_DIR/flats.
SMOOTH_HALO: A new version of smooth halo, which should be closer to the truth.
SORTPLUGMAP: Fill in unplugged fibers with arbitrary entries, and assign
       them a FIBERID.  For spectrograph #1, we assign the unplugged fibers
       from the beginning of the plugmap, and for #2 from the end.
       This should result in the unplugged objects being uniquely placed
       on only one of the spectrographs.  This addressed PR #2487.
SPCOADD_FRAMES: Include MJDLIST keyword in spPlate header, which will be
                the list of all MJD's used in an SPCOMBINE.
                Add BUNIT keyword for the flux, inverse variance, and
                dispersion HDU's.
SPFLATAVE: New routine to average together a set (or all!) pixel flats
           in the SPECFLAT directory.
SPFLATGEN: New routine.  Wrapper for SPFLATTEN2 for generating pixel-to-pixel
           flat-fields.
SPFLATTEN2: Major changes! Now call the 2-dimensional B-spline code when
            generating the superflats.  However, there seem to be problems
            with this code for some combinations of NORD and NPOLY.  I have
            set NORD=3, NPOLY=4 which seems to be a combination that works.
            (A PR has been filed against idlutils.)
            Subtract the scattered light image before dividing by the super-
            flat evaluations -- w/out doing this, we had bad residuals where
            the scattered light contribution was large compared to the signal
            (particularly in the UV).
            Also, small changes to how directory names are parsed, and retain
            the header from the file ALLFLATS[0] for the output file.
SUPERFLAT: Pass X2, NORD and NPOLY keywords to support fitting 2-dimensional
           B-splines in the call to BSPLINE_ITERFIT().  At the moment,
           this will only be implemented for the proc SPFLATTEN2, not for
           FIBERFLAT.  (So this shouldn't effect the spectro reductions
           except for updated pixel flats.)
           Also, make this a function instead of a proc.
TELLURIC_CORR: Fixed horrible bug in using fibermask to reject bad fibers
               (fixes PR #2162).  Also, when fitting the local continuum
               around a single telluric band for a single star with a
               polynomial, do the fit with weighted points and iterated
               rejections using DJS_REJECT().
THROUGHPUT_CALIB: New proc for assessing total system throughput using
                  the intermediate files "spFluxcalib*.fits".
TRACE320CRUDE: Added call to DJS_MASKINTERP() in the beginning to prevent
               hot columns from throwing the initial trace (which does
               not use the errors at all).
zplot: Quick-and-dirty script for finding and plotting a spectrum (at Princeton)
       w/out setting up any path variables or SDSS products.

f8v.abs: Increase flux-calibrating mask around H-alpha by 50%, now
         masking +/- 1500 km/s (+/- 32.8 Ang).
opBC-51813.par: One extra bad column [370,1800:2047] on r2.
       There are a few extra additions to match the new pixflatave-00000 files.
       Instead of flagging all of the "pits", these are not included, but
       can be rejected using minflat/maxflat = 0.8/1.2

BSPLINE_ACTION, INTRV (in idlutils): Bug fixes for 2-D spline fitting.
     Include 'poly1' function in BSPLINE_ACTION(), and set the function
     properly in BSPLINE_ITERFIT.
BSPLINE_FIT, BSPLINE_ITERFIT (in idlutils):
     Remove MASK keyword, since it is too confusing with INMASK, OUTMASK
     already used in BSPLINE_ITERFIT().  It didn't look like it was
     actually used anyway!
DJS_REJECT (in idlutils): Add the GROUPDIM keyword, and allow GROUPDIM,
          MAXREJ and GROUPSIZE to be vectors for several limits in the
          rejection algorithm.  These were some major changes, and hopefully
          are completely backwards-compatable.
SPLOT (in idlutils): Changed interactive gaussfit (g) so amplitude is correct.
YANNY_READ (in idlutils): Try to make backwards-compatable with IDL 5.2
          by replacing calls to STRSPLIT() with calls to STR_SEP.
build_links (in idlutils): New script for building links between directories.
evilinstall (in idlutils): Add another option for location of sdssfue
          scripts (for the installation on sos.apo), and also set the
          CVS locations to the default at Fermi if not set up with
          "setup sdsscvs".

-------------------------------------------------------------------------------
v4_7_6 (Jun 9, 2001 idlspec2d only)

data_rysnc.sh: Bug fixes in SOS copy, and adaptation to sos.apo.nmsu.edu
               (i.e. ps -elf does not work, and scp1 does not exist).

-------------------------------------------------------------------------------
v4_7_5 (Jun 8, 2001 idlspec2d only)

data_rsync.sh: SOS should now attempt to archive data with gzip and move
               offsite in the morning.
killdata.sh, mailhtml.sh, sos.sh, startapo.sh, APOREDUCE:
               Adapted to work on sos.apo.nmsu.edu, and fixed file transfer
               bugs.  For APOREDUCE, changed spawn of "scp1" to "scp", since
               the former did not exist on the new machine sos.apo.

sprobot_start: Remove "sprobotcopy" from the cron jobs, since copying
               reduced data to Fermi always fails.
               Set SPECLOG_DIR=$ASTROLOG_DIR for the Spectro-Robot.

-------------------------------------------------------------------------------
v4_7_4 (May 10, 2001 idlspec2d+idlutils)

COPY_STRUCT, COPY_STRUCT_INX (in idlutils):
          These routines didn't work properly for structures with more
          than 32768 elements, because of using only 2-byte integers.
          This resulted in READSPEC not working properly for large lists,
          and other dependent routines such as ZPLOT (where I noticed it!).
READSPEC: Bug fix when reading one range of fiber numbers for a FITS
          binary table, i.e. "READSPEC, 301, [1,2,3], ZANS=ZANS" was not
          returning the correct values.
ZPLOT: Include MJD in call to READSPEC.

spPlateList.par: Enlarge list of EDR plates to include multiple pluggings,
       and other plates that should have been in the list according to van
       den Berk's mail to sdss-spectro/665 on 2 May 2001.  The list now
       includes 136 plates, many of which are repeat observations.

Spectro-Robot scripts:
       Let the scripts "sprobot2d.sh" and "sprobot1d.sh" test whether they
       are already running, and quit if they are.
       Update the syntax to "ps" commands as per RHL's suggestions.
       From sprobot.sh: Batch process 2D first, wait for it to complete,
       then batch process 1D in the background.

-------------------------------------------------------------------------------
v4_7_3 (Apr 30, 2001 idlspec2d+idlutils)

PLATESN: Typo introduced on April 13th that crashes SPCOMBINE -- fixed!
SDREPORTMAKE: New proc for generating sdReport files from raw idR files.

In idlutils:
YANNY_READ: Add optional /ANONYMOUS flag to avoid conflicts in structure
            types, in the event that named structures actually change
            between calls (will be used by SDREPORTMAKE).
            Split lines with semi-colons, for when reading early sdReport
            files with SDREPORTMAKE; however, this may introduce bugs
            elsewhere because it was not done totally generally.

In the Spectro-Robot bash scripts, change the top-level directory for
the plug-map files from $SPECLOG_DIR to $ASTROLOG_DIR.  Use the $SPECLOG_DIR
only for re-running with cut versions of everything, including the "speclog"
product.

-------------------------------------------------------------------------------
v4_7_2 (Apr 27, 2001 idlspec2d only)

PLATELIST: Use the "spPlateList.par" file to determine which data are public.
           Add a PUB column to denote if a plate is in a public data release.
PLATEMERGE: Add the /PUBLIC option to trim only to public data.

More updates to "opHdrFix.par" file.
Makefile in /bin did not copy all executables when installing; now it does.
Update the batch files to use the wire machines as a default.
Update spectro home page to reflect v4_7 reductions.

-------------------------------------------------------------------------------
v4_7_1 (Apr 9, 2001 idlspec2d+idlutils)

FILTER_THRU: Add new Doi filter curves (CCD+atmosphere+telescope), and
             add /TOAIR flag to convert from vacuum to air wavelengths.
             (But not yet called by 2D or 1D).
PCA_SOLVE, COMPUTECHI2: Make robust to one or all of the template spectra
              (e.g., the STARFLUX vectors) being identically zero.
              The routine PCA_SOLVE could crash w/out special-casing this
              due to an apparent bug in the built-in routine PCOMP().
SPCOMBINE, SPCOADD_FRAMES: Optionally allow spFrame files to be g-zipped.
READSPEC, SPREDUCE1D: Allow spPlate, spZ files to be g-zipped.
READSPEC: Major changes to speed up the code when reading a sparse number
          of fibers per plate.  It used to read all the fibers between the
          smallest and largest fiber number.  Now it divides up the requested
          fibers into contiguous chunks, and reads in only those chunks.
          (The plate file is still only opened once, and the header is only
          read once.)

Add new mask bit: NEARWHOPPER.  This effects the following routines:
              EXTRACT_OBJECT, FLUXCORR_NEW, MYFLUXCALIB, TELLURIC_CORR.
              These fibers are also implicitly ignored by sky-subtraction
              because the sky-fiber selection implicitly assumes all fiber-
              mask bits are fatal (in EXTRACT_OBJECT).

Son-of-Spectro changes:
New executable, "sos_redo" to re-run SOS on failed reductions.
APO_APPENDLOG: Now overwrite entries in the file "logfile-$MJD.fits" if an
              exposure is re-reduced (e.g., with "sos_redo").
APO_LOG2HTML: Placed a lower limit of (S/N)^2 > 2.0 to count towards total
              in each camera
QUICKEXTRACT: Change message about post-cabibs from "REQUIRED" to merely
              "recommended."
              Slightly loosened constraints on match_trace to +/- 0.15 pixels.
QUICKTRACE: Tweak test for putative Argon lines in flats to be a less
            sensitive trigger.
REMOVE2REDO: (New proc) Checks for missing entries in logfile*fits and
            removes corresponding raw data; called by script "sos_redo".
The routine FIND_WHOPPING is moved out of EXTRACT_OBJECT so that it can
            be called by QUICKEXTRACT.
Changed SOS signal-to-noise warning to a yellow warning below S/N=15/pix,
            and S/N=13/pix.
More entries in "opHdrFix.par" to fix all the incorrect plugmap files
            known to date.  However, we still need to get the correct
            files copied into the /astrolog directories.

-------------------------------------------------------------------------------
v4_7_0 (Mar 16, 2001 idlspec2d+idlutils)

FLUXCORR_NEW: Replace deviant fluxcorr coefficients with the median
              Attempt to mask large positive deviations in inverse variance
              (PR #2040)
SPCOMBINE:    combinedir is now a keyword for spcoadd_frames.
              SPFLUX and SPCOADD_FRAMES utilize directory keywords as well.
              Start by zeroing-out the 4 mask bits set by combining step.
FIBERFLAT:     Simple check to exclude extrema  (PR #2123)
COMBINE1FIBER: Replace the lines which errantly set NODATA with a check for the
               extrema wavelengths which have no signal. (PR #1939)
SPPLANCOMB,
SPALLCOMBINE:  Fixed Bug to combine a specific MJD

BSPLINE_ITERFIT (in idlutils): Modified to avoid crashing SPREDUCE1D.
   Two changes: (1) Return a valid solution even in the case where the variance
   of the y-vector is zero.  (2) In the case where there are too few points to
   fit, still return a valid solution of all zeros.
FINDSPEC: New routine for finding SDSS spectra that match a given RA, DEC.
MULTISYNTHSPEC: New routine that is sometimes faster than SYNTHSPEC, but
           I would not recommend using this yet.
MYFLUXCALIB: Make robust to degenerate case of only 1 input spectro-photo std.
PLATELIST: Lower (S/N)^2 cutoff to 13 for all G,I bands (from 15 previously).
           If ZWARNING flag exists in 1D outputs, use that to determine
           number of UNKNOWN or SKY identifications.
PLOTSPEC: Add ZNUM option (also new to READSPEC).
READSPEC: Add option to generate the synthetic spectra.
          Add ZNUM option to get fits other than the best fit.
REDMONSTER: New routine for looking for Red Monster (large regions of
            bad sky residuals, which, for example happens when the hand-paddle
            light is on at the telescope).  Flag these pixels with the
            REDMONSTER mask bit.  This routine replaces MONSTER.
SPREDUCE1D: Search for stars at velocities to +/- 1200 km/s (was 600 km/s).
            No longer identify objects as UNKNOWN, but rather set bits
              in a ZWARNING flag.
            Add outputs ZWARNING, SN_MEDIAN, FRACNSIGMA,
              COUNTS_SPECTRO, COUNTS_SYNTH, COUNTS_SKY (not used yet),
              VDISP, VDISP_ERR, ANYANDMASK, ANYORMASK.
            Compute velocity dispersions using real-space method (VDISPFIT).
            Slightly increase width for re-fitting galaxy redshifts from
              PWIDTH=5 to 7.  This may fix PR #1938.
            Speed up computation of FRACNSIGMA by calling FILTER_THRU()
              for the whole plate at once.
            Output SYNFLUX as a 2nd HDU in the spZbest*.fits file.
SYNTHSPEC: Calling sequence now allows for returning an array of spectra.
TELLURIC_CORR: If a telluric star is deemded bad, then reject all of
            its FITFLUX pixels from the global fit.  Previously, we were
            only rejecting the pixels INDT, but still allowing bad continuum
            pixels into the fit.  This fixes PR #2028.
YANNY_PAR (in idlutils): If several lines have the same keyword name,
            then return all of those values as an array.  This makes this
            routine backwards-compatable with Yanny files written previously
            with SPPLAN2D.
ZFIND: Get rid of SIGMA2,SIGMA2_ERR and add VDISP,VDISP_ERR.

Add new mask bits: BADSKYCHI, REDMONSTER, SMEARIMAGE, SMEARHIGHSN, SMEARMEDSN.

New installation script "evilinstall" in the idlutils product.

Add a line to the cron tables from "sos_start" and "sprobot_start" to
keep the disk auto-mount points alive at Princeton (or anywhere using an
amd daemon).

-------------------------------------------------------------------------------
v4_6_2 (Feb 14, 2001)

For the Fermi calling script SPALLREDUCE, add an NCOMBINE keyword
to limit the number of exposures combined.  Default to a maximum of 7.

-------------------------------------------------------------------------------
v4_6_1 (Feb 14, 2001)

SPCOMBINE: Reverting to adderr=0.03 to prevent rejections in high S/N regions
SKYSUBTRACT: The "fix" in the previous version didn't properly check the
             bad mask bits, and in fact could make things worse.  Now fixed.

-------------------------------------------------------------------------------
v4_6_0 (Feb 9, 2001)

EXTRACT_OBJECT: Reverted to Gaussian Profile, more robust flat field
                 interpolation, still 3% are fluctuations when
                 NEARBADPIXEL is set.
FIBERFLAT: Fiber is flagged BADFLAT is more than 30% of pixels are masked.
FLATINTERP: Remove call to this code.
SPCALIB: Back to original flat field rejection levels matches object extraction.
SKYSUBTRACT: Check for NEARBADPIXEL and LOWFLAT bit as well in pixelmask.

Add BADFLUXFACTOR mask bit when applying flux-calibration and flux-correction
vectors.

Fixed DJS_BATCH to work properly on remote but cross-mounted CPU's.

Plan files (spPlancomb*.par) written by SPPLAN1D now puts all the "planfile2d"
entries on the same line to be consistent with how YANNY_PAR() works now.

Fix the spike in memory usage at the end of SPCOMBINE.

Major changes to PLATELIST routine to return more info, and make a FITS
binary table.

-------------------------------------------------------------------------------
v4_5_0 (Jan 31, 2001)

Edits to raw frame headers now possible with SPHDRFIX procedure, which
reads the list of changes from opHdrFix.par file.  In particular, this
allows us to edit wrong headers in some of the earliest data.

The F-star flux-calibration vectors are generated with a PCA analysis
that now allows several rejection iterations.

More iterations added to the arc-line centroiding in FITARCIMAGE
(addresses PR #874).

Son-of-Spectro now tests for the Red Monster (light at 6400-6550 Ang in
science frames), and tests for argon lines in the flat-fields.  The Red
Monster is presumably from the handpaddle being left plugged in.

SPREDUCE1D: If an object is fit by a negative STAR or negative QSO, then
            re-classify it as UNKNOWN.

-------------------------------------------------------------------------------
v4_4_0 (Jan 23, 2001)

Remove any telluric-correction beyond 8250 Ang, since we don't believe
any of it there.  In fact, it looks like we were multiplying-in features
that are F-star absorption lines at 8540 and 8660 Ang.  But what about
the broad feature at 8665 Ang -- is that a telluric-band, or an intrinsic
F-star feature??

Keyword CARTID added to headers to track cartridge ID's.

Spectro robot scripts included in /bin directory (sprobot_start, etc.)

For Son-of-Spectro, the WARNING and ABORT messages are now saved in HDU #5
of the FITS log file, rather than as an element of the other HDU's.

For Son-of-Spectro, now only copies astrolog directory of existing
/data/spectro/$MJD data directory, since from now on the astrolog directory
will never be purged.

-------------------------------------------------------------------------------
v4_3_1 (Dec 10, 2000)

This version of "idlspec2d" has the following enhancements for
Son-of-Spectro (SOS):

(1) The hard-wired user/machine/version dependencies have been removed.
    SOS can now be run by any user on any machine, which we may want to
    do to avoid conflicts with the fiber-mapper.  Though for now, this
    will continue to be run from "observer@plate-mapper".
(2) Starting+stopping SOS is now done with the commands
       sos_start
       sos_status
       sos_stop
    which will start-up whichever version of the code has been either
    declared or set up.  Backing out of versions is now straight-forward.
(3) The code can now be managed remotely.  For example, from "sdsshost"
    you can type:
       setup idlspec2d
       sos_status observer@plate-mapper
    to check the status of SOS.
(4) SOS delays execution when the fiber-mapper is being run.
(5) More logging information is kept.
(6) Identified and removed Y2022 bugs which would have stopped SOS from
    working at MJD=60000.  It should now work until the year 2132.
(6) Documentation is now complete, and updated to reflect all above changes.
    The relevant documentation is also in the "sdssProcedures" product.

-------------------------------------------------------------------------------
v4_3_0 (Dec 6, 2000)

The changes are primarily to the Son-of-Spectro (SoS) code, specifically:

(1) The FITS log files have been re-structured to significantly speed
    up reading these files.  This was the bottleneck that slowed SoS
    down towards the end of a night, since each instance of reading these
    files locked out other processes.  Our hope is that now SoS will
    keep up during the night.
(2) Bias and dark exposures are now analyzed, and the 98th percentile
    of all values in these images are reported to SoS.  For example,
    if 98% of the pixels in a bias are below 8 ADU, then PERCENTILE98 = 8.
(3) The operational limits file has been edited so that SoS values
    that appear in red should definitely be considered very bad.
    For example, if the number of arc lines found (NLAMPS) is red, then
    that arc exposure should be considered bad and another should be
    taken until a good number are found.
      In practice, we expect it to be rare that anything falls out of spec.

-------------------------------------------------------------------------------
v4_2_0 (Nov 28, 2000?)

1)  Skip low S/N smear images in flux correction (previously aborted)

2)  Added bad columns to opBC.par

3)  Fixed bug in sdssproc when dealing with shifted rows between
    MJD 51578 AND 51580 inclusive.

4)  Changed structure of spMerge2d to have [flux,err] as image
    in HDU 0, and [andmask, ormask, dispersion] as binary table in HDU 1.

5)  Added headers cards to HDU's 1-5 in spPlate*fits to include wavelength
    information.

6)  Fixed bug to work on sdR*gz files.


-------------------------------------------------------------------------------
v4_1_0 (Oct 20, 2000?)

The following lists the highlights/lowlights
of the new 2d version:

Here is a catalog of the raw 2d output:

    spFrame-cc-xxxxxxxx.fits       Object Frame extraction

        HDU0 :  "Flattened" counts per pixel   Float 2048x320
        HDU1 :  Inverse variance of HDU0       Float 2048x320
        HDU2 :  Pixelmask (see below)          Long  2048x320
        HDU3 :  Wavelength coefficients        Structure
        HDU4 :  Dispersion coefficients        Structure
        HDU5 :  plPlugMapP for 320 fibers      Structure
        HDU6 :  Telluric correction image      Float 2048x320  (only for red)

    spSky-cc-xxxxxxxx.fits    2048x320  Subtracted sky image
    spFlat-cc-xxxxxxxx.fits   2048x320  flat field vectors
    spArc-cc-xxxxxxxx.fits    2048x320  Arc spectra extractions +
                                           HDU1: inverse variance
    spDiag2d-pppp-mmmmm.ps
    spDiag2d-pppp-mmmmm.log

Legend:

xxxxxxxx  Frame number
pppp      Plate number
mmmmm     MJD
cc        camera
s         spectrograph

Just before combining 2 or more exposures into fully merged spectra
we perform two flux calibration steps.   The outputs are:

    spFluxcalib-xxxxxxxx-s.fits   Bspline structure to convert
                                  flattened counts to 10^-17 ergs/s/cm^2/A

    spFluxcorr-xxxxxxxx-s.fits    Polynomial coefficients to correct
                                  science frames to smear frame

The final coaddition uses spFrame, spFluxcalib, and spFluxcorr to create

    spPlate-pppp-mmmmm.fits    Fully calibrated final 2d output

        HDU0 :  Fluxed log-linear spectra   Float npix x 640  where npix ~3900
                 units of 10^(-17) ergs/s/cm^2/A

        HDU1 :  Inverse variance of HDU0
        HDU2 :  Pixelmask (Intersection  aka AND mask)  LONG npix x 640
        HDU3 :  Pixelmask (Union  aka OR mask)          LONG npix x 640
        HDU4 :  Dispersion Image (sigma of arc lines)
                  in units of 1.0e-4 log10 lambda
        HDU5 :  plPlugMapP                              STRUCTURE

After the final coaddition, the data will be restructured into
individual files, one for each fiber:

    spMerge2d-pppp-mmmmm-fff.fits   (fff is fiber number 1 through 640)

        HDU0 :  Flux and err      Float npix x 2
        HDU1 :  Pixelmask AND,OR  LONG  npix x 2
        HDU2 :  Dipsersion image  Float npix x 1


!!!!!Notice:  Multiple MJDs with the same plugging will be combined!!!!!
             into single outputs, but will be labeled with the
                 highest MJD of the group.

             Bad data which should not be combined
             with subsequent data should be deleted before the subsequent
             data is run through 2d.

New features of v4_1_0:

  Major New Features:

    1) Spectrophotometry:

      a)  Flux calibrate with all available SPECTROPHOTO_STD and
          REDDEN_STD stars.  Use PCA to derive first and second
          eigenspectra.  Compare directly with SDSS Fundamentals to
          calibrate each smear exposure.

      b)  Flux correct each science frame with throughput and color
          terms to match spectrophoto solution of smear image for
          each fiber.  Use SPECTROPHOTO_STD solution to low S/N fibers.

    2) Correct for Near Infrared Scattering (see msg from jeg) and
       possible optical scattering.  The scattered light background
       is estimated from a model profile of the full 2048x2048 image.

    3) New maskbits:

        Each individual frame extracted by 2d has the following maskbits
        possibly set for each pixel: (found in idlspec2d/etc/spMaskbits.par)

      # The following mask bits are for the fiber, set in FIBERMASK_BITS()
maskbits  0 NOPLUG          # Fiber not listed in plugmap file
maskbits  1 BADTRACE        # Bad trace from routine TRACE320CRUDE
maskbits  2 BADFLAT         # Low counts in fiberflat
maskbits  3 BADARC          # Bad arc solution
maskbits  4 MANYBADCOLUMNS  # >10% pixels are bad columns
maskbits  5 MANYREJECTED    # >10% pixels are rejected in extraction
maskbits  6 LARGESHIFT      # Large spatial shift between flat and object pos'n
maskbits  7 BADSKYFIBER     # Sky Fiber shows extreme residuals

# The following mask bits are for a pixel, set in PIXELMASK_BITS()
maskbits 16 NEARBADPIXEL    # Bad pixel within 3 pixels of trace
maskbits 17 LOWFLAT         # Flat field less than 0.5
maskbits 18 FULLREJECT      # Pixel fully rejected in extraction (INVVAR=0)
maskbits 19 PARTIALREJECT   # Some pixels rejected in extraction
maskbits 20 SCATTEREDLIGHT  # Scattered light significant
maskbits 21 CROSSTALK       # Cross-talk significant
maskbits 22 NOSKY           # Sky level unknown at this wavelength (INVVAR=0)
maskbits 23 BRIGHTSKY       # Sky level > flux + 10*(flux-error)
maskbits 24 NODATA          # No data available in combine B-spline (INVVAR=0)
maskbits 25 COMBINEREJ      # Rejected in combine B-spline

        Maskbits 0 through 7 apply to the full set of 2048 pixels on
        blue or red spectra.

        The combined spectra found in spPlate*fits or spMerge2d*fits
        have two masks:
          AND mask: the bit is set if all overlapping pixels is set.
          OR  mask:         "         any overlapping pixel bit is set.

Minor changes:

    1) Lower limit to variance in raw image,
       equivalent to S/N < 100 per pixel.

    2) New optimal extraction profile: 0.5 * exp(-x^2) + 0.5*exp(-|x|^3)
       (proftype 3)

    3) Restricted wavelength range in telluric correction

    4) Tighter rejection limits, more stringent cosmic rejection
       limits: +- 4 sigma

    5) Sign has been corrected in heliocentric velocity

    6) The header has the following changes:

         CALID*  has been deleted
         UNSIGNED has been deleted

         FRAMESN2    S/N^2 for each frame, does not apply to merged
                          spectra
         EXPID       can accomodate more than 10 exposures
         PIXFLAT:    2d pixel flat used
         OPBC:       bad pixel file applied
         OPECALIB:   opEcalib file applied
         OPCONFIG:   opConfig file applied

         SPEC1_G, SPEC1_R, SPEC1_I
         SPEC2_G, SPEC2_R, SPEC2_I :  Fiducial S/N across spectrographs

         MAG_G, MAG_R, MAG_I : Synthetic magnitude after
                               spectrophotometry


     7) Bspline package no longer requires slatec library

     8) Sky fibers with significant extra flux are rejected

     9) Number of bad fibers with given bits set are tabulated at end

    10) pipeline can run and use .fit.gz  gzipped raw data files,
        saving about 40% of space required by raw spectro data

    11) Spectral Resolution is output in the final merged spectra.

    12) Use a better algorithm to tweak flat field trace to match object
        trace.

    13) Fixes in to account for electronics problem in August

-------------------------------------------------------------------------------
v3c (May 12, 2000?)

It still requires idlutils v3b to run.
It is tagged on the branch, v3branch, and includes the following
improvements to the 2d pipeline:

- Auto-generation of S/N plot at conclusion of spectra merging.
- Increased number of supersky breakpoints to achieve better sky subtraction
- Added entries to opBC.par file, this will remove most of the remaining
  glitches.
- Added a new routine, "spmulti", which can combine multiple MJDs
  with the same plugmap file
- Heliocentric correction is now done on an exposure by exposure basis in 2d.
- Removed header cards which are no longer pertinent, and added some
  extras requested by Andy.
    Ones to note are NGOOD (number of good pixels in final spectrum)
    SN_G, SN_R, SN_I  (3 measures of S/N)
- Dispersion and spatial widths are output as a function of fiber
  fiber number & pixel (in spArcInfo and spFlatInfo respectively)

